<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Jtstock</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_red.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2020-02-29T01:04:28+08:00">2020-02-29T01:04:28+08:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="red">7.51%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.14
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>55</b> files in total.
    <b>3011</b> relevant lines. 
    <span class="green"><b>226</b> lines covered</span> and
    <span class="red"><b>2785</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#f912393aeba14ff3f7f9ab6ddfe81663c48b4782" class="src_link" title="app/admin/access_grants.rb">app/admin/access_grants.rb</a></td>
        <td class="red strong">18.18 %</td>
        <td>16</td>
        <td>11</td>
        <td>2</td>
        <td>9</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#29a6b320a635b217c35e1edd3a6319b66a2d78c7" class="src_link" title="app/admin/access_tokens.rb">app/admin/access_tokens.rb</a></td>
        <td class="red strong">16.67 %</td>
        <td>18</td>
        <td>12</td>
        <td>2</td>
        <td>10</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5e1ce3303bdfa7dbbc5bf49d541e49e5413dd45f" class="src_link" title="app/admin/dashboards.rb">app/admin/dashboards.rb</a></td>
        <td class="red strong">42.86 %</td>
        <td>33</td>
        <td>7</td>
        <td>3</td>
        <td>4</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4965fb42b3061da47866710aca8ddf546530a855" class="src_link" title="app/admin/posts.rb">app/admin/posts.rb</a></td>
        <td class="red strong">20.0 %</td>
        <td>15</td>
        <td>10</td>
        <td>2</td>
        <td>8</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91066c0d8f3d547353c2d106ff50e557379f86ef" class="src_link" title="app/admin/users.rb">app/admin/users.rb</a></td>
        <td class="red strong">28.57 %</td>
        <td>9</td>
        <td>7</td>
        <td>2</td>
        <td>5</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#39393b02cb2cd64854b09ac45b05da045342991a" class="src_link" title="app/controllers/accounts_controller.rb">app/controllers/accounts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>14</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc69157c8d132b4a2fd66a58f783d22ac721615f" class="src_link" title="app/controllers/api/api_controller.rb">app/controllers/api/api_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>19</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c227e1de7e99b3cb018fadaaf22d8f1be49b00e0" class="src_link" title="app/controllers/api/v1/my_posts_controller.rb">app/controllers/api/v1/my_posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>51</td>
        <td>51</td>
        <td>0</td>
        <td>51</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4e4c92d5e8df31eb4c47bda1132c0f5a164e186d" class="src_link" title="app/controllers/api/v1/posts_controller.rb">app/controllers/api/v1/posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>24</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acbd52788e15a06a687f59aeb1debb2a70e8408d" class="src_link" title="app/controllers/api/v1/reports_controller.rb">app/controllers/api/v1/reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>69</td>
        <td>69</td>
        <td>0</td>
        <td>69</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#70c7fb470ec2294d9169d74e29c7650fe6683dbe" class="src_link" title="app/controllers/api/v1/stations_controller.rb">app/controllers/api/v1/stations_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>36</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#452305581b120b5efe1f1f8fc7a30c20c25ed373" class="src_link" title="app/controllers/api/v1/users_controller.rb">app/controllers/api/v1/users_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>24</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ecb9ade59698a0c76b3f917d2f792c0cbdfaca04" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">21.0 %</td>
        <td>181</td>
        <td>100</td>
        <td>21</td>
        <td>79</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d11ed97e2646ece463cb77c8c118f326616bd596" class="src_link" title="app/controllers/configs_controller.rb">app/controllers/configs_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>12</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d1ac86ef7a4c75c1b4081c167a875e75e4fd503" class="src_link" title="app/controllers/errors_controller.rb">app/controllers/errors_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>6</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7d14a6793407b411ccc1d08975c657900b550fc1" class="src_link" title="app/controllers/main_controller.rb">app/controllers/main_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>11</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99ceff182056de9774db7dba424877e9764fb3af" class="src_link" title="app/controllers/mi_reports_controller.rb">app/controllers/mi_reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>60</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54a91bf36f28ad02755678d84b6ffae79a1b48e1" class="src_link" title="app/controllers/my_posts_controller.rb">app/controllers/my_posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>99</td>
        <td>99</td>
        <td>0</td>
        <td>99</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e8727d87647085cd6a42d3b9b70b6de4d5e8a3bf" class="src_link" title="app/controllers/omniauth_callbacks_controller.rb">app/controllers/omniauth_callbacks_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>18</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#251e1e7ec1c8e14a1feea35c1d0d44ba55128d63" class="src_link" title="app/controllers/posts_controller.rb">app/controllers/posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>7</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0236f70ba5844902dd769e9db8b8b327878b11bf" class="src_link" title="app/controllers/products_controller.rb">app/controllers/products_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>48</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#df6ba15f592a25e4b9f2c3d482f011830879f00a" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>251</td>
        <td>251</td>
        <td>0</td>
        <td>251</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#759052937cc8cc653bc38de53e1b8b7de8235b61" class="src_link" title="app/controllers/stations_controller.rb">app/controllers/stations_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>34</td>
        <td>34</td>
        <td>0</td>
        <td>34</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#387536a8591c34e2231d4e7ee624a6748c5421ef" class="src_link" title="app/controllers/yield_files_controller.rb">app/controllers/yield_files_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>49</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#82d951be6091a3bd212bb6212f5658f626225c15" class="src_link" title="app/helpers/api/posts_helper.rb">app/helpers/api/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d02d137b92a6df7b0280cd2e0cfce974f69a06e9" class="src_link" title="app/helpers/api/v1/my_posts_helper.rb">app/helpers/api/v1/my_posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#55d600137ab9a38fb4adbf89b3554fb3b61dde94" class="src_link" title="app/helpers/api/v1/posts_helper.rb">app/helpers/api/v1/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#815575aa0ae79f0513d5197d14e182cbedbef763" class="src_link" title="app/helpers/api/v1/reports_helper.rb">app/helpers/api/v1/reports_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f2e732fd31864e763e85bd7f47d1577168ce4c40" class="src_link" title="app/helpers/api/v1/users_helper.rb">app/helpers/api/v1/users_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db3caa3f2281397e2a643476f3f20df3134e5093" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">45.83 %</td>
        <td>49</td>
        <td>24</td>
        <td>11</td>
        <td>13</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#426f59710c3a0cf9749135204fd4863eea26a08b" class="src_link" title="app/helpers/configs_helper.rb">app/helpers/configs_helper.rb</a></td>
        <td class="red strong">7.77 %</td>
        <td>327</td>
        <td>103</td>
        <td>8</td>
        <td>95</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b3ab2cd9db5c4d8c8ba3d6e0c07276feb2b5d15f" class="src_link" title="app/helpers/errors_helper.rb">app/helpers/errors_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9f085859eefdd0a6e5a4754d13999a48f4cb7e1e" class="src_link" title="app/helpers/main_helper.rb">app/helpers/main_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a1f54cf83a2b509c3fbec1ec35d9cacd96b795fa" class="src_link" title="app/helpers/mi_reports_helper.rb">app/helpers/mi_reports_helper.rb</a></td>
        <td class="red strong">20.0 %</td>
        <td>49</td>
        <td>10</td>
        <td>2</td>
        <td>8</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b44cf0506e2055b04cc8477eec751832b17ff9fa" class="src_link" title="app/helpers/my_posts_helper.rb">app/helpers/my_posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#30e4e0b33da68d04d4fc268b9194f1816f59ba4f" class="src_link" title="app/helpers/omniauth_callbacks_helper.rb">app/helpers/omniauth_callbacks_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c784c459be0fd0cbee8dede02a6f5089c0a9dd60" class="src_link" title="app/helpers/posts_helper.rb">app/helpers/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#65b1f8d39e80adeda86ac734fd809aed1e527a55" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">6.45 %</td>
        <td>128</td>
        <td>62</td>
        <td>4</td>
        <td>58</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eab66f54e213057dbb57010165fad9657f74f05a" class="src_link" title="app/helpers/stations_helper.rb">app/helpers/stations_helper.rb</a></td>
        <td class="red strong">5.66 %</td>
        <td>82</td>
        <td>53</td>
        <td>3</td>
        <td>50</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f2d0524a9d6530fa5458a37c3b8caea36f2b5374" class="src_link" title="app/models/admin_user.rb">app/models/admin_user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe5c4c68060d328e56dfa681ee829af13bc3ef3a" class="src_link" title="app/models/api_error.rb">app/models/api_error.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>13</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4eb4d3c3ccaec110269780a53b1638b7b127b820" class="src_link" title="app/models/apn_client.rb">app/models/apn_client.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>16</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1fac0fea29f73f94334f155f58e5207cd855f324" class="src_link" title="app/models/device.rb">app/models/device.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>5</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2cca7db0f44afb2c1a1bb30a63051897fafbb1c4" class="src_link" title="app/models/facebook_user.rb">app/models/facebook_user.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>35</td>
        <td>35</td>
        <td>0</td>
        <td>35</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91431aa5f22685aa1e25ae3e391c50c12c9d947b" class="src_link" title="app/models/mi_report.rb">app/models/mi_report.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>96</td>
        <td>55</td>
        <td>45</td>
        <td>10</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a4a3cc7b53d39b55ffba4d11eaebf7eaa15e5cc1" class="src_link" title="app/models/post.rb">app/models/post.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#64f9c991f7a380d4615d51607a26186f5a22b19a" class="src_link" title="app/models/product.rb">app/models/product.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>11</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0b46bae3f85b93702116a4b9ed393568e96bb722" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">24.62 %</td>
        <td>106</td>
        <td>65</td>
        <td>16</td>
        <td>49</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#64ba0f1060769ec475bd5d489f982385f39b0df3" class="src_link" title="app/models/report_main.rb">app/models/report_main.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>696</td>
        <td>696</td>
        <td>0</td>
        <td>696</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6a03fc8e0cce2c4c80e8c95510fb1eaf80a96b48" class="src_link" title="app/models/report_mini.rb">app/models/report_mini.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>694</td>
        <td>694</td>
        <td>0</td>
        <td>694</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#509b817825086fa44d0ad97560b18cfa1138a834" class="src_link" title="app/models/station.rb">app/models/station.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f42ef041a2cd8b556b57b966eb0e0cec323b991" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="red strong">34.15 %</td>
        <td>89</td>
        <td>41</td>
        <td>14</td>
        <td>27</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#192ae2df3a7c073d1d37b30e13dafe27ad7fdc66" class="src_link" title="app/models/yield_file.rb">app/models/yield_file.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>26</td>
        <td>16</td>
        <td>14</td>
        <td>2</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e0bbfa5bd3e2798f0e4c2853aede172985a8c0cc" class="src_link" title="lib/tasks/import_bfiamu.rake">lib/tasks/import_bfiamu.rake</a></td>
        <td class="red strong">7.14 %</td>
        <td>101</td>
        <td>56</td>
        <td>4</td>
        <td>52</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f0b0128fffd06569327ce12fa4cee616102b6bd3" class="src_link" title="lib/tasks/import_mi_index.rake">lib/tasks/import_mi_index.rake</a></td>
        <td class="green strong">92.0 %</td>
        <td>84</td>
        <td>50</td>
        <td>46</td>
        <td>4</td>
        <td>1.2</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="red">2.25%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.02
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>19</b> files in total.
    <b>932</b> relevant lines. 
    <span class="green"><b>21</b> lines covered</span> and
    <span class="red"><b>911</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#39393b02cb2cd64854b09ac45b05da045342991a" class="src_link" title="app/controllers/accounts_controller.rb">app/controllers/accounts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>14</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc69157c8d132b4a2fd66a58f783d22ac721615f" class="src_link" title="app/controllers/api/api_controller.rb">app/controllers/api/api_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>19</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c227e1de7e99b3cb018fadaaf22d8f1be49b00e0" class="src_link" title="app/controllers/api/v1/my_posts_controller.rb">app/controllers/api/v1/my_posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>51</td>
        <td>51</td>
        <td>0</td>
        <td>51</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4e4c92d5e8df31eb4c47bda1132c0f5a164e186d" class="src_link" title="app/controllers/api/v1/posts_controller.rb">app/controllers/api/v1/posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>24</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#acbd52788e15a06a687f59aeb1debb2a70e8408d" class="src_link" title="app/controllers/api/v1/reports_controller.rb">app/controllers/api/v1/reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>69</td>
        <td>69</td>
        <td>0</td>
        <td>69</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#70c7fb470ec2294d9169d74e29c7650fe6683dbe" class="src_link" title="app/controllers/api/v1/stations_controller.rb">app/controllers/api/v1/stations_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>36</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#452305581b120b5efe1f1f8fc7a30c20c25ed373" class="src_link" title="app/controllers/api/v1/users_controller.rb">app/controllers/api/v1/users_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>24</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ecb9ade59698a0c76b3f917d2f792c0cbdfaca04" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="red strong">21.0 %</td>
        <td>181</td>
        <td>100</td>
        <td>21</td>
        <td>79</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d11ed97e2646ece463cb77c8c118f326616bd596" class="src_link" title="app/controllers/configs_controller.rb">app/controllers/configs_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>12</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4d1ac86ef7a4c75c1b4081c167a875e75e4fd503" class="src_link" title="app/controllers/errors_controller.rb">app/controllers/errors_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>6</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7d14a6793407b411ccc1d08975c657900b550fc1" class="src_link" title="app/controllers/main_controller.rb">app/controllers/main_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>11</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99ceff182056de9774db7dba424877e9764fb3af" class="src_link" title="app/controllers/mi_reports_controller.rb">app/controllers/mi_reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>60</td>
        <td>60</td>
        <td>0</td>
        <td>60</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#54a91bf36f28ad02755678d84b6ffae79a1b48e1" class="src_link" title="app/controllers/my_posts_controller.rb">app/controllers/my_posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>99</td>
        <td>99</td>
        <td>0</td>
        <td>99</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e8727d87647085cd6a42d3b9b70b6de4d5e8a3bf" class="src_link" title="app/controllers/omniauth_callbacks_controller.rb">app/controllers/omniauth_callbacks_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>18</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#251e1e7ec1c8e14a1feea35c1d0d44ba55128d63" class="src_link" title="app/controllers/posts_controller.rb">app/controllers/posts_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>7</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0236f70ba5844902dd769e9db8b8b327878b11bf" class="src_link" title="app/controllers/products_controller.rb">app/controllers/products_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>48</td>
        <td>48</td>
        <td>0</td>
        <td>48</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#df6ba15f592a25e4b9f2c3d482f011830879f00a" class="src_link" title="app/controllers/reports_controller.rb">app/controllers/reports_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>251</td>
        <td>251</td>
        <td>0</td>
        <td>251</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#759052937cc8cc653bc38de53e1b8b7de8235b61" class="src_link" title="app/controllers/stations_controller.rb">app/controllers/stations_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>34</td>
        <td>34</td>
        <td>0</td>
        <td>34</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#387536a8591c34e2231d4e7ee624a6748c5421ef" class="src_link" title="app/controllers/yield_files_controller.rb">app/controllers/yield_files_controller.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>49</td>
        <td>0.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="red">6.37%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.17
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>14</b> files in total.
    <b>1664</b> relevant lines. 
    <span class="green"><b>106</b> lines covered</span> and
    <span class="red"><b>1558</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#f2d0524a9d6530fa5458a37c3b8caea36f2b5374" class="src_link" title="app/models/admin_user.rb">app/models/admin_user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe5c4c68060d328e56dfa681ee829af13bc3ef3a" class="src_link" title="app/models/api_error.rb">app/models/api_error.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>13</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4eb4d3c3ccaec110269780a53b1638b7b127b820" class="src_link" title="app/models/apn_client.rb">app/models/apn_client.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>16</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1fac0fea29f73f94334f155f58e5207cd855f324" class="src_link" title="app/models/device.rb">app/models/device.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>5</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2cca7db0f44afb2c1a1bb30a63051897fafbb1c4" class="src_link" title="app/models/facebook_user.rb">app/models/facebook_user.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>35</td>
        <td>35</td>
        <td>0</td>
        <td>35</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91431aa5f22685aa1e25ae3e391c50c12c9d947b" class="src_link" title="app/models/mi_report.rb">app/models/mi_report.rb</a></td>
        <td class="yellow strong">81.82 %</td>
        <td>96</td>
        <td>55</td>
        <td>45</td>
        <td>10</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a4a3cc7b53d39b55ffba4d11eaebf7eaa15e5cc1" class="src_link" title="app/models/post.rb">app/models/post.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#64f9c991f7a380d4615d51607a26186f5a22b19a" class="src_link" title="app/models/product.rb">app/models/product.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>11</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0b46bae3f85b93702116a4b9ed393568e96bb722" class="src_link" title="app/models/report.rb">app/models/report.rb</a></td>
        <td class="red strong">24.62 %</td>
        <td>106</td>
        <td>65</td>
        <td>16</td>
        <td>49</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#64ba0f1060769ec475bd5d489f982385f39b0df3" class="src_link" title="app/models/report_main.rb">app/models/report_main.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>696</td>
        <td>696</td>
        <td>0</td>
        <td>696</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6a03fc8e0cce2c4c80e8c95510fb1eaf80a96b48" class="src_link" title="app/models/report_mini.rb">app/models/report_mini.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>694</td>
        <td>694</td>
        <td>0</td>
        <td>694</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#509b817825086fa44d0ad97560b18cfa1138a834" class="src_link" title="app/models/station.rb">app/models/station.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3f42ef041a2cd8b556b57b966eb0e0cec323b991" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="red strong">34.15 %</td>
        <td>89</td>
        <td>41</td>
        <td>14</td>
        <td>27</td>
        <td>0.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#192ae2df3a7c073d1d37b30e13dafe27ad7fdc66" class="src_link" title="app/models/yield_file.rb">app/models/yield_file.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>26</td>
        <td>16</td>
        <td>14</td>
        <td>2</td>
        <td>0.9</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="red">14.5%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.17
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>15</b> files in total.
    <b>262</b> relevant lines. 
    <span class="green"><b>38</b> lines covered</span> and
    <span class="red"><b>224</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#82d951be6091a3bd212bb6212f5658f626225c15" class="src_link" title="app/helpers/api/posts_helper.rb">app/helpers/api/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d02d137b92a6df7b0280cd2e0cfce974f69a06e9" class="src_link" title="app/helpers/api/v1/my_posts_helper.rb">app/helpers/api/v1/my_posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#55d600137ab9a38fb4adbf89b3554fb3b61dde94" class="src_link" title="app/helpers/api/v1/posts_helper.rb">app/helpers/api/v1/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#815575aa0ae79f0513d5197d14e182cbedbef763" class="src_link" title="app/helpers/api/v1/reports_helper.rb">app/helpers/api/v1/reports_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f2e732fd31864e763e85bd7f47d1577168ce4c40" class="src_link" title="app/helpers/api/v1/users_helper.rb">app/helpers/api/v1/users_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db3caa3f2281397e2a643476f3f20df3134e5093" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="red strong">45.83 %</td>
        <td>49</td>
        <td>24</td>
        <td>11</td>
        <td>13</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#426f59710c3a0cf9749135204fd4863eea26a08b" class="src_link" title="app/helpers/configs_helper.rb">app/helpers/configs_helper.rb</a></td>
        <td class="red strong">7.77 %</td>
        <td>327</td>
        <td>103</td>
        <td>8</td>
        <td>95</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b3ab2cd9db5c4d8c8ba3d6e0c07276feb2b5d15f" class="src_link" title="app/helpers/errors_helper.rb">app/helpers/errors_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9f085859eefdd0a6e5a4754d13999a48f4cb7e1e" class="src_link" title="app/helpers/main_helper.rb">app/helpers/main_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a1f54cf83a2b509c3fbec1ec35d9cacd96b795fa" class="src_link" title="app/helpers/mi_reports_helper.rb">app/helpers/mi_reports_helper.rb</a></td>
        <td class="red strong">20.0 %</td>
        <td>49</td>
        <td>10</td>
        <td>2</td>
        <td>8</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b44cf0506e2055b04cc8477eec751832b17ff9fa" class="src_link" title="app/helpers/my_posts_helper.rb">app/helpers/my_posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#30e4e0b33da68d04d4fc268b9194f1816f59ba4f" class="src_link" title="app/helpers/omniauth_callbacks_helper.rb">app/helpers/omniauth_callbacks_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c784c459be0fd0cbee8dede02a6f5089c0a9dd60" class="src_link" title="app/helpers/posts_helper.rb">app/helpers/posts_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#65b1f8d39e80adeda86ac734fd809aed1e527a55" class="src_link" title="app/helpers/reports_helper.rb">app/helpers/reports_helper.rb</a></td>
        <td class="red strong">6.45 %</td>
        <td>128</td>
        <td>62</td>
        <td>4</td>
        <td>58</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eab66f54e213057dbb57010165fad9657f74f05a" class="src_link" title="app/helpers/stations_helper.rb">app/helpers/stations_helper.rb</a></td>
        <td class="red strong">5.66 %</td>
        <td>82</td>
        <td>53</td>
        <td>3</td>
        <td>50</td>
        <td>0.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Jobs"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="red">47.17%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.62
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>2</b> files in total.
    <b>106</b> relevant lines. 
    <span class="green"><b>50</b> lines covered</span> and
    <span class="red"><b>56</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#e0bbfa5bd3e2798f0e4c2853aede172985a8c0cc" class="src_link" title="lib/tasks/import_bfiamu.rake">lib/tasks/import_bfiamu.rake</a></td>
        <td class="red strong">7.14 %</td>
        <td>101</td>
        <td>56</td>
        <td>4</td>
        <td>52</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f0b0128fffd06569327ce12fa4cee616102b6bd3" class="src_link" title="lib/tasks/import_mi_index.rake">lib/tasks/import_mi_index.rake</a></td>
        <td class="green strong">92.0 %</td>
        <td>84</td>
        <td>50</td>
        <td>46</td>
        <td>4</td>
        <td>1.2</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent"><span class="red">23.4%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.24
       </span>
    </span> hits/line)
  </h2>
  <a name="Ungrouped"></a>
  <div>
    <b>5</b> files in total.
    <b>47</b> relevant lines. 
    <span class="green"><b>11</b> lines covered</span> and
    <span class="red"><b>36</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#f912393aeba14ff3f7f9ab6ddfe81663c48b4782" class="src_link" title="app/admin/access_grants.rb">app/admin/access_grants.rb</a></td>
        <td class="red strong">18.18 %</td>
        <td>16</td>
        <td>11</td>
        <td>2</td>
        <td>9</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#29a6b320a635b217c35e1edd3a6319b66a2d78c7" class="src_link" title="app/admin/access_tokens.rb">app/admin/access_tokens.rb</a></td>
        <td class="red strong">16.67 %</td>
        <td>18</td>
        <td>12</td>
        <td>2</td>
        <td>10</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5e1ce3303bdfa7dbbc5bf49d541e49e5413dd45f" class="src_link" title="app/admin/dashboards.rb">app/admin/dashboards.rb</a></td>
        <td class="red strong">42.86 %</td>
        <td>33</td>
        <td>7</td>
        <td>3</td>
        <td>4</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4965fb42b3061da47866710aca8ddf546530a855" class="src_link" title="app/admin/posts.rb">app/admin/posts.rb</a></td>
        <td class="red strong">20.0 %</td>
        <td>15</td>
        <td>10</td>
        <td>2</td>
        <td>8</td>
        <td>0.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#91066c0d8f3d547353c2d106ff50e557379f86ef" class="src_link" title="app/admin/users.rb">app/admin/users.rb</a></td>
        <td class="red strong">28.57 %</td>
        <td>9</td>
        <td>7</td>
        <td>2</td>
        <td>5</td>
        <td>0.3</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.11.2 
        and simplecov-html v0.10.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="f912393aeba14ff3f7f9ab6ddfe81663c48b4782">
  <div class="header">
    <h3>app/admin/access_grants.rb</h3>
    <h4><span class="red">18.18 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveAdmin.register Doorkeeper::AccessGrant do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  index do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    column :owner do |grant|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      div User.find_by_id(grant.resource_owner_id).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    column :application</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    column :token do |grant|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      div truncate(grant.token)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    column :expires_in</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    column :redirect_uri</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    column :revoked_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # column :scopes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    default_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="29a6b320a635b217c35e1edd3a6319b66a2d78c7">
  <div class="header">
    <h3>app/admin/access_tokens.rb</h3>
    <h4><span class="red">16.67 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveAdmin.register Doorkeeper::AccessToken do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  index do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    column :owner do |grant|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      div User.find_by_id(grant.resource_owner_id).email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    column :application</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    column :token do |grant|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      div truncate(grant.token)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    column :refresh_token do |grant|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      div truncate(grant.refresh_token)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    column :expires_in</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    column :revoked_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # column :scopes</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    default_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5e1ce3303bdfa7dbbc5bf49d541e49e5413dd45f">
  <div class="header">
    <h3>app/admin/dashboards.rb</h3>
    <h4><span class="red">42.86 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveAdmin.register_page &quot;Dashboard&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  menu priority: 1, label: proc{ I18n.t(&quot;active_admin.dashboard&quot;) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  content title: proc{ I18n.t(&quot;active_admin.dashboard&quot;) } do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    div class: &quot;blank_slate_container&quot;, id: &quot;dashboard_default_message&quot; do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      span class: &quot;blank_slate&quot; do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">        span I18n.t(&quot;active_admin.dashboard_welcome.welcome&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">        small I18n.t(&quot;active_admin.dashboard_welcome.call_to_action&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    # Here is an example of a simple dashboard with columns and panels.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    # columns do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    #   column do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    #     panel &quot;Recent Posts&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    #       ul do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    #         Post.recent(5).map do |post|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    #           li link_to(post.title, admin_post_path(post))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    #         end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    #       end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    #     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    #   column do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    #     panel &quot;Info&quot; do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    #       para &quot;Welcome to ActiveAdmin.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    #     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end # content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4965fb42b3061da47866710aca8ddf546530a855">
  <div class="header">
    <h3>app/admin/posts.rb</h3>
    <h4><span class="red">20.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveAdmin.register Post do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  index do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    column :id, sotrable: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    column :title do |post|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      div(:style =&gt; &quot;white-space: nowrap&quot;) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">        truncate(post.title)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    column :content do |post|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      div truncate(post.content)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    column :published_at, sortable: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    default_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="91066c0d8f3d547353c2d106ff50e557379f86ef">
  <div class="header">
    <h3>app/admin/users.rb</h3>
    <h4><span class="red">28.57 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveAdmin.register User do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  index do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    column :id, sotrable: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    column :email</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    column :current_sign_in_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    column :current_sign_in_ip</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    default_actions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="39393b02cb2cd64854b09ac45b05da045342991a">
  <div class="header">
    <h3>app/controllers/accounts_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class AccountsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def checkpass</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  	if current_user &amp;&amp; current_user.valid_password?(params[:password])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  	  current_user.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  	  Devise.sign_out_all_scopes ? sign_out : sign_out(current_user)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  	  respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  	    format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  	  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  	end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fc69157c8d132b4a2fd66a58f783d22ac721615f">
  <div class="header">
    <h3>app/controllers/api/api_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>19</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::ApiController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  # include Doorkeeper::Controller</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  protect_from_forgery with: :null_session</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  respond_to :json</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  def render_error(error, error_description, messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    render :json =&gt; ApiError.json(error, error_description, messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if doorkeeper_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      @current_user ||= User.find(doorkeeper_token.resource_owner_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c227e1de7e99b3cb018fadaaf22d8f1be49b00e0">
  <div class="header">
    <h3>app/controllers/api/v1/my_posts_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>51</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>51</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::V1::MyPostsController &lt; Api::ApiController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  doorkeeper_for :all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    if page &gt; 1 || stale?(last_modified: current_user.posts.maximum(:updated_at))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      @posts = current_user.posts.alive.order(&quot;updated_at DESC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    @post = current_user.posts.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    if @post.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        &quot;Requested post does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    fresh_when @post</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    @post = current_user.posts.create(params[:post])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    unless @post.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      render_error(:invalid_parameter, &quot;Parameter Error&quot;, @post.errors.messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    render :action =&gt; :show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    @post = current_user.posts.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    @post.update_attributes(params[:post])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    unless @post.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      render_error(:invalid_parameter, &quot;Parameter Error&quot;, @post.errors.messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    render :action =&gt; :show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    @post = current_user.posts.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    @post.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    #@post.update_attribute(:deleted_at, Time.now)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    render :action =&gt; :show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4e4c92d5e8df31eb4c47bda1132c0f5a164e186d">
  <div class="header">
    <h3>app/controllers/api/v1/posts_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::V1::PostsController &lt; Api::ApiController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    if page &gt; 1 || stale?(last_modified: Post.maximum(:updated_at))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      @posts = Post.published.alive.order(&quot;updated_at DESC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    @post = Post.published.alive.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    if @post.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      @error = ApiError.new(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">        &quot;Requested post does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      render :action =&gt; :error</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    fresh_when @post, public: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="acbd52788e15a06a687f59aeb1debb2a70e8408d">
  <div class="header">
    <h3>app/controllers/api/v1/reports_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>69</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>69</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::V1::ReportsController &lt; Api::ApiController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  doorkeeper_for :all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  	page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">	per_page = 25</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  	@post = current_user.posts.find_by_id(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  	@station = @post.stations.find_by_id(params[:station_id]) if params[:station_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if @post.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">        &quot;Requested yield report post does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">	</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">    if page &gt; 1 || stale?(last_modified: @post.reports.maximum(:updated_at))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      # Ordered by parameters</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      if !params[:sort].blank?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      	if (Report.column_names.include? params[:sort]) &amp;&amp; (Report.sort_names.include? params[:sort])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      	  @reports = params[:station_id] ? @station.reports.order(&quot;#{params[:sort]} ASC&quot;).page(page).per(per_page) : @post.reports.order(&quot;#{params[:sort]} ASC&quot;).page(page).per(per_page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      	else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      	  render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        	:resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">        	&quot;Parameter Error&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">        	&quot;&#39;#{params[:sort]}&#39; is not a valid parameter.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      	  )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      	  return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      	end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      	# Ordered by published_at as default</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      	@reports = params[:station_id] ? @station.reports.order(&quot;published_at ASC&quot;).page(page).per(per_page) : @post.reports.order(&quot;published_at ASC&quot;).page(page).per(per_page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">  	  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">  	@post = current_user.posts.find_by_id(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    @report = @post.reports.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">    if @report.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        &quot;Requested yield data does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    fresh_when @report, public: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">    @post = current_user.posts.find_by_id(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">    @report = @post.reports.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    if @report.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        &quot;Requested yield data does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    @report.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    render :action =&gt; :show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="70c7fb470ec2294d9169d74e29c7650fe6683dbe">
  <div class="header">
    <h3>app/controllers/api/v1/stations_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>36</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::V1::StationsController &lt; Api::ApiController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  doorkeeper_for :all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    per_page = 25</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @post = current_user.posts.find_by_id(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    if @post.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">        &quot;Requested station list does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    if page &gt; 1 || stale?(last_modified: @post.stations.maximum(:updated_at))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      @stations = @post.stations.order(&quot;updated_at ASC&quot;).page(page).per(per_page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">  	@post = current_user.posts.find_by_id(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">  	@station = @post.stations.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">  	if @post.nil? || @station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">        &quot;Requested station does not exist or you don&#39;t have permission to see it.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    fresh_when @station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="452305581b120b5efe1f1f8fc7a30c20c25ed373">
  <div class="header">
    <h3>app/controllers/api/v1/users_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>24</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Api::V1::UsersController &lt; Api::ApiController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  doorkeeper_for :all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @user = User.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    if @user.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      render_error(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">        :resource_not_found,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">        &quot;Not Found&quot;,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">        &quot;Requested user does not exist.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if @user.uid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      hash = current_user.facebook.get_object(@user.uid)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      logger.debug &quot;facebook user: #{hash}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      @user.facebook_user = FacebookUser.new(hash)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    # expires_in 5.seconds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    # fresh_when @user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ecb9ade59698a0c76b3f917d2f792c0cbdfaca04">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="red">21.0 %</span> covered</h4>
    <div>
      <b>100</b> relevant lines. 
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>79</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class Forbidden &lt; ActionController::ActionControllerError; end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  class IpAddressRejected &lt; ActionController::ActionControllerError; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from Exception, with: :rescue500</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from Forbidden, with: :rescue403</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from IpAddressRejected, with: :rescue403</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActionController::RoutingError, with: :rescue404</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from ActiveRecord::RecordNotFound, with: :rescue404</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  rescue_from Timeout::Error, with: :rescue524</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_latest_time_yield(post, reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    last_record = post.reports.where(config: &#39;ALL&#39;).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    datetime = DateTime.parse(last_record.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    reports = reports.where(&#39;p_year = ? AND p_month = ? AND p_date = ? AND p_hour &gt;= ?&#39;, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        datetime.year, datetime.month, datetime.date, datetime.hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    return reports.order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_target_date_yield(post, reports, build, target_date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    if build == &#39;main&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      last_record = post.report_mains.order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    elsif build == &#39;mini&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      last_record = post.report_minis.order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      last_record = reports.where(config: &#39;ALL&#39;, p_year: target_date.to_date.year, p_month: target_date.to_date.month, p_date: target_date.to_date.day).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    datetime = DateTime.parse(last_record.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    if last_record.p_hour.between?(6, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      reports = reports.where(&#39;p_year = ? AND p_month = ? AND p_date = ? AND p_hour &gt;= ?&#39;, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        datetime.year, datetime.month, datetime.date, 6)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    elsif last_record.p_hour.between?(0, 5)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      # Show reports with timestamp after 6am yesterday to 5am today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      reports = reports.where(&#39;p_year = ? AND p_month = ? AND ((p_date = ? AND p_hour &gt;= ?) OR (p_date = ? AND p_hour &lt; ?))&#39;, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6, datetime.day, 6)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    if params[:my_post_id].present? # For station page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        return reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        # Show only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">        return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      # For showing only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_today_yield(post, reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    last_record = post.reports.order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">    if params[:my_post_id].present? # For station page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        return reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        # Show only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      # For showing only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_yesterday_yield(post, reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">    last_record = post.reports.order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    datetime = DateTime.parse(last_record.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">    reports = reports.where(&#39;published_at = ?&#39;, datetime.yesterday)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    if params[:my_post_id].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">       return reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">     else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      # Show only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      # For showing only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_custom_date_yield(post, reports, date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">    last_record = post.reports.order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">    datetime = DateTime.parse(last_record.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">    reports = reports.where(&#39;published_at = ?&#39;, date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">    if params[:my_post_id].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">      if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">       return reports</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">     else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">      # Show only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">     end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      # For showing only latest time of data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">      latest_date = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">      return reports = reports.where(published_at: latest_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">  def rescue400(e)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    @exception = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">    error_info = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      :error =&gt; &quot;Bad request&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">      :exception =&gt; &quot;#{e.class.name} : #{e.message}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">    error_info[:trace] = e.backtrace[0,10] if Rails.env.development?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">      format.json{ render json: error_info.to_json, status: 400 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">      format.html{ render &#39;errors/bad_request&#39;, status: 400 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  def rescue403(e)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">    @exception = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">    error_info = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      :error =&gt; &quot;Unauthorized&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      :exception =&gt; &quot;#{e.class.name} : #{e.message}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">    error_info[:trace] = e.backtrace[0,10] if Rails.env.development?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">      format.json{ render json: error_info.to_json, status: 403 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">      format.html{ render &#39;errors/forbidden&#39;, status: 403 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  def rescue404(e)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">    @exception = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">    error_info = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">      :error =&gt; &quot;Resource not found&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">      :exception =&gt; &quot;#{e.class.name} : #{e.message}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">    error_info[:trace] = e.backtrace[0,10] if Rails.env.development?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">      format.json{ render json: error_info.to_json, status: 404 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">      format.html{ render &#39;errors/not_found&#39;, status: 404 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">  def rescue500(e)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">    @exception = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    error_info = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      :error =&gt; &quot;Internal server error&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      :exception =&gt; &quot;#{e.class.name} : #{e.message}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">    error_info[:trace] = e.backtrace[0,10] if Rails.env.development?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">      format.json{ render json: error_info.to_json, status: 500 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">      format.html{ render &#39;errors/internal_server_error&#39;, status: 500 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">  def rescue524(e)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">    @exception = e</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">    error_info = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      :error =&gt; &quot;A timeout occurred&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">      :exception =&gt; &quot;#{e.class.name} : #{e.message}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">    error_info[:trace] = e.backtrace[0,10] if Rails.env.development?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">      format.json{ render json: error_info.to_json, status: 524 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">      format.html{ render &#39;errors/timeout_occurred&#39;, status: 524 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d11ed97e2646ece463cb77c8c118f326616bd596">
  <div class="header">
    <h3>app/controllers/configs_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ConfigsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  	page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  	@post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @report = @post.reports.find(params[:report_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @station = @report.station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    @reports_for_cart = @post.mi_reports.where(&#39;station_id = ? AND published_at = ?&#39;, @report.station_id, @report.published_at).order(&quot;published_at DESC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  	@reports = @reports_for_cart.page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4d1ac86ef7a4c75c1b4081c167a875e75e4fd503">
  <div class="header">
    <h3>app/controllers/errors_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ErrorsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  def routing_error</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    raise ActionController::RoutingError,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      &quot;No route matches #{request.path.inspect}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7d14a6793407b411ccc1d08975c657900b550fc1">
  <div class="header">
    <h3>app/controllers/main_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class MainController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    # page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    # if user_signed_in?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    #   @my_posts = current_user.posts.page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    # @public_posts = Post.published.page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="99ceff182056de9774db7dba424877e9764fb3af">
  <div class="header">
    <h3>app/controllers/mi_reports_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>60</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>60</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class MiReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    if request.post? &amp;&amp; params[:file].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      csv_files = params[:file]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      imported_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      duplicated_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      filtered_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      no_row_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      csv_files.each do |file|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">        # Prevent duplicated importing file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">        filename = sanitize_filename(file.original_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">        if YieldFile.exists?(file_name: filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">          duplicated_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">          respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">            format.json { render json: {error: filename + &#39; 發現重複匯入，已被略過！&#39;} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">          next</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">          model_stage = &#39;BFIAMU&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">          if post = Post.find_by_title(model_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">            MiReport.import_data(file.path, filename, post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">            # Check total imported row counts</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">            if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">              count = Report.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">              # Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">              count + 7 == file.total_row</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">	          imported_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">	          respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">	            format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">	          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">              # If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">              file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">              respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">                format.json { render json: { error: &#39;從 &#39; + filename + &#39; 匯入資料時發生錯誤！&#39; } }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">  def sanitize_filename(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    return filename.strip do |name|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">     # NOTE: File.basename doesn&#39;t work right with Windows paths on Unix</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">     # get only the filename, not the whole path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">     name.gsub!(/^.*(\\|\/)/, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">     # Strip out the non-ascii character</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">     name.gsub!(/[^0-9A-Za-z.\-]/, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="54a91bf36f28ad02755678d84b6ffae79a1b48e1">
  <div class="header">
    <h3>app/controllers/my_posts_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>99</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>99</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class MyPostsController &lt; InheritedResources::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  defaults :resource_class =&gt; Post, :collection_name =&gt; &#39;posts&#39;, :instance_name =&gt; &#39;post&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @posts = Post.find(:all, order: &#39;title&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @files_count = YieldFile.find(:all).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    @posts = Post.find(:all, order: &#39;title&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    @post = Post.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    reports_by_all = @post.reports</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    reports_count = @post.reports.count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    if reports_count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      if params[:date] == &#39;today&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        if reports_count == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">          redirect_to my_post_path(@post), alert: &quot;No data found :(&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">          return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">          @reports_for_cart = get_today_yield(@post, reports_by_all)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      elsif params[:date] == &#39;yesterday&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        if reports_count == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">          redirect_to my_post_path(@post), alert: &quot;No data found :(&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">          return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">          @reports_for_cart = get_yesterday_yield(@post, reports_by_all)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      elsif params[:to_date].present? &amp;&amp; params[:to_date] != &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">        if reports_count == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">          redirect_to my_post_path(@post), alert: &quot;No data found :(&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">          return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">          @reports_for_cart = get_custom_date_yield(@post, reports_by_all, params[:to_date])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">      else # Today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">        @reports_for_cart = get_today_yield(@post, reports_by_all)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      reports_tmp = @reports_for_cart</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      @reports_for_cart = reports_tmp.order(&quot;published_at ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      @reports = reports_tmp.order(&quot;station_id ASC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">        format.html { redirect_to my_posts_path, alert: &quot;No data found :(&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">        format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">  # def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">  #   @product = Product.find(params[:product_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">  #   @post = Post.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">  # def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">  #   create! { product_my_posts_path }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">  #   @post.user = current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">  #   @post.product = Product.find(params[:product_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">  #   @post.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">  # def edit</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">  #   @product = Product.find(params[:product_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">  #   @post = Post.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">  # def update</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">  #   @product = Product.find(params[:product_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">  #   @post = Post.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">  #   update! { product_my_post_path(@product, @post) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">    @post = Post.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">    @post.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">      format.html { redirect_to my_posts_path, notice: &quot;#{@post.title} was removed :)&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">      format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">  def begin_of_association_chain</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">  def collection</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">    @posts ||= end_of_association_chain.order(&quot;updated_at DESC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">    # @posts ||= end_of_association_chain.page((params[:page] || 1).to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e8727d87647085cd6a42d3b9b70b6de4d5e8a3bf">
  <div class="header">
    <h3>app/controllers/omniauth_callbacks_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>18</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class OmniauthCallbacksController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  def facebook</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    @user = User.find_for_facebook_oauth(request.env[&quot;omniauth.auth&quot;], current_user)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    if @user.persisted?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">      flash[:notice] = I18n.t &quot;devise.omniauth_callbacks.success&quot;, :kind =&gt; &quot;Facebook&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      sign_in_and_redirect @user, :event =&gt; :authentication</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      unless @user.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">        flash[:notice] = @user.errors.full_messages.join(&quot;. &quot;) + &quot;.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">        redirect_to new_user_session_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      session[&quot;devise.facebook_data&quot;] = request.env[&quot;omniauth.auth&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      redirect_to new_user_registration_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="251e1e7ec1c8e14a1feea35c1d0d44ba55128d63">
  <div class="header">
    <h3>app/controllers/posts_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class PostsController &lt; InheritedResources::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    redirect_to root_path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0236f70ba5844902dd769e9db8b8b327878b11bf">
  <div class="header">
    <h3>app/controllers/products_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>48</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>48</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ProductsController &lt; InheritedResources::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  	@products = Product.find(:all, order: &#39;title&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  	@product = Product.new</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">  	@product = Product.new(params[:product])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    @product.user = current_user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      if @product.save</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      	format.js</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        format.html { redirect_to products_path, notice: &quot;#{@product.title} was successfully created.&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      	format.js</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">        format.html { render action: &#39;new&#39; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">        format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  	@product = Product.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    @product.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">      format.html { redirect_to products_path, notice: &quot;#{@product.title} was removed.&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">  def update_builds_selector</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    @builds = Post.where(product_id: params[:product_id]).all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    #render partial: &#39;/shared/builds_selector&#39;, object: @builds</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">  def update_builds_menu</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    @product = Product.find_by_title(params[:product_name].strip!)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    @builds = Post.where(product_id: @product).all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="df6ba15f592a25e4b9f2c3d482f011830879f00a">
  <div class="header">
    <h3>app/controllers/reports_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>251</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>251</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ReportsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def autocomplete_station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    post_id = params[:my_post_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    term = params[:term]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    stations = Station.where(&#39;post_id = ? AND name LIKE ?&#39;, post_id, &quot;%#{term}%&quot;).order(:name).all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    render :json =&gt; stations.map { |s| {:id =&gt; s.id, :label =&gt; s.name, :value =&gt; s.name} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  def autocomplete_report_config</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    post_id = params[:my_post_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    term = params[:term]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    reports = Report.where(&#39;post_id = ? AND config LIKE ?&#39;, post_id, &quot;%#{term}%&quot;).select(&quot;distinct(config)&quot;).order(:config).limit(10)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    render :json =&gt; reports.map { |r| {:id =&gt; r.id, :label =&gt; r.config, :value =&gt; r.config} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  # Navbar Global Search Box</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">  def autocomplete_station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    term = params[:term]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    stations = Station.where(&#39;name LIKE ?&#39;, &quot;%#{term}%&quot;).select(&quot;distinct(name)&quot;).order(:name).limit(10)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    render :json =&gt; stations.map { |s| {:id =&gt; s.id, :label =&gt; s.name, :value =&gt; s.name} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">  def autocomplete_config</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    term = params[:term]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    reports = Report.where(&#39;config LIKE ?&#39;, &quot;%#{term}%&quot;).select(&quot;distinct(config)&quot;).order(:config).limit(10)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    render :json =&gt; reports.map { |r| {:id =&gt; r.id, :label =&gt; r.config, :value =&gt; r.config} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">  def search</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    @posts = Post.find(:all)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id]) if params[:my_post_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    @station = @post.stations.find_by_id(params[:station][&quot;id&quot;]) if params[:station]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    # For rendering contents by click tab after search</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    if params[:from_station]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      @station = @post.stations.find(params[:from_station])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      reports_by_all_config = @station.reports.where(config: &#39;ALL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">    elsif params[:from_report] &amp;&amp; params[:show_config] == &#39;all&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      # Get all configs of station at specific datetime</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      @report = @post.reports.find(params[:from_report])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">      @station = @report.station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      @reports_for_cart = @post.reports.where(&#39;config != ? AND station_name = ? AND published_at = ?&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">        &#39;ALL&#39;, @report.station_name, @report.published_at).order(&quot;published_at DESC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      @reports = @reports_for_cart.page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      if params[:my_post_id]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        reports_by_all_config = @post.reports.where(config: &#39;ALL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    if params[:date].present? &amp;&amp; params[:date] == &#39;today&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">      if @post.reports.count == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        redirect_to my_post_path(@post), alert: &quot;No data found :(&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        redirect_to my_post_path(@post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    elsif params[:date].present? &amp;&amp; params[:date] == &#39;yesterday&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      if @post.reports.count == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        redirect_to my_post_path(@post), alert: &quot;No data found :(&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        return</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        redirect_to my_post_path(@post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">    elsif params[:commit] == &#39;Search&#39; || params[:commit] == &#39;GlobalSearch&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">      # For search function</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      station = params[:station]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">      date_from = params[:date_range][0, 10] if params[:date_range]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      date_to = params[:date_range][13, 10] if params[:date_range]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">      fix_datetime = params[:no_date_range] if params[:no_date_range]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">      date = params[:date] if params[:date]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">      date1 = params[:date1] if params[:date1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">      date2 = params[:date2] if params[:date2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">      date3 = params[:date3] if params[:date3]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">      search_type = params[:search_type] if params[:search_type]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      t = Report.arel_table</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">      @reports_for_cart = Report.where(post_id: @post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">      @reports_for_cart = @reports_for_cart.where(t[:station_name].matches(&quot;#{station}&quot;)) if station.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">      # Multiple Date Search</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">      if date1.present? || date2.present? || date3.present? &amp;&amp; !search_type.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        dates_for_filter = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        [date1, date2, date3].each do |date|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">          dates_for_filter &lt;&lt; date if date.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">        @reports_for_cart = @reports_for_cart.where(published_at: [dates_for_filter])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">        @dates_selected = @reports_for_cart.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">        @dates_selected_count = @dates_selected.count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">        report_for_tmp = @reports_for_cart</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        @reports_for_cart = report_for_tmp.order(&quot;published_at ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        @distinct_date = @reports_for_cart.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">        @reports = report_for_tmp.order(&quot;station_id ASC, published_at ASC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        @reports_summarize = @reports_for_cart.group_by(&amp;:station_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">      # Date Range Search</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">      elsif date_from.present? &amp;&amp; date_to.present? &amp;&amp; search_type.present? &amp;&amp; search_type == &quot;Range&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">        if date_from != date_to # Search for multiple days (ex. Jun 20 ~ Jun 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">          dates_for_filter = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">          search_date_range = (&quot;#{date_from}&quot;..&quot;#{date_to}&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">          search_date_range.each do |the_date|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">            dates_for_filter.append(the_date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">          @reports_for_cart = @reports_for_cart.where(published_at: [dates_for_filter])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">          report_for_tmp = @reports_for_cart</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">          @reports_for_cart = report_for_tmp.order(&quot;published_at ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          @distinct_date = @reports_for_cart.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">          </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">          @reports = report_for_tmp.order(&quot;station_id ASC, published_at ASC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">          @reports_summarize = report_for_tmp.select(&#39;station_name, MAX(shares_percentage) as best_sp, MIN(shares_percentage) as worst_sp, MAX(closing_percentage) as best_cp, MIN(closing_percentage) as worst_cp&#39;).group(:station_id, :station_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">          # Get all dates that best shares percentage occurs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">          @best_sp_dates = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          @reports_summarize.each do |item|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">            matched_dates = @reports_for_cart.where(station_name: item.station_name).where(&quot;shares_percentage &gt; ? AND shares_percentage &lt; ?&quot;, item.best_sp - 0.00001, item.best_sp + 0.00001)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">            @best_sp_dates.append(matched_dates)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">          # Get all dates that worst shares percentage occurs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">          @worst_sp_dates = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">          @reports_summarize.each do |item|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">            matched_dates = @reports_for_cart.where(station_name: item.station_name).where(&quot;shares_percentage &gt; ? AND shares_percentage &lt; ?&quot;, item.worst_sp - 0.00001, item.worst_sp + 0.00001)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">            @worst_sp_dates.append(matched_dates)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">          # Get all dates that best closing percentage occurs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">          @best_cp_dates = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">          @reports_summarize.each do |item|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">            matched_dates = @reports_for_cart.where(station_name: item.station_name).where(&quot;closing_percentage &gt; ? AND closing_percentage &lt; ?&quot;, item.best_cp - 0.00001, item.best_cp + 0.00001)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">            @best_cp_dates.append(matched_dates)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">          # Get all dates that worst closing percentage occurs</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">          @worst_cp_dates = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">          @reports_summarize.each do |item|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">            matched_dates = @reports_for_cart.where(station_name: item.station_name).where(&quot;closing_percentage &gt; ? AND closing_percentage &lt; ?&quot;, item.worst_cp - 0.00001, item.worst_cp + 0.00001)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">            @worst_cp_dates.append(matched_dates)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">          if params[:station] == &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">            latest_date = @reports_for_cart.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">            @reports_for_cart = @reports_for_cart.where(published_at: latest_date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">      elsif date.present? &amp;&amp; search_type.present? &amp;&amp; search_type == &quot;Stock&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">        #@station_id = params[:station_id][&quot;id&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">        @reports_for_cart = MiReport.where(post_id: @post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">        @reports_for_cart = @reports_for_cart.where(station_id: @station.id, published_at: date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">        @reports = @reports_for_cart.order(&quot;stock_code ASC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">        @distinct_date = @reports_for_cart.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">    @report = @post.reports.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">    if request.post? &amp;&amp; params[:file].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">      csv_files = params[:file]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">      imported_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">      duplicated_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">      filtered_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">      no_row_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">      csv_files.each do |file|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">        # Prevent duplicated importing file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">        filename = sanitize_filename(file.original_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">        line_count = `wc -l &quot;#{file.path}&quot;`.strip.split(&#39; &#39;)[0].to_i - 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">        if YieldFile.exists?(file_name: filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">          duplicated_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">          respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">            format.json { render json: {error: filename + &#39; 發現重複匯入，已被略過！&#39;} }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">          next</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">        elsif line_count.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">          no_row_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">          respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">            format.json { render json: { error: filename + &#39;沒有資料，已被略過！&#39; } }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">          next</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">          model_stage = &#39;BFIAMU&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">          if post = Post.find_by_title(model_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">            Report.import_data(file.path, filename, post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">            # Check total imported row counts</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="196">
          
          
          <code class="ruby">            if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby">              count = Report.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">              # Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="200">
          
          
          <code class="ruby">              if count + 4 == file.total_row</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">                imported_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">                respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">                  format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">                # If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">                file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">                respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">                  format.json { render json: { error: &#39;從 &#39; + filename + &#39; 匯入資料時發生錯誤！&#39; } }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">            post = Post.create(title: model_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">            # Then import yield records</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">            Report.import_data(file.path, filename, post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">            # Check total imported row counts</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">            if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">              count = Report.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">              # Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">              if count.equal? file.total_row</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">                imported_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">                respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">                  format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">                # If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">                file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">                respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">                  format.json { render json: { error: &#39;從 &#39; + filename + &#39; 匯入資料時發生錯誤！&#39; } }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="233">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">  def sanitize_filename(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">    return filename.strip do |name|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">     # NOTE: File.basename doesn&#39;t work right with Windows paths on Unix</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">     # get only the filename, not the whole path</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">     name.gsub!(/^.*(\\|\/)/, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="247">
          
          
          <code class="ruby">     # Strip out the non-ascii character</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">     name.gsub!(/[^0-9A-Za-z.\-]/, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="250">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="759052937cc8cc653bc38de53e1b8b7de8235b61">
  <div class="header">
    <h3>app/controllers/stations_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>34</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>34</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class StationsController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">  	page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  	@product = Product.find(params[:product_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  	@post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">    @station = @post.stations.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    # Get reports by date is parameters present</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    build = params[:build].to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    if build == &#39;main&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      reports_by_all_config = @station.report_mains</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    elsif build == &#39;mini&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      reports_by_all_config = @station.report_minis</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      reports_by_all_config = @station.reports.where(config: &#39;ALL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    if params[:date] == &#39;today&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      @reports_for_cart = get_today_yield(@post, reports_by_all_config, build)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  	elsif params[:date] == &#39;yesterday&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">  	  @reports_for_cart = get_yesterday_yield(@post, reports_by_all_config, build)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    elsif params[:date_range].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      # For search feature! Show station&#39;s data with specific date from search box</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      the_date = params[:date_range]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      @reports_for_cart = get_target_date_yield(@post, reports_by_all_config, build, the_date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    else # Same as &#39;Today&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      @reports_for_cart = get_today_yield(@post, reports_by_all_config, build)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">	  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    reports_tmp = @reports_for_cart</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    @reports_for_cart = reports_tmp.order(&quot;published_at ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    @reports = reports_tmp.order(&quot;published_at DESC&quot;).page(page)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="387536a8591c34e2231d4e7ee624a6748c5421ef">
  <div class="header">
    <h3>app/controllers/yield_files_controller.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>49</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>49</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class YieldFilesController &lt; ApplicationController</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  before_filter :authenticate_user!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    page = (params[:page] || 1).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @files = @post.yield_files.order(&quot;published_at DESC&quot;).page(params[:page]).per(100)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    @file = @post.yield_files.find_by_id(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    if @file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      if @file.file_name.include? &quot;MI-INDEX&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">        @station_id = @file.file_name[9, 2].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">        @reports = @post.mi_reports.where(station_id: @station_id, yield_file_id: @file).order(&quot;station_id ASC&quot;).page(params[:page]).per(100)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        puts @station_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">        puts @reports.count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        @reports = @post.reports.where(yield_file_id: @file).order(&quot;station_id ASC&quot;).page(params[:page])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    #@reports = @post.mi_reports.order(&quot;published_at ASC&quot;).page(params[:page])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">  	@file = @post.yield_files.find(params[:id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    @file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">      format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      format.html { redirect_to my_post_path(@post), notice: &quot;Successfully removed &#39;#{@file.file_name}&#39;&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">      format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">  def destroy_multiple</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    @post = Post.find(params[:my_post_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    if params[:file_ids]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      YieldFile.where(id: params[:file_ids]).destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      #YieldFile.destroy_all(id: params[:file_ids])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      respond_to do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">        format.js { head :ok }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        format.html { redirect_to my_post_yield_files_path(@post), notice: &quot;Successfully removed #{params[:file_ids].count} selected files&quot; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        format.json { head :no_content }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="82d951be6091a3bd212bb6212f5658f626225c15">
  <div class="header">
    <h3>app/helpers/api/posts_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api::PostsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d02d137b92a6df7b0280cd2e0cfce974f69a06e9">
  <div class="header">
    <h3>app/helpers/api/v1/my_posts_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api::V1::MyPostsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="55d600137ab9a38fb4adbf89b3554fb3b61dde94">
  <div class="header">
    <h3>app/helpers/api/v1/posts_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api::V1::PostsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="815575aa0ae79f0513d5197d14e182cbedbef763">
  <div class="header">
    <h3>app/helpers/api/v1/reports_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api::V1::ReportsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f2e732fd31864e763e85bd7f47d1577168ce4c40">
  <div class="header">
    <h3>app/helpers/api/v1/users_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api::V1::UsersHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="db3caa3f2281397e2a643476f3f20df3134e5093">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4><span class="red">45.83 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ApplicationHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def title</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    site_title = &quot;Jt Stock&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    if @title.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      site_title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">      &quot;#{site_title} | #{@title}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  # For breadcrumbs</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def ensure_navigation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    @navigation ||= [ { :title =&gt; &#39;Home&#39;, :url =&gt; &#39;/&#39; } ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def navigation_add(title, url)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">  	ensure_navigation &lt;&lt; { :title =&gt; title, :url =&gt; url }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_navigation</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  	render :partial =&gt; &#39;layouts/navigation&#39;, :locals =&gt; { :nav =&gt; ensure_navigation }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_yield_rate(yield_rate)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    render :partial =&gt; &#39;layouts/yield_rate&#39;, locals: { yield_rate: yield_rate }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_up_down(ad_idx)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    render :partial =&gt; &#39;layouts/up_down&#39;, locals: { ad_idx: ad_idx }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_class(link_path)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    current_page?(link_path) ? &quot;active&quot; : &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_config_counts(report)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    return MiReport.where(&#39;post_id = ? AND station_id = ? AND published_at = ?&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      report.post_id, report.station_id, report.published_at).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_main_mini_config_counts(report)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    return Report.where(&#39;post_id = ? AND config IN (?) AND station_name = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour = ?&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      report.post_id, report.config.split(&#39;;&#39;), report.station_name, report.p_year, report.p_month, report.p_mday, report.p_hour).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def total_yield_counts(post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    return post.reports.where(config: &#39;ALL&#39;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="426f59710c3a0cf9749135204fd4863eea26a08b">
  <div class="header">
    <h3>app/helpers/configs_helper.rb</h3>
    <h4><span class="red">7.77 %</span> covered</h4>
    <div>
      <b>103</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>95</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ConfigsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def worst_config_yield_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    start_time = reports.last.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    end_time = reports.first.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    post_id = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    if controller.controller_name == &quot;reports&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      # For search build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      datetime = reports.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      # For general build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      datetime = Report.where(&quot;post_id = ? AND config = ? AND published_at BETWEEN ? AND ?&quot;, post_id, &#39;ALL&#39;, start_time, end_time).select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    datetime.map do |date|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      published_at: date.published_at.to_datetime.to_formatted_s(:long),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # No.1 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      worst_accu_yield: Report.group_station_accu_yield_by_date(date.published_at, station).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      worst_daily_yield: Report.group_station_daily_yield_by_date(date.published_at, station).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      worst_fp_accu_yield: Report.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      worst_fp_daily_yield: Report.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      worst_accu_config: Report.group_station_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      worst_daily_config: Report.group_station_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      worst_fp_accu_config: Report.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      worst_fp_daily_config: Report.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      # No.2 Worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      worse_accu_yield: Report.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      worse_daily_yield: Report.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      worse_fp_accu_yield: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      worse_fp_daily_yield: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      worse_accu_config: Report.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      worse_daily_config: Report.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      worse_fp_accu_config: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      worse_fp_daily_config: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      # No.3 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      bad_accu_yield: Report.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      bad_daily_yield: Report.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      bad_fp_accu_yield: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      bad_fp_daily_yield: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      bad_accu_config: Report.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      bad_daily_config: Report.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      bad_fp_accu_config: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      bad_fp_daily_config: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      # No.4 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      bad2_accu_yield: Report.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      bad2_daily_yield: Report.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      bad2_fp_accu_yield: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      bad2_fp_daily_yield: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      bad2_accu_config: Report.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      bad2_daily_config: Report.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      bad2_fp_accu_config: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      bad2_fp_daily_config: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      # No.5 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      bad3_accu_yield: Report.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      bad3_daily_yield: Report.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      bad3_fp_accu_yield: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      bad3_fp_daily_yield: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      bad3_accu_config: Report.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      bad3_daily_config: Report.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      bad3_fp_accu_config: Report.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      bad3_fp_daily_config: Report.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def worst_config_yield_chart_main_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    start_time = reports.last.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">    end_time = reports.first.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">    post_id = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    if controller.controller_name == &quot;reports&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      # For search build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      datetime = reports.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">      datetime = ReportMain.where(&quot;post_id = ? AND published_at BETWEEN ? AND ?&quot;, post_id, start_time, end_time).select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">    datetime.map do |date|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      published_at: date.published_at.to_datetime.to_formatted_s(:long),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      # No.1 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      worst_accu_yield: ReportMain.group_station_accu_yield_by_date(date.published_at, station).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      worst_daily_yield: ReportMain.group_station_daily_yield_by_date(date.published_at, station).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      worst_fp_accu_yield: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      worst_fp_daily_yield: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      worst_accu_config: ReportMain.group_station_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      worst_daily_config: ReportMain.group_station_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      worst_fp_accu_config: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      worst_fp_daily_config: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      # No.2 Worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      worse_accu_yield: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      worse_daily_yield: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      worse_fp_accu_yield: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      worse_fp_daily_yield: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      worse_accu_config: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      worse_daily_config: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      worse_fp_accu_config: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      worse_fp_daily_config: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      # No.3 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      bad_accu_yield: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">      bad_daily_yield: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      bad_fp_accu_yield: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      bad_fp_daily_yield: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      bad_accu_config: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      bad_daily_config: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      bad_fp_accu_config: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">      bad_fp_daily_config: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      # No.4 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      bad2_accu_yield: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      bad2_daily_yield: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">      bad2_fp_accu_yield: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      bad2_fp_daily_yield: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      bad2_accu_config: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      bad2_daily_config: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">      bad2_fp_accu_config: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      bad2_fp_daily_config: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      # No.5 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">      bad3_accu_yield: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      bad3_daily_yield: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      bad3_fp_accu_yield: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      bad3_fp_daily_yield: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">      bad3_accu_config: ReportMain.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      bad3_daily_config: ReportMain.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      bad3_fp_accu_config: ReportMain.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      bad3_fp_daily_config: ReportMain.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def worst_config_yield_chart_mini_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">    start_time = reports.last.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">    end_time = reports.first.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">    post_id = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">    if controller.controller_name == &quot;reports&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">      # For search build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">      datetime = reports.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">      datetime = ReportMini.where(&quot;post_id = ? AND published_at BETWEEN ? AND ?&quot;, post_id, start_time, end_time).select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    datetime.map do |date|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">      published_at: date.published_at.to_datetime.to_formatted_s(:long),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">      # No.1 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">      worst_accu_yield: ReportMini.group_station_accu_yield_by_date(date.published_at, station).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">      worst_daily_yield: ReportMini.group_station_daily_yield_by_date(date.published_at, station).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">      worst_fp_accu_yield: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">      worst_fp_daily_yield: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      worst_accu_config: ReportMini.group_station_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">      worst_daily_config: ReportMini.group_station_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">      worst_fp_accu_config: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      worst_fp_daily_config: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">      # No.2 Worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">      worse_accu_yield: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">      worse_daily_yield: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">      worse_fp_accu_yield: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      worse_fp_daily_yield: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">      worse_accu_config: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      worse_daily_config: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      worse_fp_accu_config: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      worse_fp_daily_config: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(1).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      # No.3 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">      bad_accu_yield: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">      bad_daily_yield: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">      bad_fp_accu_yield: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">      bad_fp_daily_yield: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">      bad_accu_config: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">      bad_daily_config: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">      bad_fp_accu_config: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">      bad_fp_daily_config: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(2).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">      # No.4 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      bad2_accu_yield: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      bad2_daily_yield: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">      bad2_fp_accu_yield: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">      bad2_fp_daily_yield: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      bad2_accu_config: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      bad2_daily_config: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">      bad2_fp_accu_config: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">      bad2_fp_daily_config: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(3).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      # No.5 worst yield rate &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      bad3_accu_yield: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">      bad3_daily_yield: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">      bad3_fp_accu_yield: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_accu_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">      bad3_fp_daily_yield: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:worst_fp_daily_yield),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">      bad3_accu_config: ReportMini.group_station_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">      bad3_daily_config: ReportMini.group_station_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">      bad3_fp_accu_config: ReportMini.group_station_fp_accu_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">      bad3_fp_daily_config: ReportMini.group_station_fp_daily_yield_by_date(date.published_at, station).offset(4).first.try(:config) || &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">  def accu_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">    datetime = reports.first.published_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    # overflow_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt; ?&quot;, &#39;ALL&#39;, station, datetime, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    # great_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 99.51, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">    # bad_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 90.00, 99.50).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">    # worse_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 0.00, 89.99).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    # no_input_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate IS NULL&quot;, &#39;ALL&#39;, station, datetime).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">    overflow_accu_yield = reports.where(&quot;yield_rate &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">    great_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">    bad_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">    worse_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">    no_input_yield = reports.where(&quot;yield_rate IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">    overflow_accu_yield_rate = ((overflow_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">    great_accu_yield_rate = ((great_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">    bad_accu_yield_rate = ((bad_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    worse_accu_yield_rate = ((worse_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">    range_array = [overflow_accu_yield, great_accu_yield, bad_accu_yield, worse_accu_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">    title = [&#39;Overflow Accu Yield&#39;, &#39;Verified Accu Yield&#39;, &#39;Bad Accu Yield&#39;, &#39;Worse Accu Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">    percent = [overflow_accu_yield_rate, great_accu_yield_rate, bad_accu_yield_rate, worse_accu_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">  def daily_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">    datetime = reports.first.published_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby">    # overflow_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt; ?&quot;, &#39;ALL&#39;, station, datetime, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="231">
          
          
          <code class="ruby">    # great_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 99.51, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    # bad_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 90.00, 99.50).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">    # worse_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 0.00, 89.99).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">    # no_input_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today IS NULL&quot;, &#39;ALL&#39;, station, datetime).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">    overflow_daily_yield = reports.where(&quot;yield_rate_today &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">    great_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">    bad_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">    worse_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">    no_input_yield = reports.where(&quot;yield_rate_today IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">    overflow_daily_yield_rate = ((overflow_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">    great_daily_yield_rate = ((great_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">    bad_daily_yield_rate = ((bad_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">    worse_daily_yield_rate = ((worse_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">    range_array = [overflow_daily_yield, great_daily_yield, bad_daily_yield, worse_daily_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">    title = [&#39;Overflow Daily Yield&#39;, &#39;Verified Daily Yield&#39;, &#39;Bad Daily Yield&#39;, &#39;Worse Daily Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="250">
          
          
          <code class="ruby">    percent = [overflow_daily_yield_rate, great_daily_yield_rate, bad_daily_yield_rate, worse_daily_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="252">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="258">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="260">
          <span class="hits">1</span>
          
          <code class="ruby">  def fp_accu_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="261">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="262">
          
          
          <code class="ruby">    datetime = reports.first.published_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">    # overflow_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt; ?&quot;, &#39;ALL&#39;, station, datetime, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">    # great_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 99.51, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">    # bad_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 90.00, 99.50).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby">    # worse_accu_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 0.00, 89.99).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">    # no_input_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate IS NULL&quot;, &#39;ALL&#39;, station, datetime).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">    overflow_accu_yield = reports.where(&quot;fp_yield_rate &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">    great_accu_yield = reports.where(&quot;fp_yield_rate &gt;= ? AND fp_yield_rate &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">    bad_accu_yield = reports.where(&quot;fp_yield_rate &gt;= ? AND fp_yield_rate &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">    worse_accu_yield = reports.where(&quot;fp_yield_rate &gt;= ? AND fp_yield_rate &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">    no_input_yield = reports.where(&quot;fp_yield_rate IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="275">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">    overflow_accu_yield_rate = ((overflow_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">    great_accu_yield_rate = ((great_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">    bad_accu_yield_rate = ((bad_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">    worse_accu_yield_rate = ((worse_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">    range_array = [overflow_accu_yield, great_accu_yield, bad_accu_yield, worse_accu_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">    title = [&#39;Overflow FP Accu Yield&#39;, &#39;Verified FP Accu Yield&#39;, &#39;Bad FP Accu Yield&#39;, &#39;Worse FP Accu Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">    percent = [overflow_accu_yield_rate, great_accu_yield_rate, bad_accu_yield_rate, worse_accu_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="287">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="292">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">  def fp_daily_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">    datetime = reports.first.published_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    # overflow_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt; ?&quot;, &#39;ALL&#39;, station, datetime, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby">    # great_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 99.51, 100.00).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="300">
          
          
          <code class="ruby">    # bad_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 90.00, 99.50).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    # worse_daily_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, &#39;ALL&#39;, station, datetime, 0.00, 89.99).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">    # no_input_yield = Report.where(&quot;config != ? AND station_name = ? AND published_at = ? AND yield_rate_today IS NULL&quot;, &#39;ALL&#39;, station, datetime).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">    overflow_daily_yield = reports.where(&quot;fp_yield_rate_today &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">    great_daily_yield = reports.where(&quot;fp_yield_rate_today &gt;= ? AND fp_yield_rate_today &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">    bad_daily_yield = reports.where(&quot;fp_yield_rate_today &gt;= ? AND fp_yield_rate_today &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">    worse_daily_yield = reports.where(&quot;fp_yield_rate_today &gt;= ? AND fp_yield_rate_today &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">    no_input_yield = reports.where(&quot;fp_yield_rate_today IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby">    overflow_daily_yield_rate = ((overflow_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">    great_daily_yield_rate = ((great_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="312">
          
          
          <code class="ruby">    bad_daily_yield_rate = ((bad_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="313">
          
          
          <code class="ruby">    worse_daily_yield_rate = ((worse_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="315">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="316">
          
          
          <code class="ruby">    range_array = [overflow_daily_yield, great_daily_yield, bad_daily_yield, worse_daily_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">    title = [&#39;Overflow FP Daily Yield&#39;, &#39;Verified FP Daily Yield&#39;, &#39;Bad FP Daily Yield&#39;, &#39;Worse FP Daily Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">    percent = [overflow_daily_yield_rate, great_daily_yield_rate, bad_daily_yield_rate, worse_daily_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="319">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="321">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="325">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b3ab2cd9db5c4d8c8ba3d6e0c07276feb2b5d15f">
  <div class="header">
    <h3>app/helpers/errors_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ErrorsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9f085859eefdd0a6e5a4754d13999a48f4cb7e1e">
  <div class="header">
    <h3>app/helpers/main_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MainHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a1f54cf83a2b509c3fbec1ec35d9cacd96b795fa">
  <div class="header">
    <h3>app/helpers/mi_reports_helper.rb</h3>
    <h4><span class="red">20.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MiReportsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def config_best_percentage_chart_data(reports, station_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    start_time = reports.last.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    end_time = reports.first.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    post_id = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    if controller.controller_name == &quot;reports&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      # For search build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      datetime = reports.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      # For general build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      datetime = MiReport.where(&quot;post_id = ? AND published_at BETWEEN ? AND ?&quot;, post_id, start_time, end_time).select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    datetime.map do |date|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      published_at: date.published_at.to_datetime.to_formatted_s(:long),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # Top1 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      best1_shares_percentage: MiReport.group_sp_by_date(date.published_at, station_id).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      best1_closing_percentage: MiReport.group_cp_by_date(date.published_at, station_id).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      best1_shares_percentage_index: MiReport.group_sp_by_date(date.published_at, station_id).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      best1_closing_percentage_index: MiReport.group_cp_by_date(date.published_at, station_id).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      # Top2 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      best2_shares_percentage: MiReport.group_sp_by_date(date.published_at, station_id).offset(1).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      best2_closing_percentage: MiReport.group_cp_by_date(date.published_at, station_id).offset(1).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      best2_shares_percentage_index: MiReport.group_sp_by_date(date.published_at, station_id).offset(1).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      best2_closing_percentage_index: MiReport.group_cp_by_date(date.published_at, station_id).offset(1).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      # Top3 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      best3_shares_percentage: MiReport.group_sp_by_date(date.published_at, station_id).offset(2).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      best3_closing_percentage: MiReport.group_cp_by_date(date.published_at, station_id).offset(2).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      best3_shares_percentage_index: MiReport.group_sp_by_date(date.published_at, station_id).offset(2).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      best3_closing_percentage_index: MiReport.group_cp_by_date(date.published_at, station_id).offset(2).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      # Top4 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      best4_shares_percentage: MiReport.group_sp_by_date(date.published_at, station_id).offset(3).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      best4_closing_percentage: MiReport.group_cp_by_date(date.published_at, station_id).offset(3).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      best4_shares_percentage_index: MiReport.group_sp_by_date(date.published_at, station_id).offset(3).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      best4_closing_percentage_index: MiReport.group_cp_by_date(date.published_at, station_id).offset(3).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      # Top5 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      best5_shares_percentage: MiReport.group_sp_by_date(date.published_at, station_id).offset(4).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      best5_closing_percentage: MiReport.group_cp_by_date(date.published_at, station_id).offset(4).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      best5_shares_percentage_index: MiReport.group_sp_by_date(date.published_at, station_id).offset(4).first.try(:stock_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      best5_closing_percentage_index: MiReport.group_cp_by_date(date.published_at, station_id).offset(4).first.try(:stock_name),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b44cf0506e2055b04cc8477eec751832b17ff9fa">
  <div class="header">
    <h3>app/helpers/my_posts_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MyPostsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="30e4e0b33da68d04d4fc268b9194f1816f59ba4f">
  <div class="header">
    <h3>app/helpers/omniauth_callbacks_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module OmniauthCallbacksHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c784c459be0fd0cbee8dede02a6f5089c0a9dd60">
  <div class="header">
    <h3>app/helpers/posts_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module PostsHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="65b1f8d39e80adeda86ac734fd809aed1e527a55">
  <div class="header">
    <h3>app/helpers/reports_helper.rb</h3>
    <h4><span class="red">6.45 %</span> covered</h4>
    <div>
      <b>62</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>58</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ReportsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def best_percentage_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    start_time = reports.last.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    end_time = reports.first.published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    post_id = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    if controller.controller_name == &quot;reports&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      # For search build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      datetime = reports.select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      # For general build page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      datetime = Report.where(&quot;post_id = ? AND published_at BETWEEN ? AND ?&quot;, post_id, start_time, end_time).select(&quot;distinct(published_at)&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    datetime.map do |date|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      published_at: date.published_at.to_datetime.to_formatted_s(:long),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      # Top1 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      best1_shares_percentage: Report.group_shares_percentage_by_date(date.published_at).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      best1_closing_percentage: Report.group_closing_percentage_by_date(date.published_at).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      best1_shares_percentage_index: Report.group_shares_percentage_by_date(date.published_at).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      best1_closing_percentage_index: Report.group_closing_percentage_by_date(date.published_at).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      # Top2 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      best2_shares_percentage: Report.group_shares_percentage_by_date(date.published_at).offset(1).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      best2_closing_percentage: Report.group_closing_percentage_by_date(date.published_at).offset(1).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      best2_shares_percentage_index: Report.group_shares_percentage_by_date(date.published_at).offset(1).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      best2_closing_percentage_index: Report.group_closing_percentage_by_date(date.published_at).offset(1).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      # Top3 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      best3_shares_percentage: Report.group_shares_percentage_by_date(date.published_at).offset(2).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      best3_closing_percentage: Report.group_closing_percentage_by_date(date.published_at).offset(2).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      best3_shares_percentage_index: Report.group_shares_percentage_by_date(date.published_at).offset(2).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      best3_closing_percentage_index: Report.group_closing_percentage_by_date(date.published_at).offset(2).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      # Top4 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      best4_shares_percentage: Report.group_shares_percentage_by_date(date.published_at).offset(3).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      best4_closing_percentage: Report.group_closing_percentage_by_date(date.published_at).offset(3).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      best4_shares_percentage_index: Report.group_shares_percentage_by_date(date.published_at).offset(3).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      best4_closing_percentage_index: Report.group_closing_percentage_by_date(date.published_at).offset(3).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      # Top5 shares percentage &amp; closing percentage &amp; station name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      best5_shares_percentage: Report.group_shares_percentage_by_date(date.published_at).offset(4).first.try(:best_shares_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      best5_closing_percentage: Report.group_closing_percentage_by_date(date.published_at).offset(4).first.try(:best_closing_percentage),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      best5_shares_percentage_index: Report.group_shares_percentage_by_date(date.published_at).offset(4).first.try(:station_name),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      best5_closing_percentage_index: Report.group_closing_percentage_by_date(date.published_at).offset(4).first.try(:station_name),</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def config_accu_yield_bar_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">    config = reports.first.config</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    datetime_start = reports.minimum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">    datetime_end = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # If parameter present, show each hour&#39;s report</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">      overflow_accu_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate &gt; ?&quot;, config, station, datetime_start, datetime_end, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">      great_accu_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, config, station, datetime_start, datetime_end, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      bad_accu_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, config, station, datetime_start, datetime_end, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">      worse_accu_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, config, station, datetime_start, datetime_end, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      no_input_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate IS NULL&quot;, config, station, datetime_start, datetime_end).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      # By default, only show latest hour&#39;s report for each day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">      overflow_accu_yield = reports.where(&quot;yield_rate &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">      great_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      bad_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">      worse_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;yield_rate IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    overflow_accu_yield_rate = ((overflow_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">    great_accu_yield_rate = ((great_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">    bad_accu_yield_rate = ((bad_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">    worse_accu_yield_rate = ((worse_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">    range_array = [overflow_accu_yield, great_accu_yield, bad_accu_yield, worse_accu_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">    title = [&#39;Overflow Accu Yield&#39;, &#39;Verified Accu Yield&#39;, &#39;Bad Accu Yield&#39;, &#39;Worse Accu Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">    percent = [overflow_accu_yield_rate, great_accu_yield_rate, bad_accu_yield_rate, worse_accu_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def config_daily_yield_bar_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">    config = reports.first.config</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">    datetime_start = reports.minimum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">    datetime_end = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">    if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      # If parameter present, show each hour&#39;s report</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">      overflow_daily_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate_today &gt; ?&quot;, config, station, datetime_start, datetime_end, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">      great_daily_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, config, station, datetime_start, datetime_end, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">      bad_daily_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, config, station, datetime_start, datetime_end, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">      worse_daily_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, config, station, datetime_start, datetime_end, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">      no_input_yield = Report.where(&quot;config = ? AND station_name = ? AND published_at BETWEEN ? AND ? AND yield_rate_today IS NULL&quot;, config, station, datetime_start, datetime_end).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      # By default, only show latest hour&#39;s report for each day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">      overflow_daily_yield = reports.where(&quot;yield_rate_today &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">      great_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">      bad_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">      worse_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;yield_rate_today IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    overflow_daily_yield_rate = ((overflow_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">    great_daily_yield_rate = ((great_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">    bad_daily_yield_rate = ((bad_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">    worse_daily_yield_rate = ((worse_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">    range_array = [overflow_daily_yield, great_daily_yield, bad_daily_yield, worse_daily_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">    title = [&#39;Overflow Daily Yield&#39;, &#39;Verified Daily Yield&#39;, &#39;Bad Daily Yield&#39;, &#39;Worse Daily Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">    percent = [overflow_daily_yield_rate, great_daily_yield_rate, bad_daily_yield_rate, worse_daily_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="eab66f54e213057dbb57010165fad9657f74f05a">
  <div class="header">
    <h3>app/helpers/stations_helper.rb</h3>
    <h4><span class="red">5.66 %</span> covered</h4>
    <div>
      <b>53</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>50</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">module StationsHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def station_accu_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    build = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    datetime_start = reports.minimum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    datetime_end = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    if params[:data_period].present? &amp;&amp; params[:data_period] == &quot;hourly&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      # If parameter present, show each hour&#39;s report</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      overflow_accu_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate &gt; ?&quot;, datetime_start, datetime_end, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      great_accu_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, datetime_start, datetime_end, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      bad_accu_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, datetime_start, datetime_end, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      worse_accu_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, datetime_start, datetime_end, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate IS NULL&quot;, datetime_start, datetime_end).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # By default, only show latest hour&#39;s report for each day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      overflow_accu_yield = reports.where(&quot;yield_rate &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      great_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      bad_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      worse_accu_yield = reports.where(&quot;yield_rate &gt;= ? AND yield_rate &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;yield_rate IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    overflow_accu_yield_rate = ((overflow_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    great_accu_yield_rate = ((great_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    bad_accu_yield_rate = ((bad_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">    worse_accu_yield_rate = ((worse_accu_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    range_array = [overflow_accu_yield, great_accu_yield, bad_accu_yield, worse_accu_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    title = [&#39;Overflow Accu Yield&#39;, &#39;Verified Accu Yield&#39;, &#39;Bad Accu Yield&#39;, &#39;Worst Accu Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    percent = [overflow_accu_yield_rate, great_accu_yield_rate, bad_accu_yield_rate, worse_accu_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def station_daily_yield_ratio_chart_data(reports)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    station = reports.first.station_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">    build = reports.first.post_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">    datetime_start = reports.minimum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    datetime_end = reports.maximum(&#39;published_at&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">    if params[:hourly_data].present? &amp;&amp; params[:hourly_data] != &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      # If parameter present, show each hour&#39;s report</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      overflow_daily_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate_today &gt; ?&quot;, datetime_start, datetime_end, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      great_daily_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, datetime_start, datetime_end, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      bad_daily_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, datetime_start, datetime_end, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      worse_daily_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, datetime_start, datetime_end, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;published_at BETWEEN ? AND ? AND yield_rate_today IS NULL&quot;, datetime_start, datetime_end).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      # By default, only show latest hour&#39;s report for each day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">      overflow_daily_yield = reports.where(&quot;yield_rate_today &gt; ?&quot;, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      great_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 99.51, 100.00).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">      bad_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 90.00, 99.50).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      worse_daily_yield = reports.where(&quot;yield_rate_today &gt;= ? AND yield_rate_today &lt;= ?&quot;, 0.00, 89.99).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">      no_input_yield = reports.where(&quot;yield_rate_today IS NULL&quot;).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">    overflow_daily_yield_rate = ((overflow_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    great_daily_yield_rate = ((great_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">    bad_daily_yield_rate = ((bad_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">    worse_daily_yield_rate = ((worse_daily_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">    no_input_yield_rate = ((no_input_yield.to_f / reports.count.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">    range_array = [overflow_daily_yield, great_daily_yield, bad_daily_yield, worse_daily_yield, no_input_yield]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">    title = [&#39;Overflow Daily Yield&#39;, &#39;Verified Daily Yield&#39;, &#39;Bad Daily Yield&#39;, &#39;Worst Daily Yield&#39;, &#39;No Input&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">    percent = [overflow_daily_yield_rate, great_daily_yield_rate, bad_daily_yield_rate, worse_daily_yield_rate, no_input_yield_rate]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">    range_array.map.with_index do |range, index| {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      value: range,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      label: title[index],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      percent: percent[index]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f2d0524a9d6530fa5458a37c3b8caea36f2b5374">
  <div class="header">
    <h3>app/models/admin_user.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AdminUser &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Include default devise modules. Others available are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # :token_authenticatable, :encryptable, :confirmable, :lockable, :timeoutable and :omniauthable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">         :recoverable, :rememberable, :trackable, :validatable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # Setup accessible (or protected) attributes for your model</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :email, :password, :password_confirmation, :remember_me</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # attr_accessible :title, :body</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fe5c4c68060d328e56dfa681ee829af13bc3ef3a">
  <div class="header">
    <h3>app/models/api_error.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ApiError</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  attr_accessor :error, :error_description, :messages</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def self.json(error, error_description, messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    self.new(error, error_description, messages).to_json</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  def initialize(error, error_description, messages)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    @error = error</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    @error_description = error_description</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    @messages = messages</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4eb4d3c3ccaec110269780a53b1638b7b127b820">
  <div class="header">
    <h3>app/models/apn_client.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class APNClient &lt; Houston::Client</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  def initialize(cert)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">    @gateway_uri = Houston::Client.development.gateway_uri</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @feedback_uri = Houston::Client.development.feedback_uri</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">    @certificate = File.read(ENV[&#39;APPLE_CERTIFICATE&#39;]) #certificate from prerequisites</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">    @timeout = Float(ENV[&#39;APN_TIMEOUT&#39;] || 0.5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"> </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  def self.apple_feedback()</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">    APNClient.new(ENV[&#39;APPLE_CERTIFICATE&#39;]).devices.each do |uuid|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      device = Device.find_by_uuid(uuid)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      device.destroy unless device.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1fac0fea29f73f94334f155f58e5207cd855f324">
  <div class="header">
    <h3>app/models/device.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Device &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  attr_accessible :enabled, :uuid, :user_id, :platform</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  validates_uniqueness_of :uuid, scope: :user_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2cca7db0f44afb2c1a1bb30a63051897fafbb1c4">
  <div class="header">
    <h3>app/models/facebook_user.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>35</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class FacebookUser</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  attr_accessor :id, :name, :first_name, :last_name, :username, :gender</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  def initialize(hash = {})</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">    @hash = hash</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  def id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">    @hash[:id.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  def name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    @hash[:name.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">  def first_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    @hash[:first_name.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">  def last_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">    @hash[:last_name.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">  def username</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    @hash[:username.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">  def gender</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">    @hash[:gender.to_s]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">  def inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    @hash.inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="91431aa5f22685aa1e25ae3e391c50c12c9d947b">
  <div class="header">
    <h3>app/models/mi_report.rb</h3>
    <h4><span class="yellow">81.82 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>45</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;activerecord-import/base&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveRecord::Import.require_adapter(&#39;mysql2&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">class MiReport &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :post_id, :yield_file_id, :station_id, :stock_code, :stock_name, :traded_volume, :total_transactions, :turnover, :opening_price, :highest_price, :lowest_price, :closing_price, :ups_and_downs, :change, :last_best_bid_price, :last_best_bid_qty, :last_best_ask_price, :last_best_ask_qty, :pice_earnings_ratio, :shares_percentage, :closing_percentage, :published_at, :created_at, :updated_at</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :yield_file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :station</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :post_id, :yield_file_id, :station_id, :stock_code, :stock_name, :traded_volume, :total_transactions, :turnover, :opening_price, :highest_price, :lowest_price, :closing_price, :ups_and_downs, :change, :last_best_bid_price, :last_best_bid_qty, :last_best_ask_price, :last_best_ask_qty, :pice_earnings_ratio, :shares_percentage, :closing_percentage, :published_at, :created_at, :updated_at, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  paginates_per 1000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.group_sp_by_date(date_time, station_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    reports = where(&quot;station_id = ? AND published_at = ?&quot;, station_id, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    reports = reports.group(&quot;stock_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    reports = reports.select(&quot;stock_name, max(shares_percentage) as best_shares_percentage&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">    reports = reports.order(&quot;best_shares_percentage DESC&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.group_cp_by_date(date_time, station_id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    reports = where(&quot;station_id = ? AND published_at = ?&quot;, station_id, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    reports = reports.group(&quot;stock_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    reports = reports.select(&quot;stock_name, max(closing_percentage) as best_closing_percentage&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    reports = reports.order(&quot;best_closing_percentage DESC&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # The &#39;import&#39; function can be used both on web and rake script</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.import_data(file, filename, post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    # Check filename</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    if csvfile = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      yf_id = csvfile.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      line_count = CSV.open(file, &quot;r&quot;, :encoding =&gt; &#39;big5&#39;).readlines.count - 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      file_date = Time.parse(filename[12, 8]).strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      yield_file = YieldFile.create(post_id: post.id, file_name: filename, total_row: line_count, published_at: file_date)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      yf_id = yield_file.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    GC.disable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    Report.transaction do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      records = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">      columns = [:post_id, :yield_file_id, :station_id, :stock_code, :stock_name, :traded_volume, :total_transactions, :turnover, :opening_price, :highest_price, :lowest_price, :closing_price, :ups_and_downs, :change, :last_best_bid_price, :last_best_bid_qty, :last_best_ask_price, :last_best_ask_qty, :pice_earnings_ratio, :shares_percentage, :closing_percentage, :published_at]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      # Define CSV header columns</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      column_header = [&#39;證券代號&#39;, &#39;證券名稱&#39;, &#39;成交股數&#39;, &#39;成交筆數&#39;, &#39;成交金額&#39;, &#39;開盤價&#39;, &#39;最高價&#39;, &#39;最低價&#39;, &#39;收盤價&#39;, &#39;漲跌&#39;, &#39;漲跌價差&#39;, &#39;最後揭示買價&#39;, &#39;最後揭示買量&#39;, &#39;最後揭示賣價&#39;, &#39;最後揭示賣量&#39;, &#39;本益比&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      # Define mapping table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">      index_name_table=  [&#39;N/A&#39;, &#39;水泥類指數&#39;, &#39;食品類指數&#39;, &#39;塑膠類指數&#39;, &#39;紡織纖維類指數&#39;, &#39;電機機械類指數&#39;, &#39;電器電纜類指數&#39;, &#39;化學生技醫療類指數&#39;, &#39;玻璃陶瓷類指數&#39;, &#39;造紙類指數&#39;, &#39;鋼鐵類指數&#39;, &#39;橡膠類指數&#39;, &#39;汽車類指數&#39;, &#39;電子類指數&#39;, &#39;建材營造類指數&#39;, &#39;航運業類指數&#39;, &#39;觀光事業類指數&#39;, &#39;金融保險類指數&#39;, &#39;貿易百貨類指數&#39;, &#39;N/A&#39;, &#39;其他類指數&#39;, &#39;化學類指數&#39;, &#39;生技醫療類指數&#39;, &#39;油電燃氣類指數&#39;, &#39;半導體類指數&#39;, &#39;電腦及週邊設備類指數&#39;, &#39;光電類指數&#39;, &#39;通信網路類指數&#39;, &#39;電子零組件類指數&#39;, &#39;電子通路類指數&#39;, &#39;資訊服務類指數&#39;, &#39;其他電子類指數&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      sum_of_shares = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      sum_of_closing = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;big5&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: column_header}).with_index(0) do |row, rowno|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">          # We only need data from row &quot;水泥類指數&quot; to &quot;其他類指數&quot;</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="55">
          <span class="hits">21</span>
          
          <code class="ruby">          if rowno &gt; 2 and rowno &lt; line_count.to_i-4</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="56">
          <span class="hits">12</span>
          
          <code class="ruby">          	sum_of_shares += row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_i</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="57">
          <span class="hits">12</span>
          
          <code class="ruby">            sum_of_closing += row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;big5&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: column_header}).with_index(0) do |row, rowno|</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="62">
          <span class="hits">21</span>
          
          <code class="ruby">        if rowno &gt; 2 and rowno &lt; line_count.to_i-4</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="63">
          <span class="hits">12</span>
          
          <code class="ruby">          csv_type_num = filename[9, 2].to_i</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="64">
          <span class="hits">12</span>
          
          <code class="ruby">          station = Station.find_by_name_and_post_id(index_name_table[csv_type_num], post.id)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="65">
          <span class="hits">12</span>
          
          <code class="ruby">          sta_id = station.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="67">
          <span class="hits">12</span>
          
          <code class="ruby">          shares_percentage = ((row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_f / sum_of_shares.to_f) * 100).round(2)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="68">
          <span class="hits">12</span>
          
          <code class="ruby">          closing_percentage = ((row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_f / sum_of_closing.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="70">
          <span class="hits">12</span>
          
          <code class="ruby">          if row[&#39;本益比&#39;].to_s == &quot;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">          	row[&#39;本益比&#39;] = &#39;999999999&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="74">
          <span class="hits">12</span>
          
          <code class="ruby">          time_now = Time.now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="75">
          <span class="hits">12</span>
          
          <code class="ruby">          record = [post.id, yf_id, sta_id, row[&#39;證券代號&#39;], row[&#39;證券名稱&#39;].strip.to_s, row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;成交筆數&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;開盤價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;最高價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;最低價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;收盤價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;漲跌&#39;].strip.to_s, row[&#39;漲跌價差&#39;], row[&#39;最後揭示買價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;最後揭示買量&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;最後揭示賣價&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;最後揭示賣量&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_s.gsub(&#39;--&#39;, &#39;999999999&#39;), row[&#39;本益比&#39;].gsub(&#39;,&#39;, &#39;&#39;), </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">            shares_percentage, closing_percentage,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">            Time.parse(filename[12, 8]).strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">            time_now, time_now]</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="79">
          <span class="hits">12</span>
          
          <code class="ruby">          records &lt;&lt; record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="83">
          <span class="hits">13</span>
          
          <code class="ruby">      values = records.map{ |record| &quot;(#{record[0]}, #{record[1]}, #{record[2]}, &#39;#{record[3]}&#39;, &#39;#{record[4]}&#39;, #{record[5]}, #{record[6]}, #{record[7]}, #{record[8]}, #{record[9]}, #{record[10]}, #{record[11]}, &#39;#{record[12]}&#39;, #{record[13]}, #{record[14]}, #{record[15]}, #{record[16]}, #{record[17]}, #{record[18]}, #{record[19]}, #{record[20]}, &#39;#{record[21]}&#39;, &#39;#{record[22]}&#39;, &#39;#{record[23]}&#39;)&quot; }.join(&quot;,&quot;).gsub(&#39;999999999&#39;, &#39;NULL&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">      sql = &quot;INSERT INTO `#{self.table_name}` (`post_id`,`yield_file_id`,`station_id`,`stock_code`,`stock_name`,`traded_volume`,`total_transactions`,`turnover`,`opening_price`,`highest_price`,`lowest_price`,`closing_price`,`ups_and_downs`,`change`,`last_best_bid_price`,`last_best_bid_qty`,`last_best_ask_price`,`last_best_ask_qty`,`pice_earnings_ratio`,`shares_percentage`,`closing_percentage`,`published_at`,`created_at`,`updated_at`) VALUES #{values}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do |conn|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">        conn.execute(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    # the_year = filename[0, 4]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">    # the_month = filename[4, 6]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    # the_date = filename[6, 8]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    # post.update_attributes(current_year: the_year, current_month: the_month, current_date: the_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a4a3cc7b53d39b55ffba4d11eaebf7eaa15e5cc1">
  <div class="header">
    <h3>app/models/post.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Post &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :title, :current_year, :current_month, :current_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :reports, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :mi_reports, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :yield_files, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :stations, dependent: :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :title, presence: true, length: { :minimum =&gt; 3, :maximum =&gt; 255 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="64f9c991f7a380d4615d51607a26186f5a22b19a">
  <div class="header">
    <h3>app/models/product.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class Product &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  attr_accessible :title, :user_id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  has_many :posts, dependent: :destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  validates :title, presence: true, length: { :minimum =&gt; 3, :maximum =&gt; 255 }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  paginates_per 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0b46bae3f85b93702116a4b9ed393568e96bb722">
  <div class="header">
    <h3>app/models/report.rb</h3>
    <h4><span class="red">24.62 %</span> covered</h4>
    <div>
      <b>65</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>49</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;activerecord-import/base&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">ActiveRecord::Import.require_adapter(&#39;mysql2&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">class Report &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :post_id, :yield_file_id, :station_id, :station_name, :traded_shares_num, :turnover, :total_transactions, :advance_decline_idx, :shares_percentage, :closing_percentage, :published_at, :p_year, :p_month, :p_date, :created_at, :updated_at</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :yield_file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :station</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :post_id, :yield_file_id, :station_id, :station_name, :traded_shares_num, :turnover, :total_transactions, :advance_decline_idx, :shares_percentage, :closing_percentage, :published_at, :p_year, :p_month, :p_date, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  paginates_per 1000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    if published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      self.p_year = published_at.year</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      self.p_month = published_at.month</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      self.p_date = published_at.mday</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  SORT_NAMES = %w(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    published_at station_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.sort_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    SORT_NAMES</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.group_shares_percentage_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    reports = where(&quot;published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, max(shares_percentage) as best_shares_percentage&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    reports = reports.order(&quot;best_shares_percentage DESC&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.group_closing_percentage_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">    reports = where(&quot;published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, max(closing_percentage) as best_closing_percentage&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">    reports = reports.order(&quot;best_closing_percentage DESC&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  # The &#39;import&#39; function can be used both on web and rake script</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.import_data(file, filename, post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    # Check filename</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">    if csvfile = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      yf_id = csvfile.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      line_count = CSV.open(file, &quot;r&quot;, :encoding =&gt; &#39;big5&#39;).readlines.count - 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      file_date = Time.parse(filename.gsub(&#39;.csv&#39;, &#39;&#39;)).strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">      yield_file = YieldFile.create(post_id: post.id, file_name: filename, total_row: line_count, published_at: file_date)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      yf_id = yield_file.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">    GC.disable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">    Report.transaction do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">      records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">      columns = [:post_id, :yield_file_id, :station_id, :station_name, :traded_shares_num, :turnover, :total_transactions, :advance_decline_idx, :shares_percentage, :closing_percentage, :published_at, :p_year, :p_month, :p_date]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">      column_header = [&#39;分類指數名稱&#39;, &#39;成交股數&#39;, &#39;成交金額&#39;, &#39;成交筆數&#39;, &#39;漲跌指數&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">      sum_of_shares = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">      sum_of_closing = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;big5&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: column_header}).with_index(0) do |row, rowno|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          # We only need data from row &quot;水泥類指數&quot; to &quot;其他類指數&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">          if rowno &gt; 1 and rowno &lt; 32</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">            sum_of_shares += row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">            sum_of_closing += row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;big5&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: column_header}).with_index(0) do |row, rowno|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">        if rowno &gt; 1 and rowno &lt; 32</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">          if station = Station.find_by_name_and_post_id(row[&#39;分類指數名稱&#39;].strip, post.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">            sta_id = station.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">            station = Station.create(post_id: post.id, yield_file_id: yf_id, name: row[&#39;分類指數名稱&#39;].strip.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">            sta_id = station.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">          shares_percentage = ((row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_f / sum_of_shares.to_f) * 100).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">          closing_percentage = ((row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;).to_f / sum_of_closing.to_f) * 100).round(2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">          time_now = Time.now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">          record = [post.id, yf_id, sta_id, row[&#39;分類指數名稱&#39;].strip.to_s, row[&#39;成交股數&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;成交金額&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;成交筆數&#39;].gsub(&#39;,&#39;, &#39;&#39;), row[&#39;漲跌指數&#39;], </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">            shares_percentage, closing_percentage,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">            Time.parse(filename.gsub(&#39;.csv&#39;, &#39;&#39;)).strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s, Time.parse(filename.gsub(&#39;.csv&#39;, &#39;&#39;).to_s).year, Time.parse(filename.gsub(&#39;.csv&#39;, &#39;&#39;).to_s).month, Time.parse(filename.gsub(&#39;.csv&#39;, &#39;&#39;).to_s).day,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">            time_now, time_now]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">          records &lt;&lt; record</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">      values = records.map{ |record| &quot;(#{record[0]}, #{record[1]}, #{record[2]}, &#39;#{record[3]}&#39;, #{record[4]}, #{record[5]}, #{record[6]}, #{record[7]}, #{record[8]}, #{record[9]}, &#39;#{record[10]}&#39;, #{record[11]}, #{record[12]}, #{record[13]}, &#39;#{record[14]}&#39;, &#39;#{record[15]}&#39;)&quot; }.join(&quot;,&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">      sql = &quot;INSERT INTO `#{self.table_name}` (`post_id`,`yield_file_id`,`station_id`,`station_name`,`traded_shares_num`,`turnover`,`total_transactions`,`advance_decline_idx`,`shares_percentage`,`closing_percentage`,`published_at`,`p_year`,`p_month`,`p_date`,`created_at`,`updated_at`) VALUES #{values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do |conn|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        conn.execute(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">    the_year = filename[0, 4]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">    the_month = filename[4, 6]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">    the_date = filename[6, 8]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">    post.update_attributes(current_year: the_year, current_month: the_month, current_date: the_date)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="64ba0f1060769ec475bd5d489f982385f39b0df3">
  <div class="header">
    <h3>app/models/report_main.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>696</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>696</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">require &quot;activerecord-import/base&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">ActiveRecord::Import.require_adapter(&#39;mysql2&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">class ReportMain &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  attr_accessible :post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :published_at, :p_year, :p_month, :p_mday, :p_hour, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  belongs_to :yield_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  belongs_to :station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">  validates :post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    :fail_borrow, :pass_borrow, :yield_type, :published_at, :p_year, :p_month, :p_mday, :p_hour, presence: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  # Set yield report records per page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">  paginates_per 20</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  before_validation do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    if published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      self.p_year = published_at.year</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      self.p_month = published_at.month</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      self.p_mday = published_at.mday</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      self.p_hour = published_at.hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  # Caculate yield rate today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">  # If timestamp of hour is 6am, Get year, month, day, post_id and station_name of the base record, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">  # and update each record&#39;s daily yield that belong to the same day with base record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">  before_create do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    if self.p_hour.equal? 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      records = ReportMain.where(&#39;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        ((p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_mday = ? AND p_hour BETWEEN ? AND ?))&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        self.post_id, self.station_name, self.config, self.p_year, self.p_month, self.p_mday, 7, 23, self.p_mday + 1, 0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      if records.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">        records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">          output_today = (record.first_pass.to_i - self.first_pass.to_i) + (record.retest_pass.to_i - self.retest_pass.to_i) + (record.test_waive.to_i - self.test_waive.to_i) + (record.design_waive.to_i - self.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">          (record.cof_waive.to_i - self.cof_waive.to_i) + (record.ntf.to_i - self.ntf.to_i) + (record.failure_waive.to_i - self.failure_waive.to_i) + (record.repaire_ok.to_i - self.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">          input_today = record.input.to_i - self.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">          if !input_today.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">            yield_rate_today = (output_today.to_f / input_today.to_f) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">            yield_rate_today = yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">            yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">          record.update_attribute(:yield_rate_today, yield_rate_today)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      # Get first record with same day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      datetime = DateTime.parse(self.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        # base_record = Report.where(post_id: post, station_name: self.station_name, config: self.config, p_year: datetime.year, p_month: datetime.month, p_mday: datetime.day, p_hour: 6).limit(1).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 7).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        # # If base_record hour have no station, create record data from current hour for the station at base_record hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        # if base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        #   base_record_without_station = ReportMain.where(&quot;post_id = ? AND station_name = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        #   records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">        #   columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        #   begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        #     # Create report items from CSV rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        #     record = ReportMain.new(post_id: self.post_id, yield_file_id: base_record_without_station.yield_file_id, station_id: self.station_id, model: self.model.strip, stage: self.stage.strip, seqno: self.seqno, config: self.config, station_name: self.station_name, input: self.input, first_pass: self.first_pass, retest_pass: self.retest_pass, fail: self.fail, retest_process: self.retest_process, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        #       test_waive: self.test_waive, design_waive: self.design_waive, cof_waive: self.cof_waive, rd_area: self.rd_area, bpl: self.bpl, ntf: self.ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        #       failure_waive: self.failure_waive, repaire_ok: self.repaire_ok, inl_repaire: self.inl_repaire, dip: self.dip, defect: self.defect, fail_borrow: self.fail_borrow, pass_borrow: self.pass_borrow, yield_type: self.yield_type, yield_rate: self.yield_rate, yield_rate_today: self.yield_rate_today, fp_yield_rate: self.fp_yield_rate, fp_yield_rate_today: self.fp_yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">        #       published_at: base_record_without_station.published_at, p_year: datetime.year, p_month: datetime.month, p_mday: datetime.day, p_hour: base_record_without_station.p_hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">        #     )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">        #     records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">        #   rescue ActiveRecord::RecordInvalid =&gt; invalid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">        #     puts invalid.record.errors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">        #   records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        #     record.run_callbacks(:create) { false }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        #   ReportMain.import columns, records, validate: false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">        # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">        # # Then check base_record again</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">        # base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">      elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        # base_record = Report.where(post_id: post, station_name: self.station_name, config: self.config, p_year: datetime.yesterday.year, p_month: datetime.yesterday.month, p_mday: datetime.yesterday.day, p_hour: 6).limit(1).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">        # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">        base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">        # # If base_record hour have no station, create record data from current hour for the station at base_record hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        # if base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        #   base_record_without_station = ReportMain.where(&quot;post_id = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        #   records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">        #   columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        #   begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">        #     # Create report items from CSV rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">        #     record = ReportMain.new(post_id: self.post_id, yield_file_id: base_record_without_station.yield_file_id, station_id: self.station_id, model: self.model.strip, stage: self.stage.strip, seqno: self.seqno, config: self.config, station_name: self.station_name, input: self.input, first_pass: self.first_pass, retest_pass: self.retest_pass, fail: self.fail, retest_process: self.retest_process, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">        #       test_waive: self.test_waive, design_waive: self.design_waive, cof_waive: self.cof_waive, rd_area: self.rd_area, bpl: self.bpl, ntf: self.ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">        #       failure_waive: self.failure_waive, repaire_ok: self.repaire_ok, inl_repaire: self.inl_repaire, dip: self.dip, defect: self.defect, fail_borrow: self.fail_borrow, pass_borrow: self.pass_borrow, yield_type: self.yield_type, yield_rate: self.yield_rate, yield_rate_today: self.yield_rate_today, fp_yield_rate: self.fp_yield_rate, fp_yield_rate_today: self.fp_yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">        #       published_at: base_record_without_station.published_at, p_year: datetime.yesterday.year, p_month: datetime.yesterday.month, p_mday: datetime.yesterday.day, p_hour: base_record_without_station.p_hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        #     )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        #     records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        #   rescue ActiveRecord::RecordInvalid =&gt; invalid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">        #     puts invalid.record.errors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">        #   records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">        #     record.run_callbacks(:create) { false }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">        #   ReportMain.import columns, records, validate: false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">        # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">        # # Then check base_record again</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">        # base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">      if base_record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        output_today = (self.first_pass.to_i - base_record.first_pass.to_i) + (self.retest_pass.to_i - base_record.retest_pass.to_i) + (self.test_waive.to_i - base_record.test_waive.to_i) + (self.design_waive.to_i - base_record.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">          (self.cof_waive.to_i - base_record.cof_waive.to_i) + (self.ntf.to_i - base_record.ntf.to_i) + (self.failure_waive.to_i - base_record.failure_waive.to_i) + (self.repaire_ok.to_i - base_record.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">        input_today = self.input.to_i - base_record.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">        if !input_today.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">          self.yield_rate_today = (output_today.to_f / input_today.to_f) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">          self.yield_rate_today = yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">          self.fp_yield_rate_today = ( (self.first_pass.to_f - base_record.first_pass.to_f) / input_today.to_f ) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">          self.fp_yield_rate_today = self.fp_yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">          self.yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">          self.fp_yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">        # If base_record not found, set current record as base_record!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">        self.yield_rate_today = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">  SORT_NAMES = %w(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby">    published_at model stage seqno station_name yield_rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">  )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">  def self.sort_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby">    SORT_NAMES</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">  def base_record?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">    datetime = DateTime.parse(self.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      return ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 6, self.p_hour-1).first.equal? nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">    elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">      look_from_yesterday = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6, 23).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">      look_from_today = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 0, self.p_hour-1).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">      return look_from_yesterday.nil? &amp;&amp; look_from_today.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    else # datetime.hour is 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">  def self.group_accu_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">    reports = where(&quot;yield_rate IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(yield_rate) as worst_accu_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">  def self.group_daily_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">    reports = where(&quot;yield_rate_today IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(yield_rate_today) as worst_daily_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">  def self.group_fp_accu_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">    reports = where(&quot;fp_yield_rate IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(fp_yield_rate) as worst_fp_accu_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_fp_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">  def self.group_fp_daily_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="173">
          
          
          <code class="ruby">    reports = where(&quot;fp_yield_rate_today IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(fp_yield_rate_today) as worst_fp_daily_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_fp_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">  def self.group_station_accu_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND yield_rate IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(yield_rate) as worst_accu_yield&quot;).order(&quot;worst_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">  def self.group_station_daily_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND yield_rate_today IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(yield_rate_today) as worst_daily_yield&quot;).order(&quot;worst_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">  def self.group_station_fp_accu_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND fp_yield_rate IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(fp_yield_rate) as worst_fp_accu_yield&quot;).order(&quot;worst_fp_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">  def self.group_station_fp_daily_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="196">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND fp_yield_rate_today IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(fp_yield_rate_today) as worst_fp_daily_yield&quot;).order(&quot;worst_fp_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="200">
          
          
          <code class="ruby">  # The &#39;import&#39; function can be used both on web and rake script</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">  def self.import_data(file, filename, post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">    # Check filename</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">    if csvfile = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">      yf_id = csvfile.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">      line_count = CSV.open(file, &quot;r&quot;).readlines.count - 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">      # Set published_at from file name, and create the file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">      file_datetime = filename[filename.index(&#39;20&#39;), 12]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">      yield_file = YieldFile.create(post_id: post.id, file_name: filename, total_row: line_count, published_at: file_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">      yf_id = yield_file.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">    # Define the folder path of XML files, and then delete all files before importing new csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">    file_model_stage_name = filename[filename.index(&#39;20&#39;)+12..filename.index(&#39;.csv&#39;)-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">    file_stage_name = file_model_stage_name[file_model_stage_name.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">    file_model_name = file_model_stage_name.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">    # if filename.include? &quot;Sum-Config&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">    #   # All XML files in JHxC folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">    #   files_to_clear = base_dir + file_stage_name.to_s + &quot;/&quot; + file_model_name.to_s + &quot;C/*&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">    # else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">    #   # All XML files in JHx folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">    #   files_to_clear = base_dir + file_stage_name.to_s + &quot;/&quot; + file_model_name.to_s+ &quot;/*&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">    # FileUtils.rm_rf Dir.glob(files_to_clear)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">    ReportMain.transaction do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">      records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">      columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">        :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;UTF-8&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: true}) do |row|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="233">
          
          
          <code class="ruby">        # Create station model and set station_id to Report obj</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">        if station = Station.find_by_name_and_post_id(row[&#39;Station&#39;], post.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">          sta_id = station.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">          station = Station.create(post_id: post.id, yield_file_id: yf_id, name: row[&#39;Station&#39;])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">          sta_id = station.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">        # Caculate accumulative yield rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">        if !row[&#39;Input&#39;].to_i.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">          total = row[&#39;PFirstPass&#39;].to_i + row[&#39;PRetestPass&#39;].to_i + row[&#39;TestWF&#39;].to_i + row[&#39;DesignWF&#39;].to_i + row[&#39;COFWF&#39;].to_i + row[&#39;NTF&#39;].to_i + row[&#39;FailureWF&#39;].to_i + row[&#39;RepairOK&#39;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">          yield_rate = ( (total.to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">          # Caculate FirstPass yield rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">          fp_yield_rate = ( (row[&#39;PFirstPass&#39;].to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">          # Caculate FirstPass yield rate today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="247">
          
          
          <code class="ruby">          fp_yield_rate_today = ( (row[&#39;PFirstPass&#39;].to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">          yield_rate = 99999 # Input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="250">
          
          
          <code class="ruby">          fp_yield_rate = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">          fp_yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="252">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="254">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">        if Time.parse(row[&#39;Date&#39;]).hour.to_i.equal? 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">          records_to_be_update = ReportMain.where(&#39;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">            ((p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_mday = ? AND p_hour BETWEEN ? AND ?))&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="258">
          
          
          <code class="ruby">            post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, Time.parse(row[&#39;Date&#39;]).year.to_i, Time.parse(row[&#39;Date&#39;]).month.to_i, Time.parse(row[&#39;Date&#39;]).day.to_i, 7, 23, Time.parse(row[&#39;Date&#39;]).day.to_i + 1, 0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">          if records_to_be_update.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">            Parallel.each(records_to_be_update, in_threads: 4) do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="261">
          
          
          <code class="ruby">              ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="262">
          
          
          <code class="ruby">                output_today = (record.first_pass.to_i - row[&#39;PFirstPass&#39;].to_i) + (record.retest_pass.to_i - row[&#39;PRetestPass&#39;].to_i) + (record.test_waive.to_i - row[&#39;TestWF&#39;].to_i) + (record.design_waive.to_i - row[&#39;DesignWF&#39;].to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="263">
          
          
          <code class="ruby">                (record.cof_waive.to_i - row[&#39;COFWF&#39;].to_i) + (record.ntf.to_i - row[&#39;NTF&#39;].to_i) + (record.failure_waive.to_i - row[&#39;FailureWF&#39;].to_i) + (record.repaire_ok.to_i - row[&#39;RepairOK&#39;].to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">                input_today = record.input.to_i - row[&#39;Input&#39;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">                yield_rate_today = input_today &gt; 0 ? ( (output_today.to_f / input_today.to_f) * 100 ).round(2) : nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">                record.update_attribute(:yield_rate_today, yield_rate_today)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="268">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">          input_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">          output_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">          yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">          datetime = DateTime.parse(row[&#39;Date&#39;].to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">          if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">            # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">            base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">          elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">            # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">            base_record = ReportMain.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">          if base_record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">            output_today = (row[&#39;PFirstPass&#39;].to_i - base_record.first_pass.to_i) + (row[&#39;PRetestPass&#39;].to_i - base_record.retest_pass.to_i) + (row[&#39;TestWF&#39;].to_i - base_record.test_waive.to_i) + (row[&#39;DesignWF&#39;].to_i - base_record.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">              (row[&#39;COFWF&#39;].to_i - base_record.cof_waive.to_i) + (row[&#39;NTF&#39;].to_i - base_record.ntf.to_i) + (row[&#39;FailureWF&#39;].to_i - base_record.failure_waive.to_i) + (row[&#39;RepairOK&#39;].to_i - base_record.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">            input_today = row[&#39;Input&#39;].to_i - base_record.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">            yield_rate_today = input_today &gt; 0 ? ( (output_today.to_f / input_today.to_f) * 100 ).round(2) : 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">            fp_yield_rate_today = input_today &gt; 0 ? ( ( (row[&#39;PFirstPass&#39;].to_f - base_record.first_pass.to_f) / input_today.to_f ) * 100 ).round(2) : 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">            input_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="291">
          
          
          <code class="ruby">            output_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">            yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="297">
          
          
          <code class="ruby">        time_now = Time.now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="298">
          
          
          <code class="ruby">        #record = &quot;(#{post.id}, #{yf_id}, #{sta_id}, &#39;#{row[&#39;Model&#39;].strip}&#39;, &#39;#{row[&#39;Stage&#39;].strip}&#39;, #{row[&#39;Seqno&#39;]}, &#39;#{row[&#39;Config&#39;]}&#39;, &#39;#{row[&#39;Station&#39;]}&#39;, #{row[&#39;Input&#39;]}, #{row[&#39;PFirstPass&#39;]}, #{row[&#39;PRetestPass&#39;]}, #{row[&#39;Fail&#39;]}, #{row[&#39;RetestProcess&#39;]}, #{row[&#39;TestWF&#39;]}, #{row[&#39;DesignWF&#39;]}, #{row[&#39;COFWF&#39;]}, #{row[&#39;RDArea&#39;]}, #{row[&#39;BPL&#39;]}, #{row[&#39;NTF&#39;]}, #{row[&#39;FailureWF&#39;]}, #{row[&#39;RepairOK&#39;]}, #{row[&#39;INLRepair&#39;]}, #{row[&#39;DIP&#39;]}, #{row[&#39;Defect&#39;]}, #{row[&#39;Fail_Borrow&#39;]}, #{row[&#39;Pass_Borrow&#39;]}, &#39;#{row[&#39;Type&#39;]}&#39;, #{yield_rate}, NULL, #{fp_yield_rate}, #{fp_yield_rate_today}, &#39;#{row[&#39;Date&#39;]}&#39;, #{Time.parse(row[&#39;Date&#39;]).year}, #{Time.parse(row[&#39;Date&#39;]).month}, #{Time.parse(row[&#39;Date&#39;]).day}, #{Time.parse(row[&#39;Date&#39;]).hour}, &#39;#{time_now}&#39;, &#39;#{time_now}&#39;)&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">        #records += records.length == 0 ? &quot;#{record}&quot; : &quot;, #{record}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="300">
          
          
          <code class="ruby">        record = [post.id, yf_id, sta_id, row[&#39;Model&#39;].strip.to_s, row[&#39;Stage&#39;].strip.to_s, row[&#39;Seqno&#39;], row[&#39;Config&#39;].to_s, row[&#39;Station&#39;].to_s, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="301">
          
          
          <code class="ruby">          row[&#39;Input&#39;], row[&#39;PFirstPass&#39;], row[&#39;PRetestPass&#39;], row[&#39;Fail&#39;], row[&#39;RetestProcess&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="302">
          
          
          <code class="ruby">          row[&#39;TestWF&#39;], row[&#39;DesignWF&#39;], row[&#39;COFWF&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">          row[&#39;RDArea&#39;], row[&#39;BPL&#39;], row[&#39;NTF&#39;], row[&#39;FailureWF&#39;], row[&#39;RepairOK&#39;], row[&#39;INLRepair&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">          row[&#39;DIP&#39;], row[&#39;Defect&#39;], row[&#39;Fail_Borrow&#39;], row[&#39;Pass_Borrow&#39;], row[&#39;Type&#39;].to_s, yield_rate, yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">          fp_yield_rate, fp_yield_rate_today, row[&#39;Date&#39;].to_s, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">          Time.parse(row[&#39;Date&#39;]).year, Time.parse(row[&#39;Date&#39;]).month, Time.parse(row[&#39;Date&#39;]).day, Time.parse(row[&#39;Date&#39;]).hour, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">          time_now, time_now, input_today, output_today]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">        records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="309">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">      #values = records.map{ |record| &quot;(#{record.join(&quot;,&quot;)})&quot; }.join(&quot;,&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="312">
          
          
          <code class="ruby">      #values = records.map{|record| &quot;(#{record.map! {|c| record.find_index(c)==3 || record.find_index(c)==4 ? c=&#39;\&#39;c\&#39;&#39; : c}.join(&#39;,&#39;)})&quot;}.join(&#39;,&#39;).gsub(&#39;99999&#39;, &#39;NULL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="313">
          
          
          <code class="ruby">      values = records.map{ |record| &quot;(#{record[0]}, #{record[1]}, #{record[2]}, &#39;#{record[3]}&#39;, &#39;#{record[4]}&#39;, #{record[5]}, &#39;#{record[6]}&#39;, &#39;#{record[7]}&#39;, #{record[8]}, #{record[9]}, #{record[10]}, #{record[11]}, #{record[12]}, #{record[13]}, #{record[14]}, #{record[15]}, #{record[16]}, #{record[17]}, #{record[18]}, #{record[19]}, #{record[20]}, #{record[21]}, #{record[22]}, #{record[23]}, #{record[24]}, #{record[25]}, &#39;#{record[26]}&#39;, #{record[27]}, #{record[28]}, #{record[29]}, #{record[30]}, &#39;#{record[31]}&#39;, #{record[32]}, #{record[33]}, #{record[34]}, #{record[35]}, &#39;#{record[36]}&#39;, &#39;#{record[37]}&#39;, &#39;#{record[38]}&#39;, &#39;#{record[39]}&#39;)&quot; }.join(&quot;,&quot;).gsub(&#39;99999&#39;, &#39;NULL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">      sql = &quot;INSERT INTO `#{self.table_name}` (`post_id`,`yield_file_id`,`station_id`,`model`,`stage`,`seqno`,`config`,`station_name`,`input`,`first_pass`,`retest_pass`,`fail`,`retest_process`,`test_waive`,`design_waive`,`cof_waive`,`rd_area`,`bpl`,`ntf`,`failure_waive`,`repaire_ok`,`inl_repaire`,`dip`,`defect`,`fail_borrow`,`pass_borrow`,`yield_type`,`yield_rate`,`yield_rate_today`,`fp_yield_rate`,`fp_yield_rate_today`,`published_at`,`p_year`,`p_month`,`p_mday`,`p_hour`,`created_at`,`updated_at`,`input_today`,`output_today`) VALUES #{values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">      #ActiveRecord::Base.connection.execute(sql)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="316">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do |conn|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">        conn.execute(sql)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">    the_year = filename[filename.index(&#39;20&#39;), 4]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">    the_month = filename[filename.index(&#39;20&#39;)+4, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">    the_day = filename[filename.index(&#39;20&#39;)+6, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">    the_hour = filename[filename.index(&#39;20&#39;)+8, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">    post.update_attributes(current_year_main: the_year, current_month_main: the_month, current_mday_main: the_day, current_hour_main: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="328">
          
          
          <code class="ruby">    # # Delete last hour&#39;s records from database (For always only keep 2 groups of hourly records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="329">
          
          
          <code class="ruby">    # the_post = Post.find_by_id(post.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="330">
          
          
          <code class="ruby">    # the_year = filename[filename.index(&#39;20&#39;), 4]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="331">
          
          
          <code class="ruby">    # the_month = filename[filename.index(&#39;20&#39;)+4, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">    # the_day = filename[filename.index(&#39;20&#39;)+6, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    # the_hour = filename[filename.index(&#39;20&#39;)+8, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">    # if !the_post.current_hour_main.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">    #   if !the_post.current_hour_main.to_s.eql? the_hour.to_i.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">    #     if !(the_hour.to_i &gt;= 6 &amp;&amp; the_post.current_hour_main.to_i &lt; 6)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">    #       check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, file_model_stage_name, the_post.current_year_main, the_post.current_month_main, the_post.current_mday_main, 6, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="338">
          
          
          <code class="ruby">    #       grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="339">
          
          
          <code class="ruby">    #       if grup_hour.count &gt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">    #         puts &quot;Deleting old timestamp MAIN records...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">    #         ReportMain.where(stage: file_model_stage_name, p_year: the_post.current_year_main, p_month: the_post.current_month_main, p_mday: the_post.current_mday_main, p_hour: the_post.current_hour_main).destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    #       end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">    #     end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">    # # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="347">
          
          
          <code class="ruby">    # Post.find_by_id(post.id).update_attributes(current_year_main: the_year, current_month_main: the_month, current_mday_main: the_day, current_hour_main: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="349">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="350">
          
          
          <code class="ruby">  def self.delete_overdue_records_beta(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="351">
          
          
          <code class="ruby">    # Delete overdue data records from database (Always keep only 2 groups of hourly timestamp records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="352">
          
          
          <code class="ruby">    the_post = Post.find_by_title(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">    the_year = the_post.current_year_main</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="354">
          
          
          <code class="ruby">    the_month = the_post.current_month_main</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="355">
          
          
          <code class="ruby">    the_day = the_post.current_mday_main</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">    the_hour = the_post.current_hour_main</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="357">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="358">
          
          
          <code class="ruby">    if !the_hour.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="359">
          
          
          <code class="ruby">      datetime = DateTime.parse(the_year.to_s + sprintf(&#39;%02d&#39;, the_month).to_s + the_day.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="360">
          
          
          <code class="ruby">      if the_hour.to_i == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="361">
          
          
          <code class="ruby">        check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="362">
          
          
          <code class="ruby">          file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="363">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(1, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="364">
          
          
          <code class="ruby">        check_base_record = ReportMain.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="365">
          
          
          <code class="ruby">          file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="366">
          
          
          <code class="ruby">          the_year, the_month, the_day, 0, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="367">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(6, 7)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="368">
          
          
          <code class="ruby">        yesterday_latest_midnight_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="369">
          
          
          <code class="ruby">          file_model_stage_name, the_year, the_month, the_day, 0, 5).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="370">
          
          
          <code class="ruby">        if yesterday_latest_midnight_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="371">
          
          
          <code class="ruby">          yesterday_latest_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="372">
          
          
          <code class="ruby">            file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="373">
          
          
          <code class="ruby">          if !yesterday_latest_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="374">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="375">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, yesterday_latest_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="376">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="377">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="378">
          
          
          <code class="ruby">          if yesterday_latest_midnight_record.p_hour == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="379">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="380">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="381">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="382">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="383">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="384">
          
          
          <code class="ruby">              the_year, the_month, the_day, 0, yesterday_latest_midnight_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="385">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="386">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="387">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(8, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="388">
          
          
          <code class="ruby">        yesterday_latest_midnight_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="389">
          
          
          <code class="ruby">          file_model_stage_name, the_year, the_month, the_day, 0, 5).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="390">
          
          
          <code class="ruby">        if yesterday_latest_midnight_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="391">
          
          
          <code class="ruby">          yesterday_latest_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="392">
          
          
          <code class="ruby">            file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="393">
          
          
          <code class="ruby">          if !yesterday_latest_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="394">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="395">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, yesterday_latest_record.p_hour.to_i-1,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="396">
          
          
          <code class="ruby">              the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="397">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="398">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="399">
          
          
          <code class="ruby">              file_model_stage_name, the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="400">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="401">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="402">
          
          
          <code class="ruby">          if yesterday_latest_midnight_record.p_hour == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="403">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="404">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="405">
          
          
          <code class="ruby">              the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="406">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="407">
          
          
          <code class="ruby">            check_base_record = ReportMain.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="408">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="409">
          
          
          <code class="ruby">              the_year, the_month, the_day, 0, yesterday_latest_midnight_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="410">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="411">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="412">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="413">
          
          
          <code class="ruby">      if !check_base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="414">
          
          
          <code class="ruby">        grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="415">
          
          
          <code class="ruby">        if grup_hour.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="416">
          
          
          <code class="ruby">          puts &quot;Deleting overdue Sum-Main records from database...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="417">
          
          
          <code class="ruby">          check_base_record.destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="418">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="419">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="420">
          
          
          <code class="ruby">        puts &quot;No overdue records to be delete!&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="421">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="422">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="423">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="424">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="425">
          
          
          <code class="ruby">  def self.delete_overdue_records(file_model_stage_name, latest_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="426">
          
          
          <code class="ruby">    # Delete overdue data records from database (Always keep only 2 groups of hourly timestamp records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="427">
          
          
          <code class="ruby">    the_post = Post.find_by_title(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="428">
          
          
          <code class="ruby">    the_year = latest_datetime[0..3]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="429">
          
          
          <code class="ruby">    the_month = latest_datetime[4..5]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="430">
          
          
          <code class="ruby">    the_day = latest_datetime[6..7]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="431">
          
          
          <code class="ruby">    the_hour = latest_datetime[8..9]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="432">
          
          
          <code class="ruby">    if !the_post.current_hour.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="433">
          
          
          <code class="ruby">      if !the_post.current_hour.to_s.eql? the_hour.to_i.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="434">
          
          
          <code class="ruby">        if !(the_hour.to_i &gt;= 6 &amp;&amp; the_post.current_hour.to_i &lt; 6)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="435">
          
          
          <code class="ruby">          check_base_record = ReportMain.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, file_model_stage_name, the_post.current_year_main, the_post.current_month_main, the_post.current_mday_main, 6, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="436">
          
          
          <code class="ruby">          grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="437">
          
          
          <code class="ruby">          if grup_hour.count &gt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="438">
          
          
          <code class="ruby">            puts &quot;Deleting overdue Sum-All and Sum-Config records from database...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="439">
          
          
          <code class="ruby">            ReportMain.where(stage: file_model_stage_name, p_year: the_post.current_year_main, p_month: the_post.current_month_main, p_mday: the_post.current_mday_main, p_hour: the_post.current_hour_main).destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="440">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="441">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="442">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="443">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="444">
          
          
          <code class="ruby">    # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="445">
          
          
          <code class="ruby">    the_post.update_attributes(current_year_main: the_year, current_month_main: the_month, current_mday_main: the_day, current_hour_main: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="446">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="447">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="448">
          
          
          <code class="ruby">  def self.export_dummy_xml(target_stage, latest_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="449">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="450">
          
          
          <code class="ruby">    puts &quot;Start generating dummy (Main) XML files to &quot; + base_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="451">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="452">
          
          
          <code class="ruby">    stage_name = target_stage.to_s[target_stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="453">
          
          
          <code class="ruby">    model_name = target_stage.to_s.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="454">
          
          
          <code class="ruby">    xml_root_dir = base_dir + stage_name.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="455">
          
          
          <code class="ruby">    station_xml_folder = xml_root_dir + &quot;/&quot; + model_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="456">
          
          
          <code class="ruby">    # Create folder for XML files if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="457">
          
          
          <code class="ruby">    FileUtils.mkdir_p xml_root_dir unless Dir.exist?(xml_root_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="458">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="459">
          
          
          <code class="ruby">    sum_all_root_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="460">
          
          
          <code class="ruby">    sum_all_fp_root_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_F.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="461">
          
          
          <code class="ruby">    today_yield_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_T.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="462">
          
          
          <code class="ruby">    fp_today_yield_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_FT.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="463">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="464">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + target_stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + latest_datetime.to_s + &quot;&lt;/pubDate&gt;\n&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="465">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="466">
          
          
          <code class="ruby">    # Write dummy xml content to the files </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="467">
          
          
          <code class="ruby">    File.open(sum_all_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="468">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="469">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="470">
          
          
          <code class="ruby">    File.open(sum_all_fp_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="471">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="472">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="473">
          
          
          <code class="ruby">    File.open(today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="474">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="475">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="476">
          
          
          <code class="ruby">    File.open(fp_today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="477">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="478">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="479">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="480">
          
          
          <code class="ruby">    # Generate dummy XML folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="481">
          
          
          <code class="ruby">    station_xml_folder = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;Main&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="482">
          
          
          <code class="ruby">    FileUtils.mkdir_p station_xml_folder unless Dir.exist?(station_xml_folder)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="483">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="484">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="485">
          
          
          <code class="ruby">  def self.export_to_xml(target_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="486">
          
          
          <code class="ruby">    model_stage = Post.uniq.pluck(:title)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="487">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="488">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="489">
          
          
          <code class="ruby">    puts &quot;Start to exporting Main-build XML files to &quot; + base_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="490">
          
          
          <code class="ruby">    start_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="491">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="492">
          
          
          <code class="ruby">    model_stage.each do |s|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="493">
          
          
          <code class="ruby">      if s.eql? target_stage</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="494">
          
          
          <code class="ruby">        stage_name = s.to_s[s.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="495">
          
          
          <code class="ruby">        model_name = s.to_s.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="496">
          
          
          <code class="ruby">        xml_root_dir = base_dir + stage_name.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="497">
          
          
          <code class="ruby">        station_xml_folder = xml_root_dir + &quot;/&quot; + model_name + &quot;Main&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="498">
          
          
          <code class="ruby">        # Create folder for XML files if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="499">
          
          
          <code class="ruby">        FileUtils.mkdir_p xml_root_dir unless Dir.exist?(xml_root_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="500">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="501">
          
          
          <code class="ruby">        # Generating station&#39;s XML files for Sum-All data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="502">
          
          
          <code class="ruby">        sum_all_latest_record = ReportMain.where(&quot;stage = ?&quot;, s).order(&quot;published_at DESC&quot;).limit(1)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="503">
          
          
          <code class="ruby">        sum_all_records = ReportMain.where(&quot;stage = ? AND published_at = ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="504">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="505">
          
          
          <code class="ruby">        sum_all_records_fp = ReportMain.where(&quot;stage = ? AND published_at = ? AND fp_yield_rate IS NOT NULL&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="506">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="507">
          
          
          <code class="ruby">        today_yield_records = ReportMain.where(&quot;stage = ? AND published_at = ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="508">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="509">
          
          
          <code class="ruby">        # Generate station&#39;s XML file for Sum-All records</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="510">
          
          
          <code class="ruby">        Parallel.each(sum_all_records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="511">
          
          
          <code class="ruby">          ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="512">
          
          
          <code class="ruby">            self.generate_station_xml(r)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="513">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="514">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="515">
          
          
          <code class="ruby">        sum_all_root_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="516">
          
          
          <code class="ruby">        sum_all_fp_root_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_F.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="517">
          
          
          <code class="ruby">        today_yield_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_T.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="518">
          
          
          <code class="ruby">        fp_today_yield_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Main_FT.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="519">
          
          
          <code class="ruby">        # Generate root XML file in specific stage folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="520">
          
          
          <code class="ruby">        self.generate_root_xml(sum_all_records, sum_all_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="521">
          
          
          <code class="ruby">        self.generate_fp_root_xml(sum_all_records, sum_all_records_fp, sum_all_fp_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="522">
          
          
          <code class="ruby">        self.generate_today_yield_root_xml(today_yield_records, today_yield_xml_filename, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="523">
          
          
          <code class="ruby">        #self.generate_fp_today_yield_root_xml(today_yield_records, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="524">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="525">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="526">
          
          
          <code class="ruby">    end_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="527">
          
          
          <code class="ruby">    puts &quot;Completed exporting (Main) XML files in #{(end_time - start_time)} seconds&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="528">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="529">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="530">
          
          
          <code class="ruby">  def self.generate_station_xml(record)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="531">
          
          
          <code class="ruby">    xml_header = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;title&gt;&quot; + record.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;) + &quot; Detail&quot; + &quot;&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="532">
          
          
          <code class="ruby">    xml_model = &quot;&lt;item&gt;&lt;title&gt;Model&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.model.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="533">
          
          
          <code class="ruby">    xml_stage = &quot;&lt;item&gt;&lt;title&gt;Stage&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.stage.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="534">
          
          
          <code class="ruby">    xml_config = &quot;&lt;item&gt;&lt;title&gt;Config&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.config.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="535">
          
          
          <code class="ruby">    xml_station = &quot;&lt;item&gt;&lt;title&gt;Station&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="536">
          
          
          <code class="ruby">    xml_input = &quot;&lt;item&gt;&lt;title&gt;Input&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.input.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="537">
          
          
          <code class="ruby">    xml_first_pass = &quot;&lt;item&gt;&lt;title&gt;FirstPass&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.first_pass.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="538">
          
          
          <code class="ruby">    xml_retest_pass = &quot;&lt;item&gt;&lt;title&gt;RetestPass&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.retest_pass.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="539">
          
          
          <code class="ruby">    xml_fail = &quot;&lt;item&gt;&lt;title&gt;FailOnlineFail&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="540">
          
          
          <code class="ruby">    xml_retest_process = &quot;&lt;item&gt;&lt;title&gt;RetestProcess&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.retest_process.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="541">
          
          
          <code class="ruby">    xml_test_waive = &quot;&lt;item&gt;&lt;title&gt;TestWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.test_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="542">
          
          
          <code class="ruby">    xml_design_waive = &quot;&lt;item&gt;&lt;title&gt;DesignWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.design_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="543">
          
          
          <code class="ruby">    xml_cof_waive = &quot;&lt;item&gt;&lt;title&gt;COFWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.cof_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="544">
          
          
          <code class="ruby">    xml_rd_area = &quot;&lt;item&gt;&lt;title&gt;RDArea&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.rd_area.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="545">
          
          
          <code class="ruby">    xml_bpl = &quot;&lt;item&gt;&lt;title&gt;BoundtoPL&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.bpl.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="546">
          
          
          <code class="ruby">    xml_ntf = &quot;&lt;item&gt;&lt;title&gt;NTF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.ntf.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="547">
          
          
          <code class="ruby">    xml_failure_waive = &quot;&lt;item&gt;&lt;title&gt;FailureWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.failure_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="548">
          
          
          <code class="ruby">    xml_repaire_ok = &quot;&lt;item&gt;&lt;title&gt;RepairOK&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.repaire_ok.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="549">
          
          
          <code class="ruby">    xml_inl_repaire = &quot;&lt;item&gt;&lt;title&gt;INLRepair&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.inl_repaire.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="550">
          
          
          <code class="ruby">    xml_dip = &quot;&lt;item&gt;&lt;title&gt;DIPScrap&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.dip.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="551">
          
          
          <code class="ruby">    xml_defect = &quot;&lt;item&gt;&lt;title&gt;Defect&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.defect.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="552">
          
          
          <code class="ruby">    xml_fail_borrow = &quot;&lt;item&gt;&lt;title&gt;Fail_Borrow&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.fail_borrow.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="553">
          
          
          <code class="ruby">    xml_pass_borrow = &quot;&lt;item&gt;&lt;title&gt;Pass_Borrow&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.pass_borrow.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="554">
          
          
          <code class="ruby">    xml_yield_type = &quot;&lt;item&gt;&lt;title&gt;Type&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.yield_type.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="555">
          
          
          <code class="ruby">    xml_ctime = &quot;&lt;item&gt;&lt;title&gt;CTime&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="556">
          
          
          <code class="ruby">    xml_footer = &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="557">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="558">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="559">
          
          
          <code class="ruby">    stage_name = record.stage.to_s[record.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="560">
          
          
          <code class="ruby">    xml_target_dir = base_dir + stage_name + &quot;/&quot; + record.model.to_s + &quot;Main&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="561">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="562">
          
          
          <code class="ruby">    # Create xml folder if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="563">
          
          
          <code class="ruby">    FileUtils.mkdir_p xml_target_dir unless Dir.exist?(xml_target_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="564">
          
          
          <code class="ruby">    # Define the xml file path (And removes all non-alphanumber characters from station_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="565">
          
          
          <code class="ruby">    local_filename = xml_target_dir + &quot;/&quot; + record.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;) + &quot;.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="566">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="567">
          
          
          <code class="ruby">    File.open(local_filename, &#39;w&#39;) { |f| f.write(xml_header + xml_model + xml_stage + xml_config + xml_station + xml_input + xml_first_pass + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="568">
          
          
          <code class="ruby">      xml_retest_pass + xml_fail + xml_retest_process + xml_test_waive + xml_design_waive + xml_cof_waive + xml_rd_area + xml_bpl + xml_ntf + xml_failure_waive + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="569">
          
          
          <code class="ruby">      xml_repaire_ok + xml_inl_repaire + xml_dip + xml_defect + xml_fail_borrow + xml_pass_borrow + xml_yield_type + xml_ctime + xml_footer) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="570">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="571">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="572">
          
          
          <code class="ruby">  def self.generate_root_xml(records, root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="573">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="574">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="575">
          
          
          <code class="ruby">    Parallel.each(records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="576">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="577">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="578">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="579">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="580">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="581">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="582">
          
          
          <code class="ruby">          last_station = ReportMain.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="583">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="584">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="585">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="586">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="587">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="588">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="589">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="590">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="591">
          
          
          <code class="ruby">        # If yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="592">
          
          
          <code class="ruby">        y_rate = r.yield_rate.nil? ? &#39;No Input&#39; : r.yield_rate.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="593">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="594">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="595">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="596">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="597">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="598">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="599">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="600">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="601">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Main/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="602">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="603">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="604">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="605">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="606">
          
          
          <code class="ruby">    File.open(root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="607">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="608">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="609">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="610">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="611">
          
          
          <code class="ruby">  def self.generate_fp_root_xml(records, records_fp, fp_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="612">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="613">
          
          
          <code class="ruby">    # XML file path for showing FirstPass yield</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="614">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="615">
          
          
          <code class="ruby">    Parallel.each(records_fp, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="616">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="617">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="618">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="619">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="620">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="621">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="622">
          
          
          <code class="ruby">          last_station = ReportMain.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="623">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="624">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="625">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="626">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="627">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="628">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="629">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="630">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="631">
          
          
          <code class="ruby">        # Counting FirstPass yield rate, if fp_yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="632">
          
          
          <code class="ruby">        fp_yield_rate = r.fp_yield_rate.nil? ? &#39;No Input&#39; : r.fp_yield_rate.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="633">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="634">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="635">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="636">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="637">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="638">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="639">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="640">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="641">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + fp_yield_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Main/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="642">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="643">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="644">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="645">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="646">
          
          
          <code class="ruby">    File.open(fp_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="647">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="648">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="649">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="650">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="651">
          
          
          <code class="ruby">  def self.generate_today_yield_root_xml(records, today_yield_xml_filename, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="652">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="653">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="654">
          
          
          <code class="ruby">    tmp2 = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="655">
          
          
          <code class="ruby">    Parallel.each(records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="656">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="657">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="658">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="659">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="660">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="661">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="662">
          
          
          <code class="ruby">          last_station = ReportMain.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="663">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="664">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="665">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="666">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="667">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="668">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="669">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="670">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="671">
          
          
          <code class="ruby">        # If yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="672">
          
          
          <code class="ruby">        y_rate = r.yield_rate_today.nil? ? &#39;No Input&#39; : r.yield_rate_today.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="673">
          
          
          <code class="ruby">        y_rate_fp = r.fp_yield_rate_today.nil? ? &#39;No Input&#39; : r.fp_yield_rate_today.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="674">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="675">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="676">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="677">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="678">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="679">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="680">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="681">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="682">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Main/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="683">
          
          
          <code class="ruby">        tmp2 &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate_fp + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Main/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="684">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="685">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="686">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="687">
          
          
          <code class="ruby">    tmp2 &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="688">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="689">
          
          
          <code class="ruby">    File.open(today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="690">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="691">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="692">
          
          
          <code class="ruby">    File.open(fp_today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="693">
          
          
          <code class="ruby">      f &lt;&lt; tmp2</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="694">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="695">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="696">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6a03fc8e0cce2c4c80e8c95510fb1eaf80a96b48">
  <div class="header">
    <h3>app/models/report_mini.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>694</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>694</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">require &quot;activerecord-import/base&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">ActiveRecord::Import.require_adapter(&#39;mysql2&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">class ReportMini &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">  attr_accessible :post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">  :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">  :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :published_at, :p_year, :p_month, :p_mday, :p_hour, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  belongs_to :yield_file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  belongs_to :station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">  validates :post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    :fail_borrow, :pass_borrow, :yield_type, :published_at, :p_year, :p_month, :p_mday, :p_hour, presence: true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">  # Set yield report records per page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">  paginates_per 20</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">  before_validation do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">    if published_at</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      self.p_year = published_at.year</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">      self.p_month = published_at.month</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      self.p_mday = published_at.mday</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      self.p_hour = published_at.hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">  # Caculate yield rate today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">  # If timestamp of hour is 6am, Get year, month, day, post_id and station_name of the base record, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">  # and update each record&#39;s daily yield that belong to the same day with base record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">  before_create do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    if self.p_hour.equal? 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">      records = ReportMini.where(&#39;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">        ((p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_mday = ? AND p_hour BETWEEN ? AND ?))&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">        self.post_id, self.station_name, self.config, self.p_year, self.p_month, self.p_mday, 7, 23, self.p_mday + 1, 0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">      if records.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">        records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">          output_today = (record.first_pass.to_i - self.first_pass.to_i) + (record.retest_pass.to_i - self.retest_pass.to_i) + (record.test_waive.to_i - self.test_waive.to_i) + (record.design_waive.to_i - self.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">          (record.cof_waive.to_i - self.cof_waive.to_i) + (record.ntf.to_i - self.ntf.to_i) + (record.failure_waive.to_i - self.failure_waive.to_i) + (record.repaire_ok.to_i - self.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">          input_today = record.input.to_i - self.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">          if !input_today.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">            yield_rate_today = (output_today.to_f / input_today.to_f) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">            yield_rate_today = yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">            yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">          record.update_attribute(:yield_rate_today, yield_rate_today)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">      # Get first record with same day</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">      datetime = DateTime.parse(self.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">      if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">        # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 7).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        # # If base_record hour have no station, create record data from current hour for the station at base_record hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        # if base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        #   base_record_without_station = ReportMini.where(&quot;post_id = ? AND station_name = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        #   records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        #   columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">        #   begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        #     # Create report items from CSV rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        #     record = ReportMini.new(post_id: self.post_id, yield_file_id: base_record_without_station.yield_file_id, station_id: self.station_id, model: self.model.strip, stage: self.stage.strip, seqno: self.seqno, config: self.config, station_name: self.station_name, input: self.input, first_pass: self.first_pass, retest_pass: self.retest_pass, fail: self.fail, retest_process: self.retest_process, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">        #       test_waive: self.test_waive, design_waive: self.design_waive, cof_waive: self.cof_waive, rd_area: self.rd_area, bpl: self.bpl, ntf: self.ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        #       failure_waive: self.failure_waive, repaire_ok: self.repaire_ok, inl_repaire: self.inl_repaire, dip: self.dip, defect: self.defect, fail_borrow: self.fail_borrow, pass_borrow: self.pass_borrow, yield_type: self.yield_type, yield_rate: self.yield_rate, yield_rate_today: self.yield_rate_today, fp_yield_rate: self.fp_yield_rate, fp_yield_rate_today: self.fp_yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">        #       published_at: base_record_without_station.published_at, p_year: datetime.year, p_month: datetime.month, p_mday: datetime.day, p_hour: base_record_without_station.p_hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">        #     )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">        #     records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">        #   rescue ActiveRecord::RecordInvalid =&gt; invalid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">        #     puts invalid.record.errors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">        #   records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">        #     record.run_callbacks(:create) { false }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">        #   ReportMini.import columns, records, validate: false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">        # # Then check base_record again</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="80">
          
          
          <code class="ruby">        # base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">      elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">        # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">        # # If base_record hour have no station, create record data from current hour for the station at base_record hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">        # if base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">        #   base_record_without_station = ReportMini.where(&quot;post_id = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">        #   records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="88">
          
          
          <code class="ruby">        #   columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">        #   begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">        #     # Create report items from CSV rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="91">
          
          
          <code class="ruby">        #     record = ReportMini.new(post_id: self.post_id, yield_file_id: base_record_without_station.yield_file_id, station_id: self.station_id, model: self.model.strip, stage: self.stage.strip, seqno: self.seqno, config: self.config, station_name: self.station_name, input: self.input, first_pass: self.first_pass, retest_pass: self.retest_pass, fail: self.fail, retest_process: self.retest_process, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="92">
          
          
          <code class="ruby">        #       test_waive: self.test_waive, design_waive: self.design_waive, cof_waive: self.cof_waive, rd_area: self.rd_area, bpl: self.bpl, ntf: self.ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="93">
          
          
          <code class="ruby">        #       failure_waive: self.failure_waive, repaire_ok: self.repaire_ok, inl_repaire: self.inl_repaire, dip: self.dip, defect: self.defect, fail_borrow: self.fail_borrow, pass_borrow: self.pass_borrow, yield_type: self.yield_type, yield_rate: self.yield_rate, yield_rate_today: self.yield_rate_today, fp_yield_rate: self.fp_yield_rate, fp_yield_rate_today: self.fp_yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="94">
          
          
          <code class="ruby">        #       published_at: base_record_without_station.published_at, p_year: datetime.yesterday.year, p_month: datetime.yesterday.month, p_mday: datetime.yesterday.day, p_hour: base_record_without_station.p_hour</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">        #     )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">        #     records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">        #   rescue ActiveRecord::RecordInvalid =&gt; invalid</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">        #     puts invalid.record.errors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">        #   records.each do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="101">
          
          
          <code class="ruby">        #     record.run_callbacks(:create) { false }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="102">
          
          
          <code class="ruby">        #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="103">
          
          
          <code class="ruby">        #   ReportMini.import columns, records, validate: false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="104">
          
          
          <code class="ruby">        # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="105">
          
          
          <code class="ruby">        # # Then check base_record again</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="106">
          
          
          <code class="ruby">        # base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="108">
          
          
          <code class="ruby">      if base_record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="109">
          
          
          <code class="ruby">        output_today = (self.first_pass.to_i - base_record.first_pass.to_i) + (self.retest_pass.to_i - base_record.retest_pass.to_i) + (self.test_waive.to_i - base_record.test_waive.to_i) + (self.design_waive.to_i - base_record.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="110">
          
          
          <code class="ruby">          (self.cof_waive.to_i - base_record.cof_waive.to_i) + (self.ntf.to_i - base_record.ntf.to_i) + (self.failure_waive.to_i - base_record.failure_waive.to_i) + (self.repaire_ok.to_i - base_record.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">        input_today = self.input.to_i - base_record.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">        if !input_today.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">          self.yield_rate_today = (output_today.to_f / input_today.to_f) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="114">
          
          
          <code class="ruby">          self.yield_rate_today = yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="115">
          
          
          <code class="ruby">          self.fp_yield_rate_today = ( (self.first_pass.to_f - base_record.first_pass.to_f) / input_today.to_f ) * 100</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="116">
          
          
          <code class="ruby">          self.fp_yield_rate_today = self.fp_yield_rate_today.round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="117">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="118">
          
          
          <code class="ruby">          self.yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">          self.fp_yield_rate_today = nil # Subtracted input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="120">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="121">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="122">
          
          
          <code class="ruby">        # If base_record not found, set current record as base_record!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="123">
          
          
          <code class="ruby">        self.yield_rate_today = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">  SORT_NAMES = %w(</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="129">
          
          
          <code class="ruby">    published_at model stage seqno station_name yield_rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="130">
          
          
          <code class="ruby">  )</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="132">
          
          
          <code class="ruby">  def self.sort_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="133">
          
          
          <code class="ruby">    SORT_NAMES</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="134">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">  def base_record?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">    datetime = DateTime.parse(self.published_at.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">    if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="139">
          
          
          <code class="ruby">      return ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.year, datetime.month, datetime.day, 6, self.p_hour-1).first.equal? nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="140">
          
          
          <code class="ruby">    elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="141">
          
          
          <code class="ruby">      look_from_yesterday = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6, 23).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="142">
          
          
          <code class="ruby">      look_from_today = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, self.post_id, self.station_name, self.config, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 0, self.p_hour-1).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="143">
          
          
          <code class="ruby">      return look_from_yesterday.nil? &amp;&amp; look_from_today.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="144">
          
          
          <code class="ruby">    else # datetime.hour is 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="145">
          
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="146">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="147">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="149">
          
          
          <code class="ruby">  def self.group_accu_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="150">
          
          
          <code class="ruby">    reports = where(&quot;yield_rate IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="151">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="152">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(yield_rate) as worst_accu_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="153">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="156">
          
          
          <code class="ruby">  def self.group_daily_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="157">
          
          
          <code class="ruby">    reports = where(&quot;yield_rate_today IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="159">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(yield_rate_today) as worst_daily_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="160">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="161">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="163">
          
          
          <code class="ruby">  def self.group_fp_accu_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="164">
          
          
          <code class="ruby">    reports = where(&quot;fp_yield_rate IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="165">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="166">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(fp_yield_rate) as worst_fp_accu_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="167">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_fp_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="168">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="170">
          
          
          <code class="ruby">  def self.group_fp_daily_yield_by_date(date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="171">
          
          
          <code class="ruby">    reports = where(&quot;fp_yield_rate_today IS NOT NULL AND published_at = ?&quot;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="172">
          
          
          <code class="ruby">    reports = reports.group(&quot;station_name&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="173">
          
          
          <code class="ruby">    reports = reports.select(&quot;station_name, min(fp_yield_rate_today) as worst_fp_daily_yield&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="174">
          
          
          <code class="ruby">    reports = reports.order(&quot;worst_fp_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="175">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="178">
          
          
          <code class="ruby">  def self.group_station_accu_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="179">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND yield_rate IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="180">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(yield_rate) as worst_accu_yield&quot;).order(&quot;worst_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="181">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="183">
          
          
          <code class="ruby">  def self.group_station_daily_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="184">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND yield_rate_today IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="185">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(yield_rate_today) as worst_daily_yield&quot;).order(&quot;worst_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="186">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">  def self.group_station_fp_accu_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="189">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND fp_yield_rate IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="190">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(fp_yield_rate) as worst_fp_accu_yield&quot;).order(&quot;worst_fp_accu_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="191">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="192">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="193">
          
          
          <code class="ruby">  def self.group_station_fp_daily_yield_by_date(date_time, station)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="194">
          
          
          <code class="ruby">    reports = where(&quot;station_name = ? AND config != ? AND published_at = ? AND fp_yield_rate_today IS NOT NULL&quot;, station, &#39;ALL&#39;, date_time)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="195">
          
          
          <code class="ruby">    reports = reports.group(&quot;config&quot;).select(&quot;config, min(fp_yield_rate_today) as worst_fp_daily_yield&quot;).order(&quot;worst_fp_daily_yield ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="196">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="198">
          
          
          <code class="ruby">  # The &#39;import&#39; function can be used both on web and rake script</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="199">
          
          
          <code class="ruby">  def self.import_data(file, filename, post)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="200">
          
          
          <code class="ruby">    # Check filename</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="201">
          
          
          <code class="ruby">    if csvfile = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="202">
          
          
          <code class="ruby">      yf_id = csvfile.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="203">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="204">
          
          
          <code class="ruby">      line_count = CSV.open(file, &quot;r&quot;).readlines.count - 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="205">
          
          
          <code class="ruby">      # Set published_at from file name, and create the file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="206">
          
          
          <code class="ruby">      file_datetime = filename[filename.index(&#39;20&#39;), 12]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="207">
          
          
          <code class="ruby">      yield_file = YieldFile.create(post_id: post.id, file_name: filename, total_row: line_count, published_at: file_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">      yf_id = yield_file.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    # Define the folder path of XML files, and then delete all files before importing new csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="212">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="213">
          
          
          <code class="ruby">    file_model_stage_name = filename[filename.index(&#39;20&#39;)+12..filename.index(&#39;.csv&#39;)-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="214">
          
          
          <code class="ruby">    file_stage_name = file_model_stage_name[file_model_stage_name.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="215">
          
          
          <code class="ruby">    file_model_name = file_model_stage_name.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="216">
          
          
          <code class="ruby">    # if filename.include? &quot;Sum-Config&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="217">
          
          
          <code class="ruby">    #   # All XML files in JHxC folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="218">
          
          
          <code class="ruby">    #   files_to_clear = base_dir + file_stage_name.to_s + &quot;/&quot; + file_model_name.to_s + &quot;C/*&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">    # else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="220">
          
          
          <code class="ruby">    #   # All XML files in JHx folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="221">
          
          
          <code class="ruby">    #   files_to_clear = base_dir + file_stage_name.to_s + &quot;/&quot; + file_model_name.to_s+ &quot;/*&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="223">
          
          
          <code class="ruby">    # FileUtils.rm_rf Dir.glob(files_to_clear)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">    ReportMini.transaction do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="226">
          
          
          <code class="ruby">      records = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">      columns = [:post_id, :yield_file_id, :station_id, :model, :stage, :seqno, :config, :station_name, :input, :first_pass, :retest_pass, :fail, :retest_process, :test_waive, :design_waive, :cof_waive, :rd_area, :bpl, :ntf, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="228">
          
          
          <code class="ruby">        :failure_waive, :repaire_ok, :inl_repaire, :dip, :defect, :fail_borrow, :pass_borrow, :yield_type, :yield_rate, :yield_rate_today, :fp_yield_rate, :fp_yield_rate_today, :published_at, :p_year, :p_month, :p_mday, :p_hour]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">      CSV.foreach(file, {encoding: &quot;UTF-8&quot;, quote_char: &#39;&quot;&#39;, col_sep: &#39;,&#39;, row_sep: :auto, headers: true}) do |row|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">        # Create station model and set station_id to Report obj</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">        if station = Station.find_by_name_and_post_id(row[&#39;Station&#39;], post.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="233">
          
          
          <code class="ruby">          sta_id = station.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">          station = Station.create(post_id: post.id, yield_file_id: yf_id, name: row[&#39;Station&#39;])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">          sta_id = station.id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">        # Caculate accumulative yield rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">        if !row[&#39;Input&#39;].to_i.equal? 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">          total = row[&#39;PFirstPass&#39;].to_i + row[&#39;PRetestPass&#39;].to_i + row[&#39;TestWF&#39;].to_i + row[&#39;DesignWF&#39;].to_i + row[&#39;COFWF&#39;].to_i + row[&#39;NTF&#39;].to_i + row[&#39;FailureWF&#39;].to_i + row[&#39;RepairOK&#39;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">          yield_rate = ( (total.to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">          # Caculate FirstPass yield rate</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="243">
          
          
          <code class="ruby">          fp_yield_rate = ( (row[&#39;PFirstPass&#39;].to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">          # Caculate FirstPass yield rate today</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="245">
          
          
          <code class="ruby">          fp_yield_rate_today = ( (row[&#39;PFirstPass&#39;].to_f / row[&#39;Input&#39;].to_f) * 100 ).round(2)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="247">
          
          
          <code class="ruby">          yield_rate = 99999 # Input is 0, show &#39;N/A&#39; in page</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="248">
          
          
          <code class="ruby">          fp_yield_rate = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="249">
          
          
          <code class="ruby">          fp_yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="250">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="252">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="253">
          
          
          <code class="ruby">        if Time.parse(row[&#39;Date&#39;]).hour.to_i.equal? 6</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="254">
          
          
          <code class="ruby">          records_to_be_update = ReportMini.where(&#39;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="255">
          
          
          <code class="ruby">            ((p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_mday = ? AND p_hour BETWEEN ? AND ?))&#39;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="256">
          
          
          <code class="ruby">            post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, Time.parse(row[&#39;Date&#39;]).year.to_i, Time.parse(row[&#39;Date&#39;]).month.to_i, Time.parse(row[&#39;Date&#39;]).day.to_i, 7, 23, Time.parse(row[&#39;Date&#39;]).day.to_i + 1, 0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="257">
          
          
          <code class="ruby">          if records_to_be_update.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="258">
          
          
          <code class="ruby">            Parallel.each(records_to_be_update, in_threads: 4) do |record|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">              ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">                output_today = (record.first_pass.to_i - row[&#39;PFirstPass&#39;].to_i) + (record.retest_pass.to_i - row[&#39;PRetestPass&#39;].to_i) + (record.test_waive.to_i - row[&#39;TestWF&#39;].to_i) + (record.design_waive.to_i - row[&#39;DesignWF&#39;].to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="261">
          
          
          <code class="ruby">                (record.cof_waive.to_i - row[&#39;COFWF&#39;].to_i) + (record.ntf.to_i - row[&#39;NTF&#39;].to_i) + (record.failure_waive.to_i - row[&#39;FailureWF&#39;].to_i) + (record.repaire_ok.to_i - row[&#39;RepairOK&#39;].to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="262">
          
          
          <code class="ruby">                input_today = record.input.to_i - row[&#39;Input&#39;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="263">
          
          
          <code class="ruby">                yield_rate_today = input_today &gt; 0 ? ( (output_today.to_f / input_today.to_f) * 100 ).round(2) : nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">                record.update_attribute(:yield_rate_today, yield_rate_today)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="268">
          
          
          <code class="ruby">          input_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby">          output_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">          yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">          datetime = DateTime.parse(row[&#39;Date&#39;].to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">          if datetime.hour.between?(7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">            # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">            base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, datetime.year, datetime.month, datetime.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">          elsif datetime.hour.between?(0, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="277">
          
          
          <code class="ruby">            # If no base_record at 6am, get the record that &#39;p_hour&#39; mostly close to 6 am as base_record </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">            base_record = ReportMini.where(&quot;post_id = ? AND station_name = ? AND config = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour &gt;= ?&quot;, post.id, row[&#39;Station&#39;].to_s, row[&#39;Config&#39;].to_s, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 6).order(&quot;p_hour ASC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">          if base_record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">            output_today = (row[&#39;PFirstPass&#39;].to_i - base_record.first_pass.to_i) + (row[&#39;PRetestPass&#39;].to_i - base_record.retest_pass.to_i) + (row[&#39;TestWF&#39;].to_i - base_record.test_waive.to_i) + (row[&#39;DesignWF&#39;].to_i - base_record.design_waive.to_i) + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">              (row[&#39;COFWF&#39;].to_i - base_record.cof_waive.to_i) + (row[&#39;NTF&#39;].to_i - base_record.ntf.to_i) + (row[&#39;FailureWF&#39;].to_i - base_record.failure_waive.to_i) + (row[&#39;RepairOK&#39;].to_i - base_record.repaire_ok.to_i)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="284">
          
          
          <code class="ruby">            input_today = row[&#39;Input&#39;].to_i - base_record.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">            yield_rate_today = input_today &gt; 0 ? ( (output_today.to_f / input_today.to_f) * 100 ).round(2) : 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">            fp_yield_rate_today = input_today &gt; 0 ? ( ( (row[&#39;PFirstPass&#39;].to_f - base_record.first_pass.to_f) / input_today.to_f ) * 100 ).round(2) : 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">            input_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">            output_today = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="290">
          
          
          <code class="ruby">            yield_rate_today = 99999</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="291">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby">        time_now = Time.now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;).to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">        #record = &quot;(#{post.id}, #{yf_id}, #{sta_id}, &#39;#{row[&#39;Model&#39;].strip}&#39;, &#39;#{row[&#39;Stage&#39;].strip}&#39;, #{row[&#39;Seqno&#39;]}, &#39;#{row[&#39;Config&#39;]}&#39;, &#39;#{row[&#39;Station&#39;]}&#39;, #{row[&#39;Input&#39;]}, #{row[&#39;PFirstPass&#39;]}, #{row[&#39;PRetestPass&#39;]}, #{row[&#39;Fail&#39;]}, #{row[&#39;RetestProcess&#39;]}, #{row[&#39;TestWF&#39;]}, #{row[&#39;DesignWF&#39;]}, #{row[&#39;COFWF&#39;]}, #{row[&#39;RDArea&#39;]}, #{row[&#39;BPL&#39;]}, #{row[&#39;NTF&#39;]}, #{row[&#39;FailureWF&#39;]}, #{row[&#39;RepairOK&#39;]}, #{row[&#39;INLRepair&#39;]}, #{row[&#39;DIP&#39;]}, #{row[&#39;Defect&#39;]}, #{row[&#39;Fail_Borrow&#39;]}, #{row[&#39;Pass_Borrow&#39;]}, &#39;#{row[&#39;Type&#39;]}&#39;, #{yield_rate}, NULL, #{fp_yield_rate}, #{fp_yield_rate_today}, &#39;#{row[&#39;Date&#39;]}&#39;, #{Time.parse(row[&#39;Date&#39;]).year}, #{Time.parse(row[&#39;Date&#39;]).month}, #{Time.parse(row[&#39;Date&#39;]).day}, #{Time.parse(row[&#39;Date&#39;]).hour}, &#39;#{time_now}&#39;, &#39;#{time_now}&#39;)&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="297">
          
          
          <code class="ruby">        #records += records.length == 0 ? &quot;#{record}&quot; : &quot;, #{record}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="298">
          
          
          <code class="ruby">        record = [post.id, yf_id, sta_id, row[&#39;Model&#39;].strip.to_s, row[&#39;Stage&#39;].strip.to_s, row[&#39;Seqno&#39;], row[&#39;Config&#39;].to_s, row[&#39;Station&#39;].to_s, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">          row[&#39;Input&#39;], row[&#39;PFirstPass&#39;], row[&#39;PRetestPass&#39;], row[&#39;Fail&#39;], row[&#39;RetestProcess&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="300">
          
          
          <code class="ruby">          row[&#39;TestWF&#39;], row[&#39;DesignWF&#39;], row[&#39;COFWF&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="301">
          
          
          <code class="ruby">          row[&#39;RDArea&#39;], row[&#39;BPL&#39;], row[&#39;NTF&#39;], row[&#39;FailureWF&#39;], row[&#39;RepairOK&#39;], row[&#39;INLRepair&#39;], </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="302">
          
          
          <code class="ruby">          row[&#39;DIP&#39;], row[&#39;Defect&#39;], row[&#39;Fail_Borrow&#39;], row[&#39;Pass_Borrow&#39;], row[&#39;Type&#39;].to_s, yield_rate, yield_rate_today, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="303">
          
          
          <code class="ruby">          fp_yield_rate, fp_yield_rate_today, row[&#39;Date&#39;].to_s, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="304">
          
          
          <code class="ruby">          Time.parse(row[&#39;Date&#39;]).year, Time.parse(row[&#39;Date&#39;]).month, Time.parse(row[&#39;Date&#39;]).day, Time.parse(row[&#39;Date&#39;]).hour, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">          time_now, time_now, input_today, output_today]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">        records &lt;&lt; record</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="309">
          
          
          <code class="ruby">      #values = records.map{ |record| &quot;(#{record.join(&quot;,&quot;)})&quot; }.join(&quot;,&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby">      #values = records.map{|record| &quot;(#{record.map! {|c| record.find_index(c)==3 || record.find_index(c)==4 ? c=&#39;\&#39;c\&#39;&#39; : c}.join(&#39;,&#39;)})&quot;}.join(&#39;,&#39;).gsub(&#39;99999&#39;, &#39;NULL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="311">
          
          
          <code class="ruby">      values = records.map{ |record| &quot;(#{record[0]}, #{record[1]}, #{record[2]}, &#39;#{record[3]}&#39;, &#39;#{record[4]}&#39;, #{record[5]}, &#39;#{record[6]}&#39;, &#39;#{record[7]}&#39;, #{record[8]}, #{record[9]}, #{record[10]}, #{record[11]}, #{record[12]}, #{record[13]}, #{record[14]}, #{record[15]}, #{record[16]}, #{record[17]}, #{record[18]}, #{record[19]}, #{record[20]}, #{record[21]}, #{record[22]}, #{record[23]}, #{record[24]}, #{record[25]}, &#39;#{record[26]}&#39;, #{record[27]}, #{record[28]}, #{record[29]}, #{record[30]}, &#39;#{record[31]}&#39;, #{record[32]}, #{record[33]}, #{record[34]}, #{record[35]}, &#39;#{record[36]}&#39;, &#39;#{record[37]}&#39;, &#39;#{record[38]}&#39;, &#39;#{record[39]}&#39;)&quot; }.join(&quot;,&quot;).gsub(&#39;99999&#39;, &#39;NULL&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="312">
          
          
          <code class="ruby">      sql = &quot;INSERT INTO `#{self.table_name}` (`post_id`,`yield_file_id`,`station_id`,`model`,`stage`,`seqno`,`config`,`station_name`,`input`,`first_pass`,`retest_pass`,`fail`,`retest_process`,`test_waive`,`design_waive`,`cof_waive`,`rd_area`,`bpl`,`ntf`,`failure_waive`,`repaire_ok`,`inl_repaire`,`dip`,`defect`,`fail_borrow`,`pass_borrow`,`yield_type`,`yield_rate`,`yield_rate_today`,`fp_yield_rate`,`fp_yield_rate_today`,`published_at`,`p_year`,`p_month`,`p_mday`,`p_hour`,`created_at`,`updated_at`,`input_today`,`output_today`) VALUES #{values}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="313">
          
          
          <code class="ruby">      #ActiveRecord::Base.connection.execute(sql)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do |conn|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">        conn.execute(sql)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="316">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="317">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="318">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">    # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="320">
          
          
          <code class="ruby">    the_year = filename[filename.index(&#39;20&#39;), 4]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    the_month = filename[filename.index(&#39;20&#39;)+4, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="322">
          
          
          <code class="ruby">    the_day = filename[filename.index(&#39;20&#39;)+6, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="323">
          
          
          <code class="ruby">    the_hour = filename[filename.index(&#39;20&#39;)+8, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="324">
          
          
          <code class="ruby">    post.update_attributes(current_year_mini: the_year, current_month_mini: the_month, current_mday_mini: the_day, current_hour_mini: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">    # # Delete last hour&#39;s records from database (For always only keep 2 groups of hourly records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="327">
          
          
          <code class="ruby">    # the_post = Post.find_by_id(post.id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="328">
          
          
          <code class="ruby">    # the_year = filename[filename.index(&#39;20&#39;), 4]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="329">
          
          
          <code class="ruby">    # the_month = filename[filename.index(&#39;20&#39;)+4, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="330">
          
          
          <code class="ruby">    # the_day = filename[filename.index(&#39;20&#39;)+6, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="331">
          
          
          <code class="ruby">    # the_hour = filename[filename.index(&#39;20&#39;)+8, 2]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">    # if !the_post.current_hour_mini.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    #   if !the_post.current_hour_mini.to_s.eql? the_hour.to_i.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="334">
          
          
          <code class="ruby">    #     if !(the_hour.to_i &gt;= 6 &amp;&amp; the_post.current_hour_mini.to_i &lt; 6)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="335">
          
          
          <code class="ruby">    #       check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, file_model_stage_name, the_post.current_year_mini, the_post.current_month_mini, the_post.current_mday_mini, 6, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="336">
          
          
          <code class="ruby">    #       grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="337">
          
          
          <code class="ruby">    #       if grup_hour.count &gt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="338">
          
          
          <code class="ruby">    #         puts &quot;Deleting old timestamp MINI records...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="339">
          
          
          <code class="ruby">    #         ReportMini.where(stage: file_model_stage_name, p_year: the_post.current_year_mini, p_month: the_post.current_month_mini, p_mday: the_post.current_mday_mini, p_hour: the_post.current_hour_mini).destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="340">
          
          
          <code class="ruby">    #       end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="341">
          
          
          <code class="ruby">    #     end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="342">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="343">
          
          
          <code class="ruby">    # end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="344">
          
          
          <code class="ruby">    # # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="345">
          
          
          <code class="ruby">    # Post.find_by_id(post.id).update_attributes(current_year_mini: the_year, current_month_mini: the_month, current_mday_mini: the_day, current_hour_mini: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="346">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="348">
          
          
          <code class="ruby">  def self.delete_overdue_records_beta(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="349">
          
          
          <code class="ruby">    # Delete overdue data records from database (Always keep only 2 groups of hourly timestamp records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="350">
          
          
          <code class="ruby">    the_post = Post.find_by_title(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="351">
          
          
          <code class="ruby">    the_year = the_post.current_year_mini</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="352">
          
          
          <code class="ruby">    the_month = the_post.current_month_mini</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="353">
          
          
          <code class="ruby">    the_day = the_post.current_mday_mini</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="354">
          
          
          <code class="ruby">    the_hour = the_post.current_hour_mini</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="355">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="356">
          
          
          <code class="ruby">    if !the_hour.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="357">
          
          
          <code class="ruby">      datetime = DateTime.parse(the_year.to_s + sprintf(&#39;%02d&#39;, the_month).to_s + the_day.to_s)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="358">
          
          
          <code class="ruby">      if the_hour.to_i == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="359">
          
          
          <code class="ruby">        check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="360">
          
          
          <code class="ruby">          file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="361">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(1, 5)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="362">
          
          
          <code class="ruby">        check_base_record = ReportMini.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="363">
          
          
          <code class="ruby">          file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="364">
          
          
          <code class="ruby">          the_year, the_month, the_day, 0, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="365">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(6, 7)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="366">
          
          
          <code class="ruby">        yesterday_latest_midnight_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="367">
          
          
          <code class="ruby">          file_model_stage_name, the_year, the_month, the_day, 0, 5).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="368">
          
          
          <code class="ruby">        if yesterday_latest_midnight_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="369">
          
          
          <code class="ruby">          yesterday_latest_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="370">
          
          
          <code class="ruby">            file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="371">
          
          
          <code class="ruby">          if !yesterday_latest_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="372">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="373">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, yesterday_latest_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="374">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="375">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="376">
          
          
          <code class="ruby">              file_model_stage_name, the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="377">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="378">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="379">
          
          
          <code class="ruby">          if yesterday_latest_midnight_record.p_hour == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="380">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="381">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="382">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="383">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="384">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="385">
          
          
          <code class="ruby">              the_year, the_month, the_day, 0, yesterday_latest_midnight_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="386">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="387">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="388">
          
          
          <code class="ruby">      elsif the_hour.to_i.between?(8, 23)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="389">
          
          
          <code class="ruby">        yesterday_latest_midnight_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="390">
          
          
          <code class="ruby">          file_model_stage_name, the_year, the_month, the_day, 0, 5).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="391">
          
          
          <code class="ruby">        if yesterday_latest_midnight_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="392">
          
          
          <code class="ruby">          yesterday_latest_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="393">
          
          
          <code class="ruby">            file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23).order(&quot;published_at DESC&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="394">
          
          
          <code class="ruby">          if !yesterday_latest_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="395">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="396">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, yesterday_latest_record.p_hour.to_i-1,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="397">
          
          
          <code class="ruby">              the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="398">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="399">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="400">
          
          
          <code class="ruby">          if yesterday_latest_midnight_record.p_hour == 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="401">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="402">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="403">
          
          
          <code class="ruby">              the_year, the_month, the_day, 7, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="404">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="405">
          
          
          <code class="ruby">            check_base_record = ReportMini.where(&quot;stage = ? AND ( (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) OR (p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?) )&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="406">
          
          
          <code class="ruby">              file_model_stage_name, datetime.yesterday.year, datetime.yesterday.month, datetime.yesterday.day, 7, 23,</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="407">
          
          
          <code class="ruby">              the_year, the_month, the_day, 0, yesterday_latest_midnight_record.p_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="408">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="409">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="410">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="411">
          
          
          <code class="ruby">      if !check_base_record.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="412">
          
          
          <code class="ruby">        grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="413">
          
          
          <code class="ruby">        if grup_hour.count &gt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="414">
          
          
          <code class="ruby">          puts &quot;Deleting overdue Sum-Mini records from database...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="415">
          
          
          <code class="ruby">          check_base_record.destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="416">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="417">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="418">
          
          
          <code class="ruby">        puts &quot;No overdue records to be delete!&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="419">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="420">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="421">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="422">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="423">
          
          
          <code class="ruby">  def self.delete_overdue_records(file_model_stage_name, latest_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="424">
          
          
          <code class="ruby">    # Delete overdue data records from database (Always keep only 2 groups of hourly timestamp records)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="425">
          
          
          <code class="ruby">    the_post = Post.find_by_title(file_model_stage_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="426">
          
          
          <code class="ruby">    the_year = latest_datetime[0..3]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="427">
          
          
          <code class="ruby">    the_month = latest_datetime[4..5]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="428">
          
          
          <code class="ruby">    the_day = latest_datetime[6..7]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="429">
          
          
          <code class="ruby">    the_hour = latest_datetime[8..9]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="430">
          
          
          <code class="ruby">    if !the_post.current_hour.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="431">
          
          
          <code class="ruby">      if !the_post.current_hour.to_s.eql? the_hour.to_i.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="432">
          
          
          <code class="ruby">        if !(the_hour.to_i &gt;= 6 &amp;&amp; the_post.current_hour.to_i &lt; 6)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="433">
          
          
          <code class="ruby">          check_base_record = ReportMini.where(&quot;stage = ? AND p_year = ? AND p_month = ? AND p_mday = ? AND p_hour BETWEEN ? AND ?&quot;, file_model_stage_name, the_post.current_year_mini, the_post.current_month_mini, the_post.current_mday_mini, 6, the_hour.to_i-1)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="434">
          
          
          <code class="ruby">          grup_hour = check_base_record.group(&quot;p_hour&quot;).count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="435">
          
          
          <code class="ruby">          if grup_hour.count &gt; 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="436">
          
          
          <code class="ruby">            puts &quot;Deleting overdue Sum-All and Sum-Config records from database...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="437">
          
          
          <code class="ruby">            ReportMini.where(stage: file_model_stage_name, p_year: the_post.current_year_mini, p_month: the_post.current_month_mini, p_mday: the_post.current_mday_mini, p_hour: the_post.current_hour_mini).destroy_all</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="438">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="439">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="440">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="441">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="442">
          
          
          <code class="ruby">    # Then, update timestamp fields of post record to save the current timestamp of csv file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="443">
          
          
          <code class="ruby">    the_post.update_attributes(current_year_mini: the_year, current_month_mini: the_month, current_mday_mini: the_day, current_hour_mini: the_hour)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="444">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="445">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="446">
          
          
          <code class="ruby">  def self.export_dummy_xml(target_stage, latest_datetime)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="447">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="448">
          
          
          <code class="ruby">    puts &quot;Start generating dummy (Mini) XML files to &quot; + base_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="449">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="450">
          
          
          <code class="ruby">    stage_name = target_stage.to_s[target_stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="451">
          
          
          <code class="ruby">    model_name = target_stage.to_s.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="452">
          
          
          <code class="ruby">    xml_root_dir = base_dir + stage_name.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="453">
          
          
          <code class="ruby">    station_xml_folder = xml_root_dir + &quot;/&quot; + model_name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="454">
          
          
          <code class="ruby">    # Create folder for XML files if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="455">
          
          
          <code class="ruby">    FileUtils.mkdir_p xml_root_dir unless Dir.exist?(xml_root_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="456">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="457">
          
          
          <code class="ruby">    sum_all_root_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="458">
          
          
          <code class="ruby">    sum_all_fp_root_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_F.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="459">
          
          
          <code class="ruby">    today_yield_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_T.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="460">
          
          
          <code class="ruby">    fp_today_yield_xml_filename = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_FT.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="461">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="462">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + target_stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + latest_datetime.to_s + &quot;&lt;/pubDate&gt;\n&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="463">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="464">
          
          
          <code class="ruby">    # Write dummy xml content to the files </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="465">
          
          
          <code class="ruby">    File.open(sum_all_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="466">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="467">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="468">
          
          
          <code class="ruby">    File.open(sum_all_fp_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="469">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="470">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="471">
          
          
          <code class="ruby">    File.open(today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="472">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="473">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="474">
          
          
          <code class="ruby">    File.open(fp_today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="475">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="476">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="477">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="478">
          
          
          <code class="ruby">    # Generate dummy XML folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="479">
          
          
          <code class="ruby">    station_xml_folder = xml_root_dir + &quot;/&quot; + model_name.to_s + &quot;Mini&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="480">
          
          
          <code class="ruby">    FileUtils.mkdir_p station_xml_folder unless Dir.exist?(station_xml_folder)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="481">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="482">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="483">
          
          
          <code class="ruby">  def self.export_to_xml(target_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="484">
          
          
          <code class="ruby">    model_stage = Post.uniq.pluck(:title)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="485">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="486">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="487">
          
          
          <code class="ruby">    puts &quot;Start to exporting Mini-build XML files to &quot; + base_dir</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="488">
          
          
          <code class="ruby">    start_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="489">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="490">
          
          
          <code class="ruby">    model_stage.each do |s|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="491">
          
          
          <code class="ruby">      if s.eql? target_stage</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="492">
          
          
          <code class="ruby">        stage_name = s.to_s[s.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="493">
          
          
          <code class="ruby">        model_name = s.to_s.split(&#39;-&#39;)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="494">
          
          
          <code class="ruby">        xml_root_dir = base_dir + stage_name.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="495">
          
          
          <code class="ruby">        station_xml_folder = xml_root_dir + &quot;/&quot; + model_name + &quot;Mini&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="496">
          
          
          <code class="ruby">        # Create folder for XML files if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="497">
          
          
          <code class="ruby">        FileUtils.mkdir_p xml_root_dir unless Dir.exist?(xml_root_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="498">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="499">
          
          
          <code class="ruby">        # Generating station&#39;s XML files for Sum-All data</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="500">
          
          
          <code class="ruby">        sum_all_latest_record = ReportMini.where(&quot;stage = ?&quot;, s).order(&quot;published_at DESC&quot;).limit(1)[0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="501">
          
          
          <code class="ruby">        sum_all_records = ReportMini.where(&quot;stage = ? AND published_at = ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="502">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="503">
          
          
          <code class="ruby">        sum_all_records_fp = ReportMini.where(&quot;stage = ? AND published_at = ? AND fp_yield_rate IS NOT NULL&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="504">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="505">
          
          
          <code class="ruby">        today_yield_records = ReportMini.where(&quot;stage = ? AND published_at = ?&quot;, </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="506">
          
          
          <code class="ruby">          s, sum_all_latest_record.published_at).order(&quot;seqno ASC&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="507">
          
          
          <code class="ruby">        # Generate station&#39;s XML file for Sum-All records</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="508">
          
          
          <code class="ruby">        Parallel.each(sum_all_records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="509">
          
          
          <code class="ruby">          ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="510">
          
          
          <code class="ruby">            self.generate_station_xml(r)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="511">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="512">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="513">
          
          
          <code class="ruby">        sum_all_root_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="514">
          
          
          <code class="ruby">        sum_all_fp_root_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_F.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="515">
          
          
          <code class="ruby">        today_yield_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_T.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="516">
          
          
          <code class="ruby">        fp_today_yield_xml_filename = xml_root_dir + &quot;/&quot; + sum_all_latest_record.model.to_s + &quot;byConfig&quot; + &quot;/&quot; + &quot;Mini_FT.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="517">
          
          
          <code class="ruby">        # Generate root XML file in specific stage folder</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="518">
          
          
          <code class="ruby">        self.generate_root_xml(sum_all_records, sum_all_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="519">
          
          
          <code class="ruby">        self.generate_fp_root_xml(sum_all_records, sum_all_records_fp, sum_all_fp_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="520">
          
          
          <code class="ruby">        self.generate_today_yield_root_xml(today_yield_records, today_yield_xml_filename, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="521">
          
          
          <code class="ruby">        #self.generate_fp_today_yield_root_xml(today_yield_records, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="522">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="523">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="524">
          
          
          <code class="ruby">    end_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="525">
          
          
          <code class="ruby">    puts &quot;Completed exporting (Mini) XML files in #{(end_time - start_time)} seconds&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="526">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="527">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="528">
          
          
          <code class="ruby">  def self.generate_station_xml(record)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="529">
          
          
          <code class="ruby">    xml_header = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;title&gt;&quot; + record.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;) + &quot; Detail&quot; + &quot;&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="530">
          
          
          <code class="ruby">    xml_model = &quot;&lt;item&gt;&lt;title&gt;Model&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.model.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="531">
          
          
          <code class="ruby">    xml_stage = &quot;&lt;item&gt;&lt;title&gt;Stage&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.stage.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="532">
          
          
          <code class="ruby">    xml_config = &quot;&lt;item&gt;&lt;title&gt;Config&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.config.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="533">
          
          
          <code class="ruby">    xml_station = &quot;&lt;item&gt;&lt;title&gt;Station&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="534">
          
          
          <code class="ruby">    xml_input = &quot;&lt;item&gt;&lt;title&gt;Input&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.input.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="535">
          
          
          <code class="ruby">    xml_first_pass = &quot;&lt;item&gt;&lt;title&gt;FirstPass&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.first_pass.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="536">
          
          
          <code class="ruby">    xml_retest_pass = &quot;&lt;item&gt;&lt;title&gt;RetestPass&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.retest_pass.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="537">
          
          
          <code class="ruby">    xml_fail = &quot;&lt;item&gt;&lt;title&gt;FailOnlineFail&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="538">
          
          
          <code class="ruby">    xml_retest_process = &quot;&lt;item&gt;&lt;title&gt;RetestProcess&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.retest_process.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="539">
          
          
          <code class="ruby">    xml_test_waive = &quot;&lt;item&gt;&lt;title&gt;TestWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.test_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="540">
          
          
          <code class="ruby">    xml_design_waive = &quot;&lt;item&gt;&lt;title&gt;DesignWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.design_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="541">
          
          
          <code class="ruby">    xml_cof_waive = &quot;&lt;item&gt;&lt;title&gt;COFWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.cof_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="542">
          
          
          <code class="ruby">    xml_rd_area = &quot;&lt;item&gt;&lt;title&gt;RDArea&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.rd_area.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="543">
          
          
          <code class="ruby">    xml_bpl = &quot;&lt;item&gt;&lt;title&gt;BoundtoPL&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.bpl.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="544">
          
          
          <code class="ruby">    xml_ntf = &quot;&lt;item&gt;&lt;title&gt;NTF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.ntf.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="545">
          
          
          <code class="ruby">    xml_failure_waive = &quot;&lt;item&gt;&lt;title&gt;FailureWF&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.failure_waive.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="546">
          
          
          <code class="ruby">    xml_repaire_ok = &quot;&lt;item&gt;&lt;title&gt;RepairOK&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.repaire_ok.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="547">
          
          
          <code class="ruby">    xml_inl_repaire = &quot;&lt;item&gt;&lt;title&gt;INLRepair&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.inl_repaire.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="548">
          
          
          <code class="ruby">    xml_dip = &quot;&lt;item&gt;&lt;title&gt;DIPScrap&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.dip.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="549">
          
          
          <code class="ruby">    xml_defect = &quot;&lt;item&gt;&lt;title&gt;Defect&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.defect.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="550">
          
          
          <code class="ruby">    xml_fail_borrow = &quot;&lt;item&gt;&lt;title&gt;Fail_Borrow&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.fail_borrow.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="551">
          
          
          <code class="ruby">    xml_pass_borrow = &quot;&lt;item&gt;&lt;title&gt;Pass_Borrow&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.pass_borrow.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="552">
          
          
          <code class="ruby">    xml_yield_type = &quot;&lt;item&gt;&lt;title&gt;Type&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.yield_type.to_s + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="553">
          
          
          <code class="ruby">    xml_ctime = &quot;&lt;item&gt;&lt;title&gt;CTime&lt;/title&gt;\n&lt;pubDate&gt;&quot; + record.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;1&lt;/link&gt;&lt;yield&gt;1&lt;/yield&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="554">
          
          
          <code class="ruby">    xml_footer = &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="555">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="556">
          
          
          <code class="ruby">    base_dir = base_dir = &quot;/Users/&quot; + ENV[&#39;USER&#39;] + &quot;/desktop/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="557">
          
          
          <code class="ruby">    stage_name = record.stage.to_s[record.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="558">
          
          
          <code class="ruby">    xml_target_dir = base_dir + stage_name + &quot;/&quot; + record.model.to_s + &quot;Mini&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="559">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="560">
          
          
          <code class="ruby">    # Create xml folder if it does not exist</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="561">
          
          
          <code class="ruby">    FileUtils.mkdir_p xml_target_dir unless Dir.exist?(xml_target_dir)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="562">
          
          
          <code class="ruby">    # Define the xml file path (And removes all non-alphanumber characters from station_name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="563">
          
          
          <code class="ruby">    local_filename = xml_target_dir + &quot;/&quot; + record.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;) + &quot;.xml&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="564">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="565">
          
          
          <code class="ruby">    File.open(local_filename, &#39;w&#39;) { |f| f.write(xml_header + xml_model + xml_stage + xml_config + xml_station + xml_input + xml_first_pass + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="566">
          
          
          <code class="ruby">      xml_retest_pass + xml_fail + xml_retest_process + xml_test_waive + xml_design_waive + xml_cof_waive + xml_rd_area + xml_bpl + xml_ntf + xml_failure_waive + </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="567">
          
          
          <code class="ruby">      xml_repaire_ok + xml_inl_repaire + xml_dip + xml_defect + xml_fail_borrow + xml_pass_borrow + xml_yield_type + xml_ctime + xml_footer) }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="568">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="569">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="570">
          
          
          <code class="ruby">  def self.generate_root_xml(records, root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="571">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="572">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="573">
          
          
          <code class="ruby">    Parallel.each(records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="574">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="575">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="576">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="577">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="578">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="579">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="580">
          
          
          <code class="ruby">          last_station = ReportMini.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="581">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="582">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="583">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="584">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="585">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="586">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="587">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="588">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="589">
          
          
          <code class="ruby">        # If yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="590">
          
          
          <code class="ruby">        y_rate = r.yield_rate.nil? ? &#39;No Input&#39; : r.yield_rate.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="591">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="592">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="593">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="594">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="595">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="596">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="597">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="598">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="599">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Mini/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="600">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="601">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="602">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="603">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="604">
          
          
          <code class="ruby">    File.open(root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="605">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="606">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="607">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="608">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="609">
          
          
          <code class="ruby">  def self.generate_fp_root_xml(records, records_fp, fp_root_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="610">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="611">
          
          
          <code class="ruby">    # XML file path for showing FirstPass yield</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="612">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="613">
          
          
          <code class="ruby">    Parallel.each(records_fp, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="614">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="615">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="616">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="617">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="618">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="619">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="620">
          
          
          <code class="ruby">          last_station = ReportMini.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="621">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="622">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="623">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="624">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="625">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="626">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="627">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="628">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="629">
          
          
          <code class="ruby">        # Counting FirstPass yield rate, if fp_yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="630">
          
          
          <code class="ruby">        fp_yield_rate = r.fp_yield_rate.nil? ? &#39;No Input&#39; : r.fp_yield_rate.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="631">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="632">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="633">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="634">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="635">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="636">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="637">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="638">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="639">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + fp_yield_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Mini/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="640">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="641">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="642">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="643">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="644">
          
          
          <code class="ruby">    File.open(fp_root_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="645">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="646">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="647">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="648">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="649">
          
          
          <code class="ruby">  def self.generate_today_yield_root_xml(records, today_yield_xml_filename, fp_today_yield_xml_filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="650">
          
          
          <code class="ruby">    server_url = &quot;http://csmcfa01.quantacn.com:8087/PPP/TestXML/&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="651">
          
          
          <code class="ruby">    tmp = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="652">
          
          
          <code class="ruby">    tmp2 = &quot;&lt;?xml version=\&quot;1.0\&quot; ?&gt;&lt;rss version=\&quot;2.0\&quot;&gt;&lt;channel&gt;\n&lt;Ntitle A=\&quot;&quot; + records.first.stage.to_s + &quot;\&quot;&gt;&lt;/Ntitle&gt;\n&lt;pubDate&gt;&quot; + records.first.published_at.to_s.gsub(&#39; UTC&#39;, &#39;&#39;) + &quot;&lt;/pubDate&gt;\n&lt;link&gt;&lt;/link&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="653">
          
          
          <code class="ruby">    Parallel.each(records, in_threads: 4) do |r|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="654">
          
          
          <code class="ruby">      ActiveRecord::Base.connection_pool.with_connection do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="655">
          
          
          <code class="ruby">        # Counting Output &amp; WIP of each station</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="656">
          
          
          <code class="ruby">        output = r.first_pass.to_i + r.retest_pass.to_i + r.test_waive.to_i + r.design_waive.to_i + r.cof_waive.to_i + r.ntf.to_i + r.failure_waive.to_i + r.repaire_ok.to_i + r.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="657">
          
          
          <code class="ruby">        if r.seqno.to_s.eql? &quot;1&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="658">
          
          
          <code class="ruby">          wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="659">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="660">
          
          
          <code class="ruby">          last_station = ReportMini.find_by_seqno_and_stage_and_config_and_published_at(r.seqno - 1, r.stage, r.config, r.published_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="661">
          
          
          <code class="ruby">          if last_station.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="662">
          
          
          <code class="ruby">            wip = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="663">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="664">
          
          
          <code class="ruby">            last_station_output = last_station.first_pass.to_i + last_station.retest_pass.to_i + last_station.test_waive.to_i + last_station.design_waive.to_i + last_station.cof_waive.to_i + last_station.ntf.to_i + last_station.failure_waive.to_i + last_station.repaire_ok.to_i + last_station.inl_repaire.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="665">
          
          
          <code class="ruby">            wip = last_station_output - last_station.pass_borrow.to_i - r.input.to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="666">
          
          
          <code class="ruby">            wip = 0 if wip &lt; 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="667">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="668">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="669">
          
          
          <code class="ruby">        # If yield_rate is NULL in database, convert it to &#39;No Input&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="670">
          
          
          <code class="ruby">        y_rate = r.yield_rate_today.nil? ? &#39;No Input&#39; : r.yield_rate_today.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="671">
          
          
          <code class="ruby">        y_rate_fp = r.fp_yield_rate_today.nil? ? &#39;No Input&#39; : r.fp_yield_rate_today.to_s + &#39;%&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="672">
          
          
          <code class="ruby">        # For separating the XML file contents from &#39;Sum-All&#39; and &#39;Sum-Config&#39; file type</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="673">
          
          
          <code class="ruby">        station_name = r.station_name.to_s.gsub(&#39;/&#39;, &#39;_&#39;).gsub(&#39;&amp;&#39;, &#39;_&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="674">
          
          
          <code class="ruby">        xml_filename = r.station_name.to_s.gsub(/[^0-9a-z]/i, &#39;&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="675">
          
          
          <code class="ruby">        model_name = r.model.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="676">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="677">
          
          
          <code class="ruby">        # Get stage name without model (ex. EVT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="678">
          
          
          <code class="ruby">        stage_name = r.stage.to_s[r.stage.to_s.index(&#39;-&#39;)+1..-1]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="679">
          
          
          <code class="ruby">        # Write data from csv row data to XML file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="680">
          
          
          <code class="ruby">        tmp &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Mini/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="681">
          
          
          <code class="ruby">        tmp2 &lt;&lt; &quot;&lt;item&gt;&lt;title&gt;&quot; + station_name + &quot;&lt;/title&gt;\n&lt;pubDate&gt;Input:&quot; + r.input.to_s + &quot; Output:&quot; + output.to_s + &quot; WIP:&quot; + wip.to_s + &quot; FAIL:&quot; + r.fail.to_s + &quot;&lt;/pubDate&gt;\n&lt;yield&gt;&quot; + y_rate_fp + &quot;&lt;/yield&gt;\n&lt;sflow&gt;&quot; + r.seqno.to_s + &quot;&lt;/sflow&gt;\n&lt;link&gt;&quot; + server_url + stage_name + &quot;/&quot; + model_name + &quot;Main/&quot; + xml_filename + &quot;.xml&lt;/link&gt;&lt;/item&gt;\n&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="682">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="683">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="684">
          
          
          <code class="ruby">    tmp &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="685">
          
          
          <code class="ruby">    tmp2 &lt;&lt; &quot;&lt;/channel&gt;&lt;/rss&gt;&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="686">
          
          
          <code class="ruby">    # Write xml content to the file </code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="687">
          
          
          <code class="ruby">    File.open(today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="688">
          
          
          <code class="ruby">      f &lt;&lt; tmp</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="689">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="690">
          
          
          <code class="ruby">    File.open(fp_today_yield_xml_filename, &#39;w&#39;) do |f|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="691">
          
          
          <code class="ruby">      f &lt;&lt; tmp2</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="692">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="693">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="694">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="509b817825086fa44d0ad97560b18cfa1138a834">
  <div class="header">
    <h3>app/models/station.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Station &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :post_id, :yield_file_id, :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :yield_file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :reports, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :mi_reports, dependent: :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, :post_id, :yield_file_id, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3f42ef041a2cd8b556b57b966eb0e0cec323b991">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4><span class="red">34.15 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>27</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby">#require &#39;Houston&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class User &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # Include default devise modules. Others available are:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # :token_authenticatable, :encryptable, :confirmable, :lockable, :timeoutable and :omniauthable</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :registerable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">         :recoverable, :rememberable, :trackable, :validatable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">         :omniauthable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Setup accessible (or protected) attributes for your model</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :email, :password, :password_confirmation, :remember_me</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # attr_accessible :title, :body</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :provider, :uid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :facebook_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :devices, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :posts, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :products, :dependent =&gt; :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :access_grants, :dependent =&gt; :destroy, :class_name =&gt; &quot;Doorkeeper::AccessGrant&quot;, :foreign_key =&gt; &quot;resource_owner_id&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :access_tokens, :dependent =&gt; :destroy, :class_name =&gt; &quot;Doorkeeper::AccessToken&quot;, :foreign_key =&gt; &quot;resource_owner_id&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # validates_presence_of   :email, :if =&gt; :email_required?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  # validates_uniqueness_of :email, :allow_blank =&gt; true, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # validates_format_of     :email, :with  =&gt; email_regexp, :allow_blank =&gt; true, :if =&gt; :email_changed?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # validates_presence_of     :password, :if =&gt; :password_required?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  # validates_confirmation_of :password, :if =&gt; :password_required?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # validates_length_of       :password, :within =&gt; password_length, :allow_blank =&gt; true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.send_notify_ios(text, data = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">    certificate = File.read(ENV[&#39;APPLE_CERTIFICATE&#39;])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">    passphrase = ENV[&#39;APN_CERTIFICATE_PASSPHRASE&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">    connection = Houston::Connection.new(Houston::APPLE_DEVELOPMENT_GATEWAY_URI, certificate, passphrase)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">    connection.open</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    #apn = Houston::Client.development</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    #apn.certificate = File.read(ENV[&#39;APPLE_CERTIFICATE&#39;]) # certificate from prerequisites</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    Device.where(platform: &#39;ios&#39;).each do |device|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      notification = Houston::Notification.new(device: device.uuid)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      notification.alert = text</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      notification.badge = 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      notification.content_available = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">      notification.mutable_content = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      #notification.sound = &#39;sound.aiff&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      #notification.category = &#39;INVITE_CATEGORY&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      #notification.custom_data = { foo: &#39;bar&#39;, alice: &#39;bob&#39; }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">      notification.custom_data = data unless data.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="49">
          
          
          <code class="ruby">      connection.write(notification.message)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">      connection.close</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_for_facebook_oauth(auth, signed_in_resource = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">    user = User.where(provider: auth.provider, uid: auth.uid).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="56">
          
          
          <code class="ruby">    unless user</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">      user = User.create(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        # name: auth.extra.raw_info.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        provider: auth.provider,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">        uid: auth.uid,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">        email: auth.info.email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        password: Devise.friendly_token[0, 20]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">    if user.valid?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">      user.facebook_token = auth.credentials.token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">      user.facebook_expires_at = Time.at(auth.credentials.expires_at)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">      user.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">    user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.new_with_session(params, session)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">    super.tap do |user|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">      if data = session[&quot;devise.facebook_data&quot;] &amp;&amp; session[&quot;devise.facebook_data&quot;][&quot;extra&quot;][&quot;raw_info&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="78">
          
          
          <code class="ruby">        user.email = data[&quot;email&quot;] if user.email.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">    if !@facebook &amp;&amp; facebook_token &amp;&amp; facebook_expires_at &gt; Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">      @facebook = Koala::Facebook::API.new(facebook_token)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="87">
          
          
          <code class="ruby">    @facebook</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="192ae2df3a7c073d1d37b30e13dafe27ad7fdc66">
  <div class="header">
    <h3>app/models/yield_file.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class YieldFile &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :post_id, :file_name, :total_row, :published_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :post</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :reports, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :mi_reports, dependent: :destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :stations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :file_name, presence: true, uniqueness: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :post_id, :total_row, :published_at, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :total_row, numericality: { only_integer: true }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_create do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  	file_extension = File.extname(self.file_name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    if !file_extension.downcase == &#39;.csv&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # If failed to import reports, delete the yield file from database </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    unless Report.where(&#39;yield_file_id = ?&#39;, self.id).first.equal? nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">      self.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e0bbfa5bd3e2798f0e4c2853aede172985a8c0cc">
  <div class="header">
    <h3>lib/tasks/import_bfiamu.rake</h3>
    <h4><span class="red">7.14 %</span> covered</h4>
    <div>
      <b>56</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>52</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">desc &quot;This task is for importing BFIAMU csv files into database&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">task :import_bfiamu, [:filename] =&gt; :environment do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">	puts &quot;Fetching csv files from folder...&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="7">
          
          
          <code class="ruby">	imported_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">	imported_main_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">	imported_mini_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    duplicated_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">	filtered_csvs_from_today = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">    no_row_files = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">    filtered_csvs = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    check_filename_date = []</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">    target_folder = Dir.home + &#39;/bfiamu_csv&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Define the folder of CSV files</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">	d = Dir.new(target_folder)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">	#Dir.chdir(d)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">	# This will recursively find all csv files in a given directory</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">	#csvs = d.entries.select {|csv| /^.+\.csv$/.match(csv)}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">	filtered_csvs = Dir[ File.join(d, &#39;**&#39;, &#39;*.csv&#39;) ].reject { |p| File.directory? p }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">	start_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">	puts &quot;Start importing BFIAMU data at #{start_time}&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">	puts &#39;-&#39; * 50</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">	#Only import today&#39;s CSV files</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">	date_today = DateTime.parse(Date.today.to_s).strftime(&#39;%Y%m%d&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">	date_yesterday = DateTime.parse((Date.today-1).to_s).strftime(&#39;%Y%m%d&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">		</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">	# Get latest datetime stamp from csv filename lists</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">	filtered_csvs.select do |file|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">		filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="34">
          
          
          <code class="ruby">		file_date = filename[0, 8]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">		check_filename_date &lt;&lt; file_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">	latest_date = check_filename_date.max #ex: 20200211, This is maybe Today or Yesterday</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">	# For the first time import, comment out below section of codes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">	# filtered_csvs.select do |file|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">	# 	filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">	# 	if filename.eql? latest_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">	# 		filtered_csvs_from_today &lt;&lt; file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">	# 	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">	# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">	filtered_csvs.select do |file|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">		filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">		# line_count = `wc -l &quot;#{file}&quot;`.strip.split(&#39; &#39;)[0].to_i - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        # Check if csv file already existed (imported) in database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">        if YieldFile.exists?(file_name: filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">        	duplicated_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">        	puts filename.to_s + &#39; [Duplicated import]&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        	next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        # Do nothing when CSV files contain no row data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        # elsif line_count.equal? 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        # 	no_row_files &lt;&lt; file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        # 	next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        else # Process the CSV files that we actually need</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        	model_stage = &#39;BFIAMU&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">        	if post = Post.find_by_title(model_stage)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">        		Report.import_data(file, filename, post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        		# Check total imported row counts</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        		if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        			count = Report.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        			# Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        			if count + 4 == file.total_row</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">		                imported_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="69">
          
          
          <code class="ruby">		                puts filename.to_s + &#39; [successfully imported]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">		            else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">		                # If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">		                file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">		                puts &#39;Data lost while importing data from &#39; + filename.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">		            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">		        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">		    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">		    	post = Post.create(title: model_stage)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">	            # Then import yield records</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">	            Report.import_data(file, filename, post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">	            # Check total imported row counts</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="81">
          
          
          <code class="ruby">	            if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="82">
          
          
          <code class="ruby">	            	count = Report.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">	            	# Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">	            	if count.equal? file.total_row</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">	            		imported_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="86">
          
          
          <code class="ruby">	            		puts filename.to_s + &#39; successfully imported!&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">	            	else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">	            		# If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="89">
          
          
          <code class="ruby">	            		file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="90">
          
          
          <code class="ruby">	            		puts &#39;Data lost while importing &#39; + filename.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">	            	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">	            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="96">
          
          
          <code class="ruby">	puts &#39;-&#39; * 50</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="97">
          
          
          <code class="ruby">	puts filtered_csvs.count.to_s + &#39; CSV files processed, &#39; + duplicated_files.count.to_s + &#39; duplicated, &#39; + no_row_files.count.to_s + &#39; no row files, and &#39; + (imported_files.count + imported_main_files.count + imported_mini_files.count).to_s + &#39; files imported!&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">	puts &#39;Auto importing process completed at &#39; + Time.now.to_s</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">	end_time = Time.now</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="100">
          
          
          <code class="ruby">	puts &quot;Time elapsed #{(end_time - start_time)} seconds&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f0b0128fffd06569327ce12fa4cee616102b6bd3">
  <div class="header">
    <h3>lib/tasks/import_mi_index.rake</h3>
    <h4><span class="green">92.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;csv&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fileutils&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">desc &quot;This task is for importing MI_INDEX csv files into database&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">task :import_mi_index, [:filename] =&gt; :environment do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &quot;Fetching csv files from folder...&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">	imported_files = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">	imported_main_files = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">	imported_mini_files = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    duplicated_files = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">	filtered_csvs_from_today = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    no_row_files = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    filtered_csvs = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    check_filename_date = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    target_folder = Dir.home + &#39;/desktop/mi_index_csv&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # Define the folder of CSV files</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">	d = Dir.new(target_folder)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">	#Dir.chdir(d)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">	# This will recursively find all csv files in a given directory</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">	#csvs = d.entries.select {|csv| /^.+\.csv$/.match(csv)}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">	filtered_csvs = Dir[ File.join(d, &#39;**&#39;, &#39;*.csv&#39;) ].reject { |p| File.directory? p }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">	start_time = Time.now</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &quot;Start importing MI_INDEX data at #{start_time}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &#39;-&#39; * 50</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">	#Only import today&#39;s CSV files</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">	date_today = DateTime.parse(Date.today.to_s).strftime(&#39;%Y%m%d&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">	date_yesterday = DateTime.parse((Date.today-1).to_s).strftime(&#39;%Y%m%d&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">		</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">	# Get latest datetime stamp from csv filename lists</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">	filtered_csvs.select do |file|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">		filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">		file_date = filename[12, 8]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">		check_filename_date &lt;&lt; file_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">	latest_date = check_filename_date.max #ex: 20200211, This is maybe Today or Yesterday</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">	# For the first time import, comment out below section of codes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">	# filtered_csvs.select do |file|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">	# 	filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">	# 	if filename.eql? latest_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">	# 		filtered_csvs_from_today &lt;&lt; file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">	# 	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">	# end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">	filtered_csvs.select do |file|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">		filename = File.basename(file).gsub(&#39;_&#39;, &#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">		# line_count = `wc -l &quot;#{file}&quot;`.strip.split(&#39; &#39;)[0].to_i - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        # Check if csv file already existed (imported) in database</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">        if YieldFile.exists?(file_name: filename)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">        	duplicated_files &lt;&lt; file</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">        	puts filename.to_s + &#39; [Duplicated import]&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">        	next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        # For the current stage, we accept importing only &#39;MI-INDEX&#39; csv files!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">        elsif !filename.include? &quot;MI-INDEX&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="57">
          
          
          <code class="ruby">        	filtered_files &lt;&lt; file</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">        	next</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        else # Process the CSV files that we actually need</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        	model_stage = &#39;BFIAMU&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        	if post = Post.find_by_title(model_stage)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">        		MiReport.import_data(file, filename, post)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">        		# Check total imported row counts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        		if file = YieldFile.find_by_file_name(filename)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">        			count = MiReport.where(post_id: post, yield_file_id: file).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        			# Check if CSV row numbers equal to record numbers that imported to database</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">        			if count + 7 == file.total_row</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">		                imported_files &lt;&lt; file</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">		                puts filename.to_s + &#39; [successfully imported]&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">		            else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">		                # If row counts are not equal, rollback all the imported rows</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">		                file.destroy</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">		                puts &#39;Data lost while importing data from &#39; + filename.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">		            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">		        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        	end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">	end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &#39;-&#39; * 50</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">	puts filtered_csvs.count.to_s + &#39; CSV files processed, &#39; + duplicated_files.count.to_s + &#39; duplicated, &#39; + no_row_files.count.to_s + &#39; no row files, and &#39; + (imported_files.count + imported_main_files.count + imported_mini_files.count).to_s + &#39; files imported!&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &#39;Auto importing process completed at &#39; + Time.now.to_s</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">	end_time = Time.now</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">	puts &quot;Time elapsed #{(end_time - start_time)} seconds&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
