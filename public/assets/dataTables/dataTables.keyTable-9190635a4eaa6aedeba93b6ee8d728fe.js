/*! KeyTable 2.1.0
 * Â©2009-2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     KeyTable
 * @description Spreadsheet like keyboard navigation for DataTables
 * @version     2.1.0
 * @file        dataTables.keyTable.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2009-2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(A){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(t){return A(t,window,document)}):"object"==typeof exports?module.exports=function(t,e){return t||(t=window),e&&e.fn.dataTable||(e=require("datatables.net")(t,e).$),A(e,t,t.document)}:A(jQuery,window,document)}(function(A,t,e,i){"use strict";var n=A.fn.dataTable,r=function(t,e){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"KeyTable requires DataTables 1.10.8 or newer";this.c=A.extend(!0,{},n.defaults.keyTable,r.defaults,e),this.s={dt:new n.Api(t),enable:!0},this.dom={};var i=this.s.dt.settings()[0],o=i.keytable;return o?o:(i.keytable=this,void this._constructor())};return A.extend(r.prototype,{blur:function(){this._blur()},enable:function(A){this.s.enable=A},focus:function(A,t){this._focus(this.s.dt.cell(A,t))},focused:function(A){var t=this.s.lastFocus;if(!t)return!1;var e=this.s.lastFocus.index();return A.row===e.row&&A.column===e.column},_constructor:function(){this._tabInput();var t=this,i=this.s.dt,n=A(i.table().node());"static"===n.css("position")&&n.css("position","relative"),A(i.table().body()).on("click.keyTable","th, td",function(){if(t.s.enable!==!1){var A=i.cell(this);A.any()&&t._focus(A)}}),A(e.body).on("keydown.keyTable",function(A){t._key(A)}),this.c.blurable&&A(e.body).on("click.keyTable",function(e){A(e.target).parents(".dataTables_filter").length&&t._blur(),A(e.target).parents().filter(i.table().container()).length||A(e.target).parents("div.DTE").length||t._blur()}),this.c.editor&&i.on("key.kt",function(A,e,i,n,r){t._editor(i,r)}),i.settings()[0].oFeatures.bStateSave&&i.on("stateSaveParams.keyTable",function(A,e,i){i.keyTable=t.s.lastFocus?t.s.lastFocus.index():null}),i.on("destroy.keyTable",function(){i.off(".keyTable"),A(i.table().body()).off("click.keyTable","th, td"),A(e.body).off("keydown.keyTable").off("click.keyTable")});var r=i.state.loaded();r&&r.keyTable?i.cell(r.keyTable).focus():this.c.focus&&i.cell(this.c.focus).focus()},_blur:function(){if(this.s.enable&&this.s.lastFocus){var t=this.s.lastFocus;A(t.node()).removeClass(this.c.className),this.s.lastFocus=null,this._emitEvent("key-blur",[this.s.dt,t])}},_columns:function(){var A=this.s.dt,t=A.columns(this.c.columns).indexes(),e=[];return A.columns(":visible").every(function(A){-1!==t.indexOf(A)&&e.push(A)}),e},_editor:function(t,e){var i=this.s.dt,n=this.c.editor;e.stopPropagation(),n.inline(this.s.lastFocus.index());var r=A("div.DTE input");r.length&&r[0].select(),i.keys.enable("navigation-only"),i.one("key-blur.editor",function(){n.displayed()&&n.submit()}),n.one("close",function(){i.keys.enable(!0),i.off("key-blur.editor")})},_emitEvent:function(t,e){this.s.dt.iterator("table",function(i){A(i.nTable).triggerHandler(t,e)})},_focus:function(i,n){var r=this,o=this.s.dt,s=o.page.info(),a=this.s.lastFocus;if(this.s.enable){if("number"!=typeof i){var l=i.index();n=l.column,i=o.rows({filter:"applied",order:"applied"}).indexes().indexOf(l.row),s.serverSide&&(i+=s.start)}if(-1!==s.length&&(i<s.start||i>=s.start+s.length))return void o.one("draw",function(){r._focus(i,n)}).page(Math.floor(i/s.length)).draw(!1);if(-1!==A.inArray(n,this._columns())){s.serverSide&&(i-=s.start);var c=o.cell(":eq("+i+")",n,{search:"applied"});if(a){if(a.node()===c.node())return;this._blur()}var h=A(c.node());h.addClass(this.c.className),this._scroll(A(t),A(e.body),h,"offset");var u=o.table().body().parentNode;if(u!==o.table().header().parentNode){var d=A(u.parentNode);this._scroll(d,d,h,"position")}this.s.lastFocus=c,this._emitEvent("key-focus",[this.s.dt,c]),o.state.save()}}},_key:function(t){if(this.s.enable&&!(0===t.keyCode||t.ctrlKey||t.metaKey||t.altKey)){var e=this.s.lastFocus;if(e){var i=this,n=this.s.dt;if(!this.c.keys||-1!==A.inArray(t.keyCode,this.c.keys))switch(t.keyCode){case 9:this._shift(t,t.shiftKey?"left":"right",!0);break;case 27:this.s.blurable&&this.s.enable===!0&&this._blur();break;case 33:case 34:t.preventDefault();var r=n.cells({page:"current"}).nodes().indexOf(e.node());n.one("draw",function(){var A=n.cells({page:"current"}).nodes();i._focus(n.cell(r<A.length?A[r]:A[A.length-1]))}).page(33===t.keyCode?"previous":"next").draw(!1);break;case 35:case 36:t.preventDefault();var o=n.cells({page:"current"}).indexes();this._focus(n.cell(o[35===t.keyCode?o.length-1:0]));break;case 37:this._shift(t,"left");break;case 38:this._shift(t,"up");break;case 39:this._shift(t,"right");break;case 40:this._shift(t,"down");break;default:this.s.enable===!0&&this._emitEvent("key",[n,t.keyCode,this.s.lastFocus,t])}}}},_scroll:function(A,t,e,i){var n=e[i](),r=e.outerHeight(),o=e.outerWidth(),s=t.scrollTop(),a=t.scrollLeft(),l=A.height(),c=A.width();n.top<s&&t.scrollTop(n.top),n.left<a&&t.scrollLeft(n.left),n.top+r>s+l&&t.scrollTop(n.top+r-l),n.left+o>a+c&&t.scrollLeft(n.left+o-c)},_shift:function(t,e,i){var n=this.s.dt,r=n.page.info(),o=r.recordsDisplay,s=this.s.lastFocus,a=this._columns();if(s){var l=n.rows({filter:"applied",order:"applied"}).indexes().indexOf(s.index().row);r.serverSide&&(l+=r.start);var c=n.columns(a).indexes().indexOf(s.index().column),h=l,u=a[c];"right"===e?c>=a.length-1?(h++,u=a[0]):u=a[c+1]:"left"===e?0===c?(h--,u=a[a.length-1]):u=a[c-1]:"up"===e?h--:"down"===e&&h++,h>=0&&o>h&&-1!==A.inArray(u,a)?(t.preventDefault(),this._focus(h,u)):i&&this.c.blurable?this._blur():t.preventDefault()}},_tabInput:function(){var t=this,e=this.s.dt,i=null!==this.c.tabIndex?this.c.tabIndex:e.settings()[0].iTabIndex;if(-1!=i){var n=A('<div><input type="text" tabindex="'+i+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"}).insertBefore(e.table().node());n.children().on("focus",function(){t._focus(e.cell(":eq(0)",{page:"current"}))})}}}),r.defaults={blurable:!0,className:"focus",columns:"",editor:null,focus:null,keys:null,tabIndex:null},r.version="2.1.0",A.fn.dataTable.KeyTable=r,A.fn.DataTable.KeyTable=r,n.Api.register("cell.blur()",function(){return this.iterator("table",function(A){A.keytable&&A.keytable.blur()})}),n.Api.register("cell().focus()",function(){return this.iterator("cell",function(A,t,e){A.keytable&&A.keytable.focus(t,e)})}),n.Api.register("keys.disable()",function(){return this.iterator("table",function(A){A.keytable&&A.keytable.enable(!1)})}),n.Api.register("keys.enable()",function(A){return this.iterator("table",function(t){t.keytable&&t.keytable.enable(A===i?!0:A)})}),n.ext.selector.cell.push(function(A,t,e){var n=t.focused,r=A.keytable,o=[];if(!r||n===i)return e;for(var s=0,a=e.length;a>s;s++)(n===!0&&r.focused(e[s])||n===!1&&!r.focused(e[s]))&&o.push(e[s]);return o}),A(e).on("preInit.dt.dtk",function(t,e){if("dt"===t.namespace){var i=e.oInit.keys,o=n.defaults.keys;if(i||o){var s=A.extend({},i,o);i!==!1&&new r(e,s)}}}),r});