/*! RowReorder 1.1.0
 * 2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     RowReorder
 * @description Row reordering extension for DataTables
 * @version     1.1.0
 * @file        dataTables.rowReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(A){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(t){return A(t,window,document)}):"object"==typeof exports?module.exports=function(t,e){return t||(t=window),e&&e.fn.dataTable||(e=require("datatables.net")(t,e).$),A(e,t,t.document)}:A(jQuery,window,document)}(function(A,t,e){"use strict";var i=A.fn.dataTable,n=function(t,e){if(!i.versionCheck||!i.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=A.extend(!0,{},i.defaults.rowReorder,n.defaults,e),this.s={bodyTop:null,dt:new i.Api(t),getDataFn:i.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,setDataFn:i.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0},this.dom={clone:null};var r=this.s.dt.settings()[0],o=r.rowreorder;return o?o:(r.rowreorder=this,void this._constructor())};return A.extend(n.prototype,{_constructor:function(){var t=this,e=this.s.dt,i=A(e.table().node());"static"===i.css("position")&&i.css("position","relative"),A(e.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(i){var n=A(this).closest("tr");return e.row(n).any()?(t._mouseDown(i,n),!1):void 0}),e.on("destroy.rowReorder",function(){A(e.table().container()).off(".rowReorder"),e.off(".rowReorder")})},_cachePositions:function(){var e=this.s.dt,i=A(e.table().node()).find("thead").outerHeight(),n=A.unique(e.rows({page:"current"}).nodes().toArray()),r=A.map(n,function(t){return A(t).position().top-i}),o=A.map(r,function(t,i){return r.length<i-1?(t+r[i+1])/2:(t+t+A(e.row(":last-child").node()).outerHeight())/2});this.s.middles=o,this.s.bodyTop=A(e.table().body()).offset().top,this.s.windowHeight=A(t).height()},_clone:function(t){var e=this.s.dt,i=A(e.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(t.clone(!1)),n=t.outerWidth(),r=t.outerHeight(),o=t.children().map(function(){return A(this).width()});i.width(n).height(r).find("tr").children().each(function(A){this.style.width=o[A]+"px"}),i.appendTo("body"),this.dom.clone=i},_clonePosition:function(A){var t,e=this.s.start,i=this._eventToPage(A,"Y")-e.top,n=this._eventToPage(A,"X")-e.left,r=this.c.snapX;t=r===!0?e.offsetLeft:"number"==typeof r?e.offsetLeft+r:n+e.offsetLeft,this.dom.clone.css({top:i+e.offsetTop,left:t})},_emitEvent:function(t,e){this.s.dt.iterator("table",function(i){A(i.nTable).triggerHandler(t+".dt",e)})},_eventToPage:function(A,t){return-1!==A.type.indexOf("touch")?A.originalEvent.touches[0]["page"+t]:A["page"+t]},_mouseDown:function(i,n){var r=this,o=this.s.dt,s=this.s.start,a=n.offset();s.top=this._eventToPage(i,"Y"),s.left=this._eventToPage(i,"X"),s.offsetTop=a.top,s.offsetLeft=a.left,s.nodes=A.unique(o.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(n),this._clonePosition(i),this.dom.target=n,n.addClass("dt-rowReorder-moving"),A(e).on("mouseup.rowReorder touchend.rowReorder",function(A){r._mouseUp(A)}).on("mousemove.rowReorder touchmove.rowReorder",function(A){r._mouseMove(A)}),A(t).width()===A(e).width()&&A(e.body).addClass("dt-rowReorder-noOverflow")},_mouseMove:function(t){this._clonePosition(t);for(var i=this._eventToPage(t,"Y")-this.s.bodyTop,n=this.s.middles,r=null,o=this.s.dt,s=o.table().body(),a=0,l=n.length;l>a;a++)if(i<n[a]){r=a;break}if(null===r&&(r=n.length),null===this.s.lastInsert||this.s.lastInsert!==r){if(0===r)this.dom.target.prependTo(s);else{var c=A.unique(o.rows({page:"current"}).nodes().toArray());r>this.s.lastInsert?this.dom.target.before(c[r-1]):this.dom.target.after(c[r])}this._cachePositions(),this.s.lastInsert=r}var h=this._eventToPage(t,"Y")-e.body.scrollTop,u=this.s.scrollInterval;65>h?u||(this.s.scrollInterval=setInterval(function(){e.body.scrollTop-=5},15)):this.s.windowHeight-h<65?u||(this.s.scrollInterval=setInterval(function(){e.body.scrollTop+=5},15)):(clearInterval(u),this.s.scrollInterval=null)},_mouseUp:function(){var t,i,n=this.s.dt,r=this.c.dataSrc;this.dom.clone.remove(),this.dom.clone=null,this.dom.target.removeClass("dt-rowReorder-moving"),A(e).off(".rowReorder"),A(e.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null;var o=this.s.start.nodes,s=A.unique(n.rows({page:"current"}).nodes().toArray()),a={},l=[],c=[],h=this.s.getDataFn,u=this.s.setDataFn;for(t=0,i=o.length;i>t;t++)if(o[t]!==s[t]){var d=n.row(s[t]).id(),f=n.row(s[t]).data(),g=n.row(o[t]).data();d&&(a[d]=h(g)),l.push({node:s[t],oldData:h(f),newData:h(g),newPosition:t,oldPosition:A.inArray(s[t],o)}),c.push(s[t])}if(this._emitEvent("row-reorder",[l,{dataSrc:r,nodes:c,values:a,triggerRow:n.row(this.dom.target)}]),this.c.editor&&this.c.editor.edit(c,!1,{submit:"changed"}).multiSet(r,a).submit(),this.c.update){for(t=0,i=l.length;i>t;t++){var p=n.row(l[t].node),B=p.data();u(B,l[t].newData),n.columns().every(function(){this.dataSrc()===r&&n.cell(l[t].node,this.index()).invalidate("data")})}n.draw(!1)}}}),n.defaults={dataSrc:0,editor:null,selector:"td:first-child",snapX:!1,update:!0},n.version="1.1.0",A.fn.dataTable.RowReorder=n,A.fn.DataTable.RowReorder=n,A(e).on("init.dt.dtr",function(t,e){if("dt"===t.namespace){var r=e.oInit.rowReorder,o=i.defaults.rowReorder;if(r||o){var s=A.extend({},r,o);r!==!1&&new n(e,s)}}}),n});