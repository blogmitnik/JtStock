/*! AutoFill 2.1.0
 * Â©2008-2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     AutoFill
 * @description Add Excel like click and drag auto-fill options to DataTables
 * @version     2.1.0
 * @file        dataTables.autoFill.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(A){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(t){return A(t,window,document)}):"object"==typeof exports?module.exports=function(t,e){return t||(t=window),e&&e.fn.dataTable||(e=require("datatables.net")(t,e).$),A(e,t,t.document)}:A(jQuery,window,document)}(function(A,t,e,i){"use strict";var n=A.fn.dataTable,r=0,s=function(t,e){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"Warning: AutoFill requires DataTables 1.10.8 or greater";this.c=A.extend(!0,{},n.defaults.autoFill,s.defaults,e),this.s={dt:new n.Api(t),namespace:".autoFill"+r++,scroll:{},scrollInterval:null,handle:{height:0,width:0}},this.dom={handle:A('<div class="dt-autofill-handle"/>'),select:{top:A('<div class="dt-autofill-select top"/>'),right:A('<div class="dt-autofill-select right"/>'),bottom:A('<div class="dt-autofill-select bottom"/>'),left:A('<div class="dt-autofill-select left"/>')},background:A('<div class="dt-autofill-background"/>'),list:A('<div class="dt-autofill-list">'+this.s.dt.i18n("autoFill.info","")+"<ul/></div>"),dtScroll:null,offsetParent:null},this._constructor()};return A.extend(s.prototype,{_constructor:function(){var t=this,i=this.s.dt,n=A("div.dataTables_scrollBody",this.s.dt.table().container());n.length&&(this.dom.dtScroll=n,"static"===n.css("position")&&n.css("position","relative")),this._focusListener(),this.dom.handle.on("mousedown",function(A){return t._mousedown(A),!1}),i.on("destroy.autoFill",function(){i.off(".autoFill"),A(i.table().body()).off(t.s.namespace),A(e.body).off(t.s.namespace)})},_attach:function(t){var e=this.s.dt,i=e.cell(t).index(),n=this.dom.handle,r=this.s.handle;if(!i||-1===e.columns(this.c.columns).indexes().indexOf(i.column))return void this._detach();this.dom.offsetParent||(this.dom.offsetParent=A(t).offsetParent()),r.height&&r.width||(n.appendTo("body"),r.height=n.outerHeight(),r.width=n.outerWidth());var s=A(t).position();this.dom.attachedTo=t,n.css({top:s.top+t.offsetHeight-r.height,left:s.left+t.offsetWidth-r.width}).appendTo(this.dom.offsetParent)},_actionSelector:function(t){var e=this,i=this.s.dt,n=s.actions,r=[];if(A.each(n,function(A,e){e.available(i,t)&&r.push(A)}),1===r.length&&this.c.alwaysAsk===!1){var o=n[r[0]].execute(i,t);this._update(o,t)}else{var a=this.dom.list.children("ul").empty();r.push("cancel"),A.each(r,function(r,o){a.append(A("<li/>").append('<div class="dt-autofill-question">'+n[o].option(i,t)+"<div>").append(A('<div class="dt-autofill-button">').append(A('<button class="'+s.classes.btn+'">'+i.i18n("autoFill.button","&gt;")+"</button>").on("click",function(){var r=n[o].execute(i,t,A(this).closest("li"));e._update(r,t),e.dom.background.remove(),e.dom.list.remove()}))))}),this.dom.background.appendTo("body"),this.dom.list.appendTo("body"),this.dom.list.css("margin-top",this.dom.list.outerHeight()/2*-1)}},_detach:function(){this.dom.attachedTo=null,this.dom.handle.detach()},_drawSelection:function(t){var e=this.s.dt,i=this.s.start,n=A(this.dom.start),r=A(t),s={row:e.rows({page:"current"}).nodes().indexOf(r.parent()[0]),column:r.index()};if(e.cell(r).any()&&-1!==e.columns(this.c.columns).indexes().indexOf(s.column)){this.s.end=s;var o,a,l,c,h,u;o=i.row<s.row?n:r,a=i.row<s.row?r:n,l=i.column<s.column?n:r,c=i.column<s.column?r:n,o=o.position().top,l=l.position().left,h=a.position().top+a.outerHeight()-o,u=c.position().left+c.outerWidth()-l;var d=this.dom.dtScroll;d&&(o+=d.scrollTop(),l+=d.scrollLeft());var f=this.dom.select;f.top.css({top:o,left:l,width:u}),f.left.css({top:o,left:l,height:h}),f.bottom.css({top:o+h,left:l,width:u}),f.right.css({top:o,left:l+u,height:h})}},_editor:function(A){var t=this.s.dt,e=this.c.editor;if(e){for(var n={},r=[],s=e.fields(),o=0,a=A.length;a>o;o++)for(var l=0,c=A[o].length;c>l;l++){var h=A[o][l],u=t.settings()[0].aoColumns[h.index.column],d=u.editField;if(d===i)for(var f=u.mData,g=0,p=s.length;p>g;g++){var B=e.field(s[g]);if(B.dataSrc()===f){d=B.name();break}}if(!d)throw"Could not automatically determine field data. Please see https://datatables.net/tn/11";n[d]||(n[d]={});var w=t.row(h.index.row).id();n[d][w]=h.set,r.push(h.index)}e.bubble(r,!1).multiSet(n).submit()}},_emitEvent:function(t,e){this.s.dt.iterator("table",function(i){A(i.nTable).triggerHandler(t+".dt",e)})},_focusListener:function(){var t=this,i=this.s.dt,n=this.s.namespace,r=null!==this.c.focus?this.c.focus:i.settings()[0].keytable?"focus":"hover";"focus"===r?i.on("key-focus.autoFill",function(A,e,i){t._attach(i.node())}).on("key-blur.autoFill",function(){t._detach()}):"click"===r?(A(i.table().body()).on("click"+n,"td, th",function(){t._attach(this)}),A(e.body).on("click"+n,function(e){A(e.target).parents().filter(i.table().body()).length||t._detach()})):A(i.table().body()).on("mouseenter"+n,"td, th",function(){t._attach(this)}).on("mouseleave"+n,function(e){A(e.relatedTarget).hasClass("dt-autofill-handle")||t._detach()})},_mousedown:function(i){var n=this,r=this.s.dt;this.dom.start=this.dom.attachedTo,this.s.start={row:r.rows({page:"current"}).nodes().indexOf(A(this.dom.start).parent()[0]),column:A(this.dom.start).index()},A(e.body).on("mousemove.autoFill",function(A){n._mousemove(A)}).on("mouseup.autoFill",function(A){n._mouseup(A)});var s=this.dom.select,o=A(this.s.dt.table().body()).offsetParent();s.top.appendTo(o),s.left.appendTo(o),s.right.appendTo(o),s.bottom.appendTo(o),this._drawSelection(this.dom.start,i),this.dom.handle.css("display","none");var a=this.dom.dtScroll;this.s.scroll={windowHeight:A(t).height(),windowWidth:A(t).width(),dtTop:a?a.offset().top:null,dtLeft:a?a.offset().left:null,dtHeight:a?a.outerHeight():null,dtWidth:a?a.outerWidth():null}},_mousemove:function(A){var t=(this.s.dt,A.target.nodeName.toLowerCase());"td"!==t&&"th"!==t||(this._drawSelection(A.target,A),this._shiftScroll(A))},_mouseup:function(){A(e.body).off(".autoFill");var t=this.s.dt,i=this.dom.select;i.top.remove(),i.left.remove(),i.right.remove(),i.bottom.remove(),this.dom.handle.css("display","block");var n=this.s.start,r=this.s.end;if(n.row!==r.row||n.column!==r.column){for(var s=this._range(n.row,r.row),o=this._range(n.column,r.column),a=[],l=0;l<s.length;l++)a.push(A.map(o,function(A){var e=t.cell(":eq("+s[l]+")",A+":visible",{page:"current"});return{cell:e,data:e.data(),index:e.index()}}));this._actionSelector(a)}},_range:function(A,t){var e,i=[];if(t>=A)for(e=A;t>=e;e++)i.push(e);else for(e=A;e>=t;e--)i.push(e);return i},_shiftScroll:function(A){var t,i,n,r,s=this,o=(this.s.dt,this.s.scroll),a=!1,l=5,c=65,h=A.pageY-e.body.scrollTop,u=A.pageX-e.body.scrollLeft;c>h?t=-1*l:h>o.windowHeight-c&&(t=l),c>u?i=-1*l:u>o.windowWidth-c&&(i=l),null!==o.dtTop&&A.pageY<o.dtTop+c?n=-1*l:null!==o.dtTop&&A.pageY>o.dtTop+o.dtHeight-c&&(n=l),null!==o.dtLeft&&A.pageX<o.dtLeft+c?r=-1*l:null!==o.dtLeft&&A.pageX>o.dtLeft+o.dtWidth-c&&(r=l),t||i||n||r?(o.windowVert=t,o.windowHoriz=i,o.dtVert=n,o.dtHoriz=r,a=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&a&&(this.s.scrollInterval=setInterval(function(){if(o.windowVert&&(e.body.scrollTop+=o.windowVert),o.windowHoriz&&(e.body.scrollLeft+=o.windowHoriz),o.dtVert||o.dtHoriz){var A=s.dom.dtScroll[0];o.dtVert&&(A.scrollTop+=o.dtVert),o.dtHoriz&&(A.scrollLeft+=o.dtHoriz)}},20))},_update:function(A,t){if(A!==!1){var e,i=this.s.dt;this._emitEvent("preAutoFill",[i,t]),this._editor(t);var n=null!==this.c.update?this.c.update:!this.c.editor;if(n){for(var r=0,s=t.length;s>r;r++)for(var o=0,a=t[r].length;a>o;o++)e=t[r][o],e.cell.data(e.set);i.draw(!1)}this._emitEvent("autoFill",[i,t])}}}),s.actions={increment:{available:function(t,e){return A.isNumeric(e[0][0].data)},option:function(A){return A.i18n("autoFill.increment",'Increment / decrement each cell by: <input type="number" value="1">')},execute:function(t,e,i){for(var n=1*e[0][0].data,r=1*A("input",i).val(),s=0,o=e.length;o>s;s++)for(var a=0,l=e[s].length;l>a;a++)e[s][a].set=n,n+=r}},fill:{available:function(){return!0},option:function(A,t){return A.i18n("autoFill.fill","Fill all cells with <i>"+t[0][0].data+"</i>")},execute:function(A,t){for(var e=t[0][0].data,i=0,n=t.length;n>i;i++)for(var r=0,s=t[i].length;s>r;r++)t[i][r].set=e}},fillHorizontal:{available:function(A,t){return t.length>1&&t[0].length>1},option:function(A){return A.i18n("autoFill.fillHorizontal","Fill cells horizontally")},execute:function(A,t){for(var e=0,i=t.length;i>e;e++)for(var n=0,r=t[e].length;r>n;n++)t[e][n].set=t[e][0].data}},fillVertical:{available:function(A,t){return t.length>1&&t[0].length>1},option:function(A){return A.i18n("autoFill.fillVertical","Fill cells vertically")},execute:function(A,t){for(var e=0,i=t.length;i>e;e++)for(var n=0,r=t[e].length;r>n;n++)t[e][n].set=t[0][n].data}},cancel:{available:function(){return!1},option:function(A){return A.i18n("autoFill.cancel","Cancel")},execute:function(){return!1}}},s.version="2.1.0",s.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},s.classes={btn:"btn"},A(e).on("preInit.dt.autofill",function(t,e){if("dt"===t.namespace){var i=e.oInit.autoFill,r=n.defaults.autoFill;if(i||r){var o=A.extend({},i,r);i!==!1&&new s(e,o)}}}),n.AutoFill=s,n.AutoFill=s,s});